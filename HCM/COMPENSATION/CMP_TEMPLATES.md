# Compensation Templates

**Module:** Compensation Management  
**Tag:** `#HCM #CMP #Templates`  
**Status:** Production-Ready  
**Last Updated:** 18-Dec-2025

---

## Critical Rules

1. **NEVER** start compensation queries from scratch
2. **ALWAYS** copy these templates as complete skeletons
3. **ALWAYS** include Period CTE → Repository CTE → Calculation → Final SELECT
4. **ALWAYS** use `/*+ qb_name(NAME) */` hints in all CTEs
5. **ALWAYS** filter element entries by effective date

---

## 1. Employee Compensation Report Template

**Purpose:** Comprehensive compensation listing with all allowances  
**Use Case:** Compensation reviews, salary listings

```sql
/*
TITLE: Employee Compensation Report
PURPOSE: Show detailed compensation breakdown by employee
AUTHOR: [Your Name]
DATE: [DD-Mon-YYYY]
*/

WITH
-- 1. Period Context
PERIOD AS (
    SELECT /*+ qb_name(PER) MATERIALIZE */
           TRUNC(SYSDATE) EFFECTIVE_DATE
    FROM DUAL
)

-- 2. Basic Salary
,CMP_BASIC_SAL AS (
    SELECT /*+ qb_name(CMP_BASIC) MATERIALIZE */
           PEEF.PERSON_ID
          ,ROUND(TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE) / 12, 2) MONTHLY_BASIC
          ,TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE) ANNUAL_BASIC
    FROM   PAY_ELEMENT_TYPES_VL PETV,
           PAY_ELEMENT_ENTRIES_F PEEF,
           PAY_ELEMENT_ENTRY_VALUES_F PEEV,
           PAY_INPUT_VALUES_VL PIVL,
           PERIOD PER
    WHERE  PETV.ELEMENT_TYPE_ID = PEEF.ELEMENT_TYPE_ID
      AND  PEEF.ELEMENT_ENTRY_ID = PEEV.ELEMENT_ENTRY_ID
      AND  PEEV.INPUT_VALUE_ID = PIVL.INPUT_VALUE_ID
      AND  PETV.BASE_ELEMENT_NAME = 'Basic'
      AND  UPPER(TRIM(PIVL.NAME)) = 'AMOUNT'
      AND  PER.EFFECTIVE_DATE BETWEEN TRUNC(PEEF.EFFECTIVE_START_DATE) 
                                  AND TRUNC(PEEF.EFFECTIVE_END_DATE)
      AND  PER.EFFECTIVE_DATE BETWEEN TRUNC(PEEV.EFFECTIVE_START_DATE) 
                                  AND TRUNC(PEEV.EFFECTIVE_END_DATE)
)

-- 3. Allowances (Hardcoded)
,CMP_ALLOW AS (
    SELECT /*+ qb_name(CMP_ALLOW) MATERIALIZE */
           PEEF.PERSON_ID
          ,SUM(CASE WHEN PETV.BASE_ELEMENT_NAME = 'Housing Allowance' 
                    THEN TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE) END) HOUSING
          ,SUM(CASE WHEN PETV.BASE_ELEMENT_NAME = 'Transport Allowance' 
                    THEN TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE) END) TRANSPORT
          ,SUM(CASE WHEN PETV.BASE_ELEMENT_NAME = 'Food Allowance' 
                    THEN TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE) END) FOOD
          ,SUM(CASE WHEN PETV.BASE_ELEMENT_NAME = 'Mobile Allowance' 
                    THEN TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE) END) MOBILE
          ,SUM(CASE WHEN PETV.BASE_ELEMENT_NAME = 'Other Allowance' 
                    THEN TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE) END) OTHER_ALLOWANCE
    FROM   PAY_ELEMENT_TYPES_VL PETV,
           PAY_ELEMENT_ENTRIES_F PEEF,
           PAY_ELEMENT_ENTRY_VALUES_F PEEV,
           PAY_INPUT_VALUES_VL PIVL,
           PERIOD PER
    WHERE  PETV.ELEMENT_TYPE_ID = PEEF.ELEMENT_TYPE_ID
      AND  PEEF.ELEMENT_ENTRY_ID = PEEV.ELEMENT_ENTRY_ID
      AND  PEEV.INPUT_VALUE_ID = PIVL.INPUT_VALUE_ID
      AND  UPPER(TRIM(PIVL.NAME)) = 'AMOUNT'
      AND  PER.EFFECTIVE_DATE BETWEEN TRUNC(PEEF.EFFECTIVE_START_DATE) 
                                  AND TRUNC(PEEF.EFFECTIVE_END_DATE)
      AND  PER.EFFECTIVE_DATE BETWEEN TRUNC(PEEV.EFFECTIVE_START_DATE) 
                                  AND TRUNC(PEEV.EFFECTIVE_END_DATE)
    GROUP BY PEEF.PERSON_ID
)

-- 4. Gross Salary
,CMP_GROSS_SAL AS (
    SELECT /*+ qb_name(CMP_GROSS) MATERIALIZE */
           PEEF.PERSON_ID
          ,SUM(TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE)) GROSS_AMOUNT
    FROM   PAY_ELEMENT_TYPES_VL PETV,
           PAY_ELEMENT_ENTRIES_F PEEF,
           PAY_ELEMENT_ENTRY_VALUES_F PEEV,
           PAY_INPUT_VALUES_VL PIVL,
           PAY_ELE_CLASSIFICATIONS_TL PECT,
           PERIOD PER
    WHERE  PETV.ELEMENT_TYPE_ID = PEEF.ELEMENT_TYPE_ID
      AND  PEEF.ELEMENT_ENTRY_ID = PEEV.ELEMENT_ENTRY_ID
      AND  PEEV.INPUT_VALUE_ID = PIVL.INPUT_VALUE_ID
      AND  PETV.CLASSIFICATION_ID = PECT.CLASSIFICATION_ID
      AND  PETV.PROCESSING_TYPE = 'R'
      AND  UPPER(TRIM(PIVL.NAME)) = 'AMOUNT'
      AND  PECT.LANGUAGE = 'US'
      AND  UPPER(PECT.CLASSIFICATION_NAME) LIKE '%EARNING%'
      AND  PER.EFFECTIVE_DATE BETWEEN TRUNC(PEEF.EFFECTIVE_START_DATE) 
                                  AND TRUNC(PEEF.EFFECTIVE_END_DATE)
      AND  PER.EFFECTIVE_DATE BETWEEN TRUNC(PEEV.EFFECTIVE_START_DATE) 
                                  AND TRUNC(PEEV.EFFECTIVE_END_DATE)
    GROUP BY PEEF.PERSON_ID
)

-- 5. Final Select
SELECT PAPF.PERSON_NUMBER
      ,PPNF.FULL_NAME
      ,TO_CHAR(PAPF.START_DATE, 'DD-MON-YYYY') HIRE_DATE
      ,PLE.NAME LEGAL_ENTITY
      ,BU.BU_NAME BUSINESS_UNIT
      ,HDORG.NAME DEPARTMENT
      ,PJFT.NAME JOB_NAME
      ,PGFT.NAME GRADE_NAME
      ,BS.MONTHLY_BASIC BASIC_SALARY
      ,NVL(AL.HOUSING, 0) HOUSING_ALLOWANCE
      ,NVL(AL.TRANSPORT, 0) TRANSPORT_ALLOWANCE
      ,NVL(AL.FOOD, 0) FOOD_ALLOWANCE
      ,NVL(AL.MOBILE, 0) MOBILE_ALLOWANCE
      ,NVL(AL.OTHER_ALLOWANCE, 0) OTHER_ALLOWANCE
      ,NVL(GS.GROSS_AMOUNT, 0) GROSS_SALARY
FROM   PER_ALL_PEOPLE_F PAPF
      ,PER_PERSON_NAMES_F PPNF
      ,PER_ALL_ASSIGNMENTS_M PAAM
      ,PER_LEGAL_ENTITIES PLE
      ,FUN_ALL_BUSINESS_UNITS_V BU
      ,HR_ORGANIZATION_UNITS_F_TL HDORG
      ,PER_JOBS_F PJF
      ,PER_JOBS_F_TL PJFT
      ,PER_GRADES_F PGF
      ,PER_GRADES_F_TL PGFT
      ,CMP_BASIC_SAL BS
      ,CMP_ALLOW AL
      ,CMP_GROSS_SAL GS
WHERE  PAPF.PERSON_ID = PPNF.PERSON_ID
  AND  PAPF.PERSON_ID = PAAM.PERSON_ID
  AND  PAAM.LEGAL_ENTITY_ID = PLE.ORGANIZATION_ID
  AND  PAAM.BUSINESS_UNIT_ID = BU.BU_ID(+)
  AND  PAAM.ORGANIZATION_ID = HDORG.ORGANIZATION_ID
  AND  PAAM.JOB_ID = PJF.JOB_ID(+)
  AND  PJF.JOB_ID = PJFT.JOB_ID(+)
  AND  PAAM.GRADE_ID = PGF.GRADE_ID(+)
  AND  PGF.GRADE_ID = PGFT.GRADE_ID(+)
  AND  PAPF.PERSON_ID = BS.PERSON_ID(+)
  AND  PAPF.PERSON_ID = AL.PERSON_ID(+)
  AND  PAPF.PERSON_ID = GS.PERSON_ID(+)
  AND  TRUNC(SYSDATE) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
  AND  PPNF.NAME_TYPE = 'GLOBAL'
  AND  TRUNC(SYSDATE) BETWEEN PPNF.EFFECTIVE_START_DATE AND PPNF.EFFECTIVE_END_DATE
  AND  PAAM.PRIMARY_FLAG = 'Y'
  AND  PAAM.ASSIGNMENT_TYPE = 'E'
  AND  PAAM.ASSIGNMENT_STATUS_TYPE = 'ACTIVE'
  AND  PAAM.EFFECTIVE_LATEST_CHANGE = 'Y'
  AND  HDORG.LANGUAGE = 'US'
  AND  TRUNC(SYSDATE) BETWEEN HDORG.EFFECTIVE_START_DATE AND HDORG.EFFECTIVE_END_DATE
  AND  PJFT.LANGUAGE(+) = 'US'
  AND  TRUNC(SYSDATE) BETWEEN PJF.EFFECTIVE_START_DATE(+) AND PJF.EFFECTIVE_END_DATE(+)
  AND  TRUNC(SYSDATE) BETWEEN PJFT.EFFECTIVE_START_DATE(+) AND PJFT.EFFECTIVE_END_DATE(+)
  AND  PGFT.LANGUAGE(+) = 'US'
  AND  TRUNC(SYSDATE) BETWEEN PGF.EFFECTIVE_START_DATE(+) AND PGF.EFFECTIVE_END_DATE(+)
  AND  TRUNC(SYSDATE) BETWEEN PGFT.EFFECTIVE_START_DATE(+) AND PGFT.EFFECTIVE_END_DATE(+)
ORDER BY PAPF.PERSON_NUMBER
;
```

**Parameters:** None (uses SYSDATE for current compensation)

---

## 2. New Joiner Compensation Template

**Purpose:** List new employees with their compensation  
**Use Case:** New hire reports, onboarding tracking

```sql
/*
TITLE: New Joiner Compensation Report
PURPOSE: Show compensation for newly hired employees
AUTHOR: [Your Name]
DATE: [DD-Mon-YYYY]
*/

WITH
-- 1. Period Context
PERIOD AS (
    SELECT /*+ qb_name(PER) MATERIALIZE */
           TO_DATE(:P_START_DATE, 'DD-MM-YYYY') START_DATE
          ,TO_DATE(:P_END_DATE, 'DD-MM-YYYY') END_DATE
    FROM DUAL
)

-- 2. New Joiners
,NEW_JOINERS AS (
    SELECT /*+ qb_name(NEW_J) MATERIALIZE */
           PAPF.PERSON_ID
          ,PAPF.PERSON_NUMBER
          ,PPNF.FULL_NAME
          ,PAPF.START_DATE HIRE_DATE
    FROM   PER_ALL_PEOPLE_F PAPF
          ,PER_PERSON_NAMES_F PPNF
          ,PERIOD PER
    WHERE  PAPF.PERSON_ID = PPNF.PERSON_ID
      AND  PAPF.START_DATE BETWEEN PER.START_DATE AND PER.END_DATE
      AND  TRUNC(SYSDATE) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
      AND  PPNF.NAME_TYPE = 'GLOBAL'
      AND  TRUNC(SYSDATE) BETWEEN PPNF.EFFECTIVE_START_DATE AND PPNF.EFFECTIVE_END_DATE
)

-- 3. Basic Salary
,CMP_BASIC_SAL AS (
    SELECT /*+ qb_name(CMP_BASIC) MATERIALIZE */
           PEEF.PERSON_ID
          ,ROUND(TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE) / 12, 2) MONTHLY_BASIC
    FROM   PAY_ELEMENT_TYPES_VL PETV,
           PAY_ELEMENT_ENTRIES_F PEEF,
           PAY_ELEMENT_ENTRY_VALUES_F PEEV,
           PAY_INPUT_VALUES_VL PIVL
    WHERE  PETV.ELEMENT_TYPE_ID = PEEF.ELEMENT_TYPE_ID
      AND  PEEF.ELEMENT_ENTRY_ID = PEEV.ELEMENT_ENTRY_ID
      AND  PEEV.INPUT_VALUE_ID = PIVL.INPUT_VALUE_ID
      AND  PETV.BASE_ELEMENT_NAME = 'Basic'
      AND  UPPER(TRIM(PIVL.NAME)) = 'AMOUNT'
      AND  TRUNC(SYSDATE) BETWEEN TRUNC(PEEF.EFFECTIVE_START_DATE) 
                              AND TRUNC(PEEF.EFFECTIVE_END_DATE)
      AND  TRUNC(SYSDATE) BETWEEN TRUNC(PEEV.EFFECTIVE_START_DATE) 
                              AND TRUNC(PEEV.EFFECTIVE_END_DATE)
)

-- 4. Gross Salary
,CMP_GROSS_SAL AS (
    SELECT /*+ qb_name(CMP_GROSS) MATERIALIZE */
           PEEF.PERSON_ID
          ,SUM(TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE)) GROSS_AMOUNT
    FROM   PAY_ELEMENT_TYPES_VL PETV,
           PAY_ELEMENT_ENTRIES_F PEEF,
           PAY_ELEMENT_ENTRY_VALUES_F PEEV,
           PAY_INPUT_VALUES_VL PIVL,
           PAY_ELE_CLASSIFICATIONS_TL PECT
    WHERE  PETV.ELEMENT_TYPE_ID = PEEF.ELEMENT_TYPE_ID
      AND  PEEF.ELEMENT_ENTRY_ID = PEEV.ELEMENT_ENTRY_ID
      AND  PEEV.INPUT_VALUE_ID = PIVL.INPUT_VALUE_ID
      AND  PETV.CLASSIFICATION_ID = PECT.CLASSIFICATION_ID
      AND  PETV.PROCESSING_TYPE = 'R'
      AND  UPPER(TRIM(PIVL.NAME)) = 'AMOUNT'
      AND  PECT.LANGUAGE = 'US'
      AND  UPPER(PECT.CLASSIFICATION_NAME) LIKE '%EARNING%'
      AND  TRUNC(SYSDATE) BETWEEN TRUNC(PEEF.EFFECTIVE_START_DATE) 
                              AND TRUNC(PEEF.EFFECTIVE_END_DATE)
      AND  TRUNC(SYSDATE) BETWEEN TRUNC(PEEV.EFFECTIVE_START_DATE) 
                              AND TRUNC(PEEV.EFFECTIVE_END_DATE)
    GROUP BY PEEF.PERSON_ID
)

-- 5. Final Select
SELECT NJ.PERSON_NUMBER
      ,NJ.FULL_NAME
      ,TO_CHAR(NJ.HIRE_DATE, 'DD-MON-YYYY') HIRE_DATE
      ,HDORG.NAME DEPARTMENT
      ,PJFT.NAME JOB_NAME
      ,NVL(BS.MONTHLY_BASIC, 0) BASIC_SALARY
      ,NVL(GS.GROSS_AMOUNT, 0) GROSS_SALARY
FROM   NEW_JOINERS NJ
      ,PER_ALL_ASSIGNMENTS_M PAAM
      ,HR_ORGANIZATION_UNITS_F_TL HDORG
      ,PER_JOBS_F PJF
      ,PER_JOBS_F_TL PJFT
      ,CMP_BASIC_SAL BS
      ,CMP_GROSS_SAL GS
WHERE  NJ.PERSON_ID = PAAM.PERSON_ID
  AND  PAAM.ORGANIZATION_ID = HDORG.ORGANIZATION_ID
  AND  PAAM.JOB_ID = PJF.JOB_ID(+)
  AND  PJF.JOB_ID = PJFT.JOB_ID(+)
  AND  NJ.PERSON_ID = BS.PERSON_ID(+)
  AND  NJ.PERSON_ID = GS.PERSON_ID(+)
  AND  PAAM.PRIMARY_FLAG = 'Y'
  AND  PAAM.ASSIGNMENT_TYPE = 'E'
  AND  PAAM.EFFECTIVE_LATEST_CHANGE = 'Y'
  AND  HDORG.LANGUAGE = 'US'
  AND  TRUNC(SYSDATE) BETWEEN HDORG.EFFECTIVE_START_DATE AND HDORG.EFFECTIVE_END_DATE
  AND  PJFT.LANGUAGE(+) = 'US'
  AND  TRUNC(SYSDATE) BETWEEN PJF.EFFECTIVE_START_DATE(+) AND PJF.EFFECTIVE_END_DATE(+)
  AND  TRUNC(SYSDATE) BETWEEN PJFT.EFFECTIVE_START_DATE(+) AND PJFT.EFFECTIVE_END_DATE(+)
ORDER BY NJ.HIRE_DATE, NJ.PERSON_NUMBER
;
```

**Parameters:**
- `:P_START_DATE` - Start date (DD-MM-YYYY)
- `:P_END_DATE` - End date (DD-MM-YYYY)

---

## 3. Compensation by Department Template

**Purpose:** Summary of compensation by department  
**Use Case:** Departmental budgeting, cost analysis

```sql
/*
TITLE: Compensation by Department
PURPOSE: Show total and average compensation by department
AUTHOR: [Your Name]
DATE: [DD-Mon-YYYY]
*/

WITH
-- 1. Period Context
PERIOD AS (
    SELECT /*+ qb_name(PER) MATERIALIZE */
           TRUNC(SYSDATE) EFFECTIVE_DATE
    FROM DUAL
)

-- 2. Gross Salary
,CMP_GROSS_SAL AS (
    SELECT /*+ qb_name(CMP_GROSS) MATERIALIZE */
           PEEF.PERSON_ID
          ,SUM(TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE)) GROSS_AMOUNT
    FROM   PAY_ELEMENT_TYPES_VL PETV,
           PAY_ELEMENT_ENTRIES_F PEEF,
           PAY_ELEMENT_ENTRY_VALUES_F PEEV,
           PAY_INPUT_VALUES_VL PIVL,
           PAY_ELE_CLASSIFICATIONS_TL PECT,
           PERIOD PER
    WHERE  PETV.ELEMENT_TYPE_ID = PEEF.ELEMENT_TYPE_ID
      AND  PEEF.ELEMENT_ENTRY_ID = PEEV.ELEMENT_ENTRY_ID
      AND  PEEV.INPUT_VALUE_ID = PIVL.INPUT_VALUE_ID
      AND  PETV.CLASSIFICATION_ID = PECT.CLASSIFICATION_ID
      AND  PETV.PROCESSING_TYPE = 'R'
      AND  UPPER(TRIM(PIVL.NAME)) = 'AMOUNT'
      AND  PECT.LANGUAGE = 'US'
      AND  UPPER(PECT.CLASSIFICATION_NAME) LIKE '%EARNING%'
      AND  PER.EFFECTIVE_DATE BETWEEN TRUNC(PEEF.EFFECTIVE_START_DATE) 
                                  AND TRUNC(PEEF.EFFECTIVE_END_DATE)
      AND  PER.EFFECTIVE_DATE BETWEEN TRUNC(PEEV.EFFECTIVE_START_DATE) 
                                  AND TRUNC(PEEV.EFFECTIVE_END_DATE)
    GROUP BY PEEF.PERSON_ID
)

-- 3. Department Aggregation
,DEPT_COMP AS (
    SELECT /*+ qb_name(DEPT_C) MATERIALIZE */
           HDORG.NAME DEPARTMENT
          ,COUNT(*) EMPLOYEE_COUNT
          ,ROUND(SUM(GS.GROSS_AMOUNT), 2) TOTAL_GROSS
          ,ROUND(AVG(GS.GROSS_AMOUNT), 2) AVG_GROSS
          ,ROUND(MIN(GS.GROSS_AMOUNT), 2) MIN_GROSS
          ,ROUND(MAX(GS.GROSS_AMOUNT), 2) MAX_GROSS
    FROM   PER_ALL_PEOPLE_F PAPF
          ,PER_ALL_ASSIGNMENTS_M PAAM
          ,HR_ORGANIZATION_UNITS_F_TL HDORG
          ,CMP_GROSS_SAL GS
    WHERE  PAPF.PERSON_ID = PAAM.PERSON_ID
      AND  PAAM.ORGANIZATION_ID = HDORG.ORGANIZATION_ID
      AND  PAPF.PERSON_ID = GS.PERSON_ID
      AND  TRUNC(SYSDATE) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
      AND  PAAM.PRIMARY_FLAG = 'Y'
      AND  PAAM.ASSIGNMENT_TYPE = 'E'
      AND  PAAM.ASSIGNMENT_STATUS_TYPE = 'ACTIVE'
      AND  PAAM.EFFECTIVE_LATEST_CHANGE = 'Y'
      AND  HDORG.LANGUAGE = 'US'
      AND  TRUNC(SYSDATE) BETWEEN HDORG.EFFECTIVE_START_DATE AND HDORG.EFFECTIVE_END_DATE
    GROUP BY HDORG.NAME
)

-- 4. Final Select
SELECT DEPARTMENT
      ,EMPLOYEE_COUNT
      ,TOTAL_GROSS
      ,AVG_GROSS
      ,MIN_GROSS
      ,MAX_GROSS
FROM   DEPT_COMP
ORDER BY TOTAL_GROSS DESC
;
```

**Parameters:** None (uses SYSDATE)

---

## 4. Salary History Template

**Purpose:** Show salary progression for an employee  
**Use Case:** Salary reviews, promotion tracking

```sql
/*
TITLE: Employee Salary History
PURPOSE: Show salary change history for an employee
AUTHOR: [Your Name]
DATE: [DD-Mon-YYYY]
*/

WITH
-- 1. Salary History
CMP_SAL_HIST AS (
    SELECT /*+ qb_name(CMP_HIST) MATERIALIZE */
           PEEF.PERSON_ID
          ,PEEF.EFFECTIVE_START_DATE
          ,PEEF.EFFECTIVE_END_DATE
          ,TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE) ANNUAL_SALARY
          ,ROUND(TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE) / 12, 2) MONTHLY_SALARY
          ,LAG(TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE)) 
               OVER (PARTITION BY PEEF.PERSON_ID ORDER BY PEEF.EFFECTIVE_START_DATE) PREV_ANNUAL_SALARY
          ,TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE) - 
           LAG(TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE)) 
               OVER (PARTITION BY PEEF.PERSON_ID ORDER BY PEEF.EFFECTIVE_START_DATE) SALARY_CHANGE
          ,ROUND(
               ((TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE) - 
                 LAG(TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE)) 
                     OVER (PARTITION BY PEEF.PERSON_ID ORDER BY PEEF.EFFECTIVE_START_DATE)) / 
                NULLIF(LAG(TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE)) 
                           OVER (PARTITION BY PEEF.PERSON_ID ORDER BY PEEF.EFFECTIVE_START_DATE), 0)) * 100,
               2
           ) PERCENT_CHANGE
    FROM   PAY_ELEMENT_TYPES_VL PETV,
           PAY_ELEMENT_ENTRIES_F PEEF,
           PAY_ELEMENT_ENTRY_VALUES_F PEEV,
           PAY_INPUT_VALUES_VL PIVL
    WHERE  PETV.ELEMENT_TYPE_ID = PEEF.ELEMENT_TYPE_ID
      AND  PEEF.ELEMENT_ENTRY_ID = PEEV.ELEMENT_ENTRY_ID
      AND  PEEV.INPUT_VALUE_ID = PIVL.INPUT_VALUE_ID
      AND  PETV.BASE_ELEMENT_NAME = 'Basic'
      AND  UPPER(TRIM(PIVL.NAME)) = 'AMOUNT'
      AND  PEEF.PERSON_ID = (SELECT PERSON_ID FROM PER_ALL_PEOPLE_F 
                             WHERE PERSON_NUMBER = :P_EMP_NO 
                             AND TRUNC(SYSDATE) BETWEEN EFFECTIVE_START_DATE AND EFFECTIVE_END_DATE)
)

-- 2. Final Select
SELECT PAPF.PERSON_NUMBER
      ,PPNF.FULL_NAME
      ,TO_CHAR(SH.EFFECTIVE_START_DATE, 'DD-MON-YYYY') EFFECTIVE_FROM
      ,TO_CHAR(SH.EFFECTIVE_END_DATE, 'DD-MON-YYYY') EFFECTIVE_TO
      ,SH.MONTHLY_SALARY
      ,SH.ANNUAL_SALARY
      ,SH.PREV_ANNUAL_SALARY
      ,NVL(SH.SALARY_CHANGE, 0) SALARY_CHANGE
      ,NVL(SH.PERCENT_CHANGE, 0) PERCENT_CHANGE
FROM   CMP_SAL_HIST SH
      ,PER_ALL_PEOPLE_F PAPF
      ,PER_PERSON_NAMES_F PPNF
WHERE  SH.PERSON_ID = PAPF.PERSON_ID
  AND  PAPF.PERSON_ID = PPNF.PERSON_ID
  AND  TRUNC(SYSDATE) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
  AND  PPNF.NAME_TYPE = 'GLOBAL'
  AND  TRUNC(SYSDATE) BETWEEN PPNF.EFFECTIVE_START_DATE AND PPNF.EFFECTIVE_END_DATE
ORDER BY SH.EFFECTIVE_START_DATE
;
```

**Parameters:**
- `:P_EMP_NO` - Employee number

---

**Last Updated:** 18-Dec-2025  
**Status:** Production-Ready  
**Source:** 2 Production Compensation Queries

