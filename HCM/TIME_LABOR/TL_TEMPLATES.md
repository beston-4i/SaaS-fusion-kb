# Time & Labor Templates

**Module:** Time & Labor (HWM)  
**Tag:** `#HCM #TL #HWM #Templates`  
**Status:** Production-Ready  
**Last Updated:** 18-Dec-2025

---

## Critical Rules

1. **NEVER** start timesheet queries from scratch
2. **ALWAYS** copy these templates as complete skeletons
3. **ALWAYS** include Period CTE → Repository CTE → Calculation → Final SELECT
4. **ALWAYS** use `/*+ qb_name(NAME) */` hints in all CTEs
5. **ALWAYS** use MAX version for attribute usages

---

## 1. Employee Timesheet Report Template

**Purpose:** Comprehensive timesheet report with project, task, approver  
**Use Case:** Timesheet submission reports, approval tracking

```sql
/*
TITLE: Employee Timesheet Report
PURPOSE: Show detailed timesheet entries with project, task, expenditure type, and approval status
AUTHOR: [Your Name]
DATE: [DD-Mon-YYYY]
*/

WITH
-- 1. Period Context
PERIOD AS (
    SELECT /*+ qb_name(PER) MATERIALIZE */
           TO_DATE(:P_START_DATE, 'YYYY-MM-DD') START_DATE
          ,TO_DATE(:P_END_DATE, 'YYYY-MM-DD') END_DATE
    FROM DUAL
)

-- 2. Timesheet Header
,TL_TS_HEADER AS (
    SELECT /*+ qb_name(TL_TS_HDR) MATERIALIZE */
           TMH.TM_REC_GRP_ID
          ,TMH.PERSON_ID
          ,TO_CHAR(TMH.START_TIME, 'DD-MON-YYYY') GRP_START_TIME
          ,TO_CHAR(TMH.STOP_TIME, 'DD-MON-YYYY') GRP_STOP_TIME
          ,TMH.STATUS
          ,NVL(TMH.RECORDED_HOURS, 0) + NVL(TMH.ABSENCE_HOURS, 0) RECORDED_HOURS
          ,TMH.SUBMISSION_DATE
          ,CASE WHEN TMH.STATUS = 'Approved' THEN TMH.LAST_UPDATE_DATE END APPROVAL_DATE
    FROM   HWM_TM_REC_SUMM TMH
          ,PERIOD PER
    WHERE  TMH.STATUS IN ('Approved', 'Submitted')
      AND  TMH.START_TIME >= PER.START_DATE
      AND  TMH.STOP_TIME <= PER.END_DATE
)

-- 3. Timesheet Detail
,TL_TS_DETAIL AS (
    SELECT /*+ qb_name(TL_TS_DTL) MATERIALIZE */
           TMD.TM_REC_ID
          ,TMD.TM_REC_GRP_ID
          ,TMD.TM_REC_GRP_VERSION
          ,TMD.PERSON_ID
          ,TMD.GRP_TYPE_NAME
          ,TMD.TM_REC_TYPE
          ,TO_CHAR(TMD.START_TIME, 'YYYY-MM-DD') START_TIME
          ,TO_CHAR(TMD.STOP_TIME, 'DD-MON-YYYY') STOP_TIME
          ,TMD.MEASURE
          ,TMD.UNIT_OF_MEASURE
    FROM   HWM_TM_REP_HIERARCHIES_VL TMD
          ,PERIOD PER
    WHERE  TMD.START_TIME >= PER.START_DATE
      AND  TMD.STOP_TIME <= PER.END_DATE
)

-- 4. Project Attributes
,TL_PROJ_ATTR AS (
    SELECT /*+ qb_name(TL_PROJ) MATERIALIZE */
           AUSG.USAGES_SOURCE_ID TM_REC_ID
          ,PJP.SEGMENT1 PROJECT_NUMBER
          ,PJP.NAME PROJECT_NAME
          ,PJT.TASK_NUMBER
          ,PJT.TASK_NAME
          ,NVL(PET.EXPENDITURE_TYPE_NAME, ABT.NAME) EXPENDITURE_TYPE
    FROM   HWM_TM_REP_ATRB_USAGES AUSG
          ,HWM_TM_REP_ATRBS ATR
          ,PJF_PROJECTS_ALL_VL PJP
          ,PJF_TASKS_V PJT
          ,PJF_EXP_TYPES_TL PET
          ,ANC_ABSENCE_TYPES_VL ABT
    WHERE  AUSG.TM_REP_ATRB_ID = ATR.TM_REP_ATRB_ID
      AND  ATR.ATTRIBUTE_CATEGORY = 'Projects'
      AND  ATR.ATTRIBUTE_NUMBER1 = PJP.PROJECT_ID(+)
      AND  ATR.ATTRIBUTE_NUMBER2 = PJT.TASK_ID(+)
      AND  ATR.ATTRIBUTE_CATEGORY = TO_CHAR(PET.EXPENDITURE_TYPE_ID(+))
      AND  ATR.ATTRIBUTE_CATEGORY = TO_CHAR(ABT.ABSENCE_TYPE_ID(+))
      AND  PET.LANGUAGE(+) = 'US'
      AND  ABT.LANGUAGE(+) = 'US'
      AND  AUSG.USAGES_SOURCE_VERSION = (
           SELECT MAX(A1.USAGES_SOURCE_VERSION)
           FROM HWM_TM_REP_ATRB_USAGES A1
           WHERE A1.USAGES_SOURCE_ID = AUSG.USAGES_SOURCE_ID
      )
)

-- 5. Line Manager
,TL_LINE_MGR AS (
    SELECT /*+ qb_name(TL_LN_MGR) MATERIALIZE */
           PAPF.PERSON_ID
          ,MGNAME.DISPLAY_NAME LINE_MANAGER_NAME
    FROM   PER_ALL_PEOPLE_F PAPF
          ,PER_ALL_ASSIGNMENTS_M ASG
          ,PER_ASSIGNMENT_SUPERVISORS_F PASF
          ,PER_ALL_ASSIGNMENTS_M MGASG
          ,PER_PERSON_NAMES_F MGNAME
    WHERE  PAPF.PERSON_ID = ASG.PERSON_ID
      AND  ASG.ASSIGNMENT_ID = PASF.ASSIGNMENT_ID
      AND  PASF.MANAGER_ASSIGNMENT_ID = MGASG.ASSIGNMENT_ID
      AND  MGASG.PERSON_ID = MGNAME.PERSON_ID
      AND  PASF.MANAGER_TYPE = 'LINE_MANAGER'
      AND  ASG.PRIMARY_FLAG = 'Y'
      AND  ASG.ASSIGNMENT_TYPE = 'E'
      AND  ASG.EFFECTIVE_LATEST_CHANGE = 'Y'
      AND  MGNAME.NAME_TYPE = 'GLOBAL'
      AND  TRUNC(SYSDATE) BETWEEN ASG.EFFECTIVE_START_DATE AND ASG.EFFECTIVE_END_DATE
      AND  TRUNC(SYSDATE) BETWEEN PASF.EFFECTIVE_START_DATE AND PASF.EFFECTIVE_END_DATE
      AND  TRUNC(SYSDATE) BETWEEN MGNAME.EFFECTIVE_START_DATE AND MGNAME.EFFECTIVE_END_DATE
)

-- 6. Final Select
SELECT PAPF.PERSON_NUMBER
      ,PPNF.FULL_NAME EMPLOYEE_NAME
      ,PLE.NAME LEGAL_ENTITY
      ,HDORG.NAME DEPARTMENT
      ,TSH.GRP_START_TIME
      ,TSH.GRP_STOP_TIME
      ,TSH.STATUS
      ,TSH.RECORDED_HOURS
      ,TSD.PROJECT_NUMBER
      ,TSD.PROJECT_NAME
      ,TSD.TASK_NUMBER
      ,TSD.TASK_NAME
      ,TSD.EXPENDITURE_TYPE
      ,TSD.GRP_TYPE_NAME
      ,TSD.TM_REC_TYPE
      ,TSD.START_TIME
      ,TSD.STOP_TIME
      ,TSD.MEASURE
      ,TSD.UNIT_OF_MEASURE
      ,TO_CHAR(TSH.SUBMISSION_DATE, 'DD-MON-YYYY') SUBMISSION_DATE
      ,TO_CHAR(TSH.APPROVAL_DATE, 'DD-MON-YYYY') APPROVAL_DATE
      ,LM.LINE_MANAGER_NAME APPROVER
FROM   TL_TS_HEADER TSH
      ,TL_TS_DETAIL TSD
      ,TL_PROJ_ATTR PA
      ,TL_LINE_MGR LM
      ,PER_ALL_PEOPLE_F PAPF
      ,PER_PERSON_NAMES_F PPNF
      ,PER_ALL_ASSIGNMENTS_M PAAM
      ,PER_LEGAL_ENTITIES PLE
      ,HR_ORGANIZATION_UNITS_F_TL HDORG
WHERE  TSH.TM_REC_GRP_ID = TSD.TM_REC_GRP_ID
  AND  TSD.TM_REC_ID = PA.TM_REC_ID(+)
  AND  TSH.PERSON_ID = LM.PERSON_ID(+)
  AND  TSH.PERSON_ID = PAPF.PERSON_ID
  AND  PAPF.PERSON_ID = PPNF.PERSON_ID
  AND  PAPF.PERSON_ID = PAAM.PERSON_ID
  AND  PAAM.LEGAL_ENTITY_ID = PLE.ORGANIZATION_ID
  AND  PAAM.ORGANIZATION_ID = HDORG.ORGANIZATION_ID
  AND  TRUNC(SYSDATE) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
  AND  PPNF.NAME_TYPE = 'GLOBAL'
  AND  TRUNC(SYSDATE) BETWEEN PPNF.EFFECTIVE_START_DATE AND PPNF.EFFECTIVE_END_DATE
  AND  PAAM.PRIMARY_FLAG = 'Y'
  AND  PAAM.ASSIGNMENT_TYPE = 'E'
  AND  PAAM.EFFECTIVE_LATEST_CHANGE = 'Y'
  AND  HDORG.LANGUAGE = 'US'
  AND  TRUNC(SYSDATE) BETWEEN HDORG.EFFECTIVE_START_DATE AND HDORG.EFFECTIVE_END_DATE
ORDER BY PAPF.PERSON_NUMBER, TSD.START_TIME
;
```

**Parameters:**
- `:P_START_DATE` - Start date (YYYY-MM-DD)
- `:P_END_DATE` - End date (YYYY-MM-DD)

---

## 2. Missing Timesheet Report Template

**Purpose:** Identify employees who haven't submitted timesheets  
**Use Case:** Timesheet compliance tracking

```sql
/*
TITLE: Missing Timesheet Report
PURPOSE: Show employees without timesheet submissions for a period
AUTHOR: [Your Name]
DATE: [DD-Mon-YYYY]
*/

WITH
-- 1. Period Context
PERIOD AS (
    SELECT /*+ qb_name(PER) MATERIALIZE */
           TO_DATE(:P_START_DATE, 'YYYY-MM-DD') START_DATE
          ,TO_DATE(:P_END_DATE, 'YYYY-MM-DD') END_DATE
    FROM DUAL
)

-- 2. Active Employees
,ACTIVE_EMP AS (
    SELECT /*+ qb_name(ACT_EMP) MATERIALIZE */
           PAPF.PERSON_ID
          ,PAPF.PERSON_NUMBER
          ,PPNF.FULL_NAME
    FROM   PER_ALL_PEOPLE_F PAPF
          ,PER_PERSON_NAMES_F PPNF
          ,PER_ALL_ASSIGNMENTS_M PAAM
    WHERE  PAPF.PERSON_ID = PPNF.PERSON_ID
      AND  PAPF.PERSON_ID = PAAM.PERSON_ID
      AND  TRUNC(SYSDATE) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
      AND  PPNF.NAME_TYPE = 'GLOBAL'
      AND  TRUNC(SYSDATE) BETWEEN PPNF.EFFECTIVE_START_DATE AND PPNF.EFFECTIVE_END_DATE
      AND  PAAM.PRIMARY_FLAG = 'Y'
      AND  PAAM.ASSIGNMENT_TYPE = 'E'
      AND  PAAM.ASSIGNMENT_STATUS_TYPE = 'ACTIVE'
      AND  PAAM.EFFECTIVE_LATEST_CHANGE = 'Y'
)

-- 3. Employees with Timesheets
,EMP_WITH_TS AS (
    SELECT /*+ qb_name(EMP_TS) MATERIALIZE */
           DISTINCT TMH.PERSON_ID
    FROM   HWM_TM_REC_SUMM TMH
          ,PERIOD PER
    WHERE  TMH.STATUS IN ('Approved', 'Submitted')
      AND  TMH.START_TIME >= PER.START_DATE
      AND  TMH.STOP_TIME <= PER.END_DATE
)

-- 4. Final Select (Missing)
SELECT AE.PERSON_NUMBER
      ,AE.FULL_NAME
      ,HDORG.NAME DEPARTMENT
      ,LM.LINE_MANAGER_NAME
      ,'Missing Timesheet' STATUS
FROM   ACTIVE_EMP AE
      ,PER_ALL_ASSIGNMENTS_M PAAM
      ,HR_ORGANIZATION_UNITS_F_TL HDORG
      ,PER_ASSIGNMENT_SUPERVISORS_F PASF
      ,PER_ALL_ASSIGNMENTS_M MGASG
      ,PER_PERSON_NAMES_F LM
WHERE  AE.PERSON_ID = PAAM.PERSON_ID
  AND  PAAM.ORGANIZATION_ID = HDORG.ORGANIZATION_ID
  AND  PAAM.ASSIGNMENT_ID = PASF.ASSIGNMENT_ID(+)
  AND  PASF.MANAGER_ASSIGNMENT_ID = MGASG.ASSIGNMENT_ID(+)
  AND  MGASG.PERSON_ID = LM.PERSON_ID(+)
  AND  PASF.MANAGER_TYPE(+) = 'LINE_MANAGER'
  AND  LM.NAME_TYPE(+) = 'GLOBAL'
  AND  PAAM.PRIMARY_FLAG = 'Y'
  AND  PAAM.ASSIGNMENT_TYPE = 'E'
  AND  PAAM.EFFECTIVE_LATEST_CHANGE = 'Y'
  AND  HDORG.LANGUAGE = 'US'
  AND  TRUNC(SYSDATE) BETWEEN HDORG.EFFECTIVE_START_DATE AND HDORG.EFFECTIVE_END_DATE
  AND  TRUNC(SYSDATE) BETWEEN PASF.EFFECTIVE_START_DATE(+) AND PASF.EFFECTIVE_END_DATE(+)
  AND  TRUNC(SYSDATE) BETWEEN LM.EFFECTIVE_START_DATE(+) AND LM.EFFECTIVE_END_DATE(+)
  AND  NOT EXISTS (
       SELECT 1
       FROM EMP_WITH_TS EWT
       WHERE EWT.PERSON_ID = AE.PERSON_ID
  )
ORDER BY AE.PERSON_NUMBER
;
```

**Parameters:**
- `:P_START_DATE` - Start date (YYYY-MM-DD)
- `:P_END_DATE` - End date (YYYY-MM-DD)

---

## 3. Project Time Summary Template

**Purpose:** Summarize hours by project and task  
**Use Case:** Project costing, resource utilization

```sql
/*
TITLE: Project Time Summary
PURPOSE: Show total hours by project, task, and expenditure type
AUTHOR: [Your Name]
DATE: [DD-Mon-YYYY]
*/

WITH
-- 1. Period Context
PERIOD AS (
    SELECT /*+ qb_name(PER) MATERIALIZE */
           TO_DATE(:P_START_DATE, 'YYYY-MM-DD') START_DATE
          ,TO_DATE(:P_END_DATE, 'YYYY-MM-DD') END_DATE
    FROM DUAL
)

-- 2. Timesheet Data with Projects
,TL_TS_PROJ AS (
    SELECT /*+ qb_name(TL_TS_P) MATERIALIZE */
           TMH.PERSON_ID
          ,PJP.SEGMENT1 PROJECT_NUMBER
          ,PJP.NAME PROJECT_NAME
          ,PJT.TASK_NUMBER
          ,PJT.TASK_NAME
          ,PET.EXPENDITURE_TYPE_NAME
          ,SUM(TMD.MEASURE) TOTAL_HOURS
    FROM   HWM_TM_REC_SUMM TMH
          ,HWM_TM_REP_HIERARCHIES_VL TMD
          ,HWM_TM_REP_ATRB_USAGES AUSG
          ,HWM_TM_REP_ATRBS ATR
          ,PJF_PROJECTS_ALL_VL PJP
          ,PJF_TASKS_V PJT
          ,PJF_EXP_TYPES_TL PET
          ,PERIOD PER
    WHERE  TMH.TM_REC_GRP_ID = TMD.TM_REC_GRP_ID
      AND  TMD.TM_REC_ID = AUSG.USAGES_SOURCE_ID
      AND  AUSG.TM_REP_ATRB_ID = ATR.TM_REP_ATRB_ID
      AND  ATR.ATTRIBUTE_CATEGORY = 'Projects'
      AND  ATR.ATTRIBUTE_NUMBER1 = PJP.PROJECT_ID
      AND  ATR.ATTRIBUTE_NUMBER2 = PJT.TASK_ID(+)
      AND  ATR.ATTRIBUTE_CATEGORY = TO_CHAR(PET.EXPENDITURE_TYPE_ID(+))
      AND  PET.LANGUAGE(+) = 'US'
      AND  TMH.STATUS IN ('Approved', 'Submitted')
      AND  TMH.START_TIME >= PER.START_DATE
      AND  TMH.STOP_TIME <= PER.END_DATE
      AND  AUSG.USAGES_SOURCE_VERSION = (
           SELECT MAX(A1.USAGES_SOURCE_VERSION)
           FROM HWM_TM_REP_ATRB_USAGES A1
           WHERE A1.USAGES_SOURCE_ID = TMD.TM_REC_ID
      )
    GROUP BY TMH.PERSON_ID, PJP.SEGMENT1, PJP.NAME, PJT.TASK_NUMBER, PJT.TASK_NAME, 
             PET.EXPENDITURE_TYPE_NAME
)

-- 3. Final Select
SELECT PAPF.PERSON_NUMBER
      ,PPNF.FULL_NAME
      ,TSP.PROJECT_NUMBER
      ,TSP.PROJECT_NAME
      ,TSP.TASK_NUMBER
      ,TSP.TASK_NAME
      ,TSP.EXPENDITURE_TYPE_NAME
      ,TSP.TOTAL_HOURS
FROM   TL_TS_PROJ TSP
      ,PER_ALL_PEOPLE_F PAPF
      ,PER_PERSON_NAMES_F PPNF
WHERE  TSP.PERSON_ID = PAPF.PERSON_ID
  AND  PAPF.PERSON_ID = PPNF.PERSON_ID
  AND  TRUNC(SYSDATE) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
  AND  PPNF.NAME_TYPE = 'GLOBAL'
  AND  TRUNC(SYSDATE) BETWEEN PPNF.EFFECTIVE_START_DATE AND PPNF.EFFECTIVE_END_DATE
ORDER BY TSP.PROJECT_NUMBER, TSP.TASK_NUMBER, PAPF.PERSON_NUMBER
;
```

**Parameters:**
- `:P_START_DATE` - Start date (YYYY-MM-DD)
- `:P_END_DATE` - End date (YYYY-MM-DD)

---

## 4. Absence Time Summary Template

**Purpose:** Summarize absence hours by absence type  
**Use Case:** Leave tracking, absence analysis

```sql
/*
TITLE: Absence Time Summary
PURPOSE: Show total absence hours by absence type
AUTHOR: [Your Name]
DATE: [DD-Mon-YYYY]
*/

WITH
-- 1. Period Context
PERIOD AS (
    SELECT /*+ qb_name(PER) MATERIALIZE */
           TO_DATE(:P_START_DATE, 'YYYY-MM-DD') START_DATE
          ,TO_DATE(:P_END_DATE, 'YYYY-MM-DD') END_DATE
    FROM DUAL
)

-- 2. Absence Time Data
,TL_ABS_TIME AS (
    SELECT /*+ qb_name(TL_ABS_T) MATERIALIZE */
           TMH.PERSON_ID
          ,ABT.NAME ABSENCE_TYPE
          ,SUM(TMD.MEASURE) TOTAL_HOURS
    FROM   HWM_TM_REC_SUMM TMH
          ,HWM_TM_REP_HIERARCHIES_VL TMD
          ,HWM_TM_REP_ATRB_USAGES AUSG
          ,HWM_TM_REP_ATRBS ATR
          ,ANC_ABSENCE_TYPES_VL ABT
          ,PERIOD PER
    WHERE  TMH.TM_REC_GRP_ID = TMD.TM_REC_GRP_ID
      AND  TMD.TM_REC_ID = AUSG.USAGES_SOURCE_ID
      AND  AUSG.TM_REP_ATRB_ID = ATR.TM_REP_ATRB_ID
      AND  ATR.ATTRIBUTE_CATEGORY = TO_CHAR(ABT.ABSENCE_TYPE_ID)
      AND  ABT.LANGUAGE = 'US'
      AND  TMH.STATUS IN ('Approved', 'Submitted')
      AND  TMH.START_TIME >= PER.START_DATE
      AND  TMH.STOP_TIME <= PER.END_DATE
      AND  AUSG.USAGES_SOURCE_VERSION = (
           SELECT MAX(A1.USAGES_SOURCE_VERSION)
           FROM HWM_TM_REP_ATRB_USAGES A1
           WHERE A1.USAGES_SOURCE_ID = TMD.TM_REC_ID
      )
    GROUP BY TMH.PERSON_ID, ABT.NAME
)

-- 3. Final Select
SELECT PAPF.PERSON_NUMBER
      ,PPNF.FULL_NAME
      ,HDORG.NAME DEPARTMENT
      ,ABT.ABSENCE_TYPE
      ,ABT.TOTAL_HOURS
FROM   TL_ABS_TIME ABT
      ,PER_ALL_PEOPLE_F PAPF
      ,PER_PERSON_NAMES_F PPNF
      ,PER_ALL_ASSIGNMENTS_M PAAM
      ,HR_ORGANIZATION_UNITS_F_TL HDORG
WHERE  ABT.PERSON_ID = PAPF.PERSON_ID
  AND  PAPF.PERSON_ID = PPNF.PERSON_ID
  AND  PAPF.PERSON_ID = PAAM.PERSON_ID
  AND  PAAM.ORGANIZATION_ID = HDORG.ORGANIZATION_ID
  AND  TRUNC(SYSDATE) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
  AND  PPNF.NAME_TYPE = 'GLOBAL'
  AND  TRUNC(SYSDATE) BETWEEN PPNF.EFFECTIVE_START_DATE AND PPNF.EFFECTIVE_END_DATE
  AND  PAAM.PRIMARY_FLAG = 'Y'
  AND  PAAM.ASSIGNMENT_TYPE = 'E'
  AND  PAAM.EFFECTIVE_LATEST_CHANGE = 'Y'
  AND  HDORG.LANGUAGE = 'US'
  AND  TRUNC(SYSDATE) BETWEEN HDORG.EFFECTIVE_START_DATE AND HDORG.EFFECTIVE_END_DATE
ORDER BY PAPF.PERSON_NUMBER, ABT.ABSENCE_TYPE
;
```

**Parameters:**
- `:P_START_DATE` - Start date (YYYY-MM-DD)
- `:P_END_DATE` - End date (YYYY-MM-DD)

---

**Last Updated:** 18-Dec-2025  
**Status:** Production-Ready  
**Source:** Employee Timesheet Report (980 lines analyzed)

