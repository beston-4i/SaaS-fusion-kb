# Payroll Templates

**Module:** Global Payroll  
**Tag:** `#HCM #PAY #Templates`  
**Status:** Production-Ready  
**Last Updated:** 18-Dec-2025

---

## Critical Rules

1. **NEVER** start payroll queries from scratch
2. **ALWAYS** copy these templates as complete skeletons
3. **ALWAYS** include Period CTE → Repository CTE → Calculation → Final SELECT
4. **ALWAYS** use `/*+ qb_name(NAME) */` hints in all CTEs

---

## 1. Payslip Report Template

**Purpose:** Individual employee payslip with earnings, deductions, net pay  
**Use Case:** Payslip generation, employee inquiry

```sql
/*
TITLE: Payslip Report
PURPOSE: Show detailed earnings and deductions for employees
AUTHOR: [Your Name]
DATE: [DD-Mon-YYYY]
*/

WITH
-- 1. Period Context
PERIOD AS (
    SELECT /*+ qb_name(PER) MATERIALIZE */
           :P_PERIOD_END PERIOD_END_DATE
    FROM DUAL
)

-- 2. Run Results
,PAY_RESULTS AS (
    SELECT /*+ qb_name(PAY_RES) MATERIALIZE */
           PPRD.PERSON_ID
          ,PETT.ELEMENT_NAME
          ,PECT.CLASSIFICATION_NAME
          ,PEC.BASE_CLASSIFICATION_NAME
          ,SUM(TO_NUMBER(PRRV.RESULT_VALUE)) AMOUNT
    FROM   PAY_PAYROLL_ACTIONS PPA
          ,PAY_PAYROLL_REL_ACTIONS PPRA
          ,PAY_RUN_RESULTS PRR
          ,PAY_RUN_RESULT_VALUES PRRV
          ,PAY_PAY_RELATIONSHIPS_DN PPRD
          ,PAY_ELEMENT_TYPES_F PETF
          ,PAY_ELEMENT_TYPES_TL PETT
          ,PAY_INPUT_VALUES_F PIVF
          ,PAY_ELE_CLASSIFICATIONS PEC
          ,PAY_ELE_CLASSIFICATIONS_TL PECT
          ,PERIOD PER
    WHERE  PPRA.PAYROLL_ACTION_ID = PPA.PAYROLL_ACTION_ID
      AND  PRR.PAYROLL_REL_ACTION_ID = PPRA.PAYROLL_REL_ACTION_ID
      AND  PRRV.RUN_RESULT_ID = PRR.RUN_RESULT_ID
      AND  PPRA.PAYROLL_RELATIONSHIP_ID = PPRD.PAYROLL_RELATIONSHIP_ID
      AND  PPA.ACTION_TYPE IN ('Q', 'R')
      AND  PPA.ACTION_STATUS IN ('C')
      AND  PETF.ELEMENT_TYPE_ID = PRR.ELEMENT_TYPE_ID
      AND  PETF.ELEMENT_TYPE_ID = PETT.ELEMENT_TYPE_ID
      AND  PIVF.ELEMENT_TYPE_ID = PETF.ELEMENT_TYPE_ID
      AND  PIVF.INPUT_VALUE_ID = PRRV.INPUT_VALUE_ID
      AND  PPRA.RETRO_COMPONENT_ID IS NULL
      AND  PETF.CLASSIFICATION_ID = PEC.CLASSIFICATION_ID
      AND  PETF.CLASSIFICATION_ID = PECT.CLASSIFICATION_ID
      AND  PETT.LANGUAGE = 'US'
      AND  PECT.LANGUAGE = 'US'
      AND  PIVF.BASE_NAME = 'Pay Value'
      AND  TRUNC(LAST_DAY(PPA.EFFECTIVE_DATE)) = PER.PERIOD_END_DATE
    GROUP BY PPRD.PERSON_ID, PETT.ELEMENT_NAME, PECT.CLASSIFICATION_NAME, 
             PEC.BASE_CLASSIFICATION_NAME
)

-- 3. Aggregated Totals
,PAY_TOTALS AS (
    SELECT /*+ qb_name(PAY_TOT) MATERIALIZE */
           PERSON_ID
          ,SUM(CASE WHEN BASE_CLASSIFICATION_NAME IN ('Standard Earnings')
                    THEN AMOUNT END) TOTAL_EARNINGS
          ,SUM(CASE WHEN BASE_CLASSIFICATION_NAME IN ('Voluntary Deductions')
                    THEN AMOUNT END) TOTAL_DEDUCTIONS
          ,(SUM(CASE WHEN BASE_CLASSIFICATION_NAME IN ('Standard Earnings')
                     THEN AMOUNT END) -
            SUM(CASE WHEN BASE_CLASSIFICATION_NAME IN ('Voluntary Deductions')
                     THEN AMOUNT END)) NET_PAY
    FROM   PAY_RESULTS
    GROUP BY PERSON_ID
)

-- 4. Final Select
SELECT PAPF.PERSON_NUMBER
      ,PPNF.FULL_NAME
      ,PLE.NAME LEGAL_ENTITY
      ,HDORG.NAME DEPARTMENT
      ,PJF.NAME JOB_NAME
      ,PRE.ELEMENT_NAME
      ,PRE.CLASSIFICATION_NAME
      ,PRE.AMOUNT ELEMENT_AMOUNT
      ,PT.TOTAL_EARNINGS
      ,PT.TOTAL_DEDUCTIONS
      ,PT.NET_PAY
FROM   PAY_RESULTS PRE
      ,PAY_TOTALS PT
      ,PER_ALL_PEOPLE_F PAPF
      ,PER_PERSON_NAMES_F PPNF
      ,PER_ALL_ASSIGNMENTS_M PAAM
      ,PER_LEGAL_ENTITIES PLE
      ,HR_ORGANIZATION_UNITS_F_TL HDORG
      ,PER_JOBS_F PJF
WHERE  PRE.PERSON_ID = PT.PERSON_ID
  AND  PRE.PERSON_ID = PAPF.PERSON_ID
  AND  PAPF.PERSON_ID = PPNF.PERSON_ID
  AND  PAPF.PERSON_ID = PAAM.PERSON_ID
  AND  PAAM.LEGAL_ENTITY_ID = PLE.ORGANIZATION_ID
  AND  PAAM.ORGANIZATION_ID = HDORG.ORGANIZATION_ID
  AND  PAAM.JOB_ID = PJF.JOB_ID(+)
  AND  TRUNC(SYSDATE) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
  AND  PPNF.NAME_TYPE = 'GLOBAL'
  AND  TRUNC(SYSDATE) BETWEEN PPNF.EFFECTIVE_START_DATE AND PPNF.EFFECTIVE_END_DATE
  AND  PAAM.PRIMARY_FLAG = 'Y'
  AND  PAAM.ASSIGNMENT_TYPE = 'E'
  AND  PAAM.EFFECTIVE_LATEST_CHANGE = 'Y'
  AND  TRUNC(SYSDATE) BETWEEN PAAM.EFFECTIVE_START_DATE AND PAAM.EFFECTIVE_END_DATE
  AND  HDORG.LANGUAGE = 'US'
  AND  TRUNC(SYSDATE) BETWEEN HDORG.EFFECTIVE_START_DATE AND HDORG.EFFECTIVE_END_DATE
  AND  TRUNC(SYSDATE) BETWEEN PJF.EFFECTIVE_START_DATE(+) AND PJF.EFFECTIVE_END_DATE(+)
ORDER BY PAPF.PERSON_NUMBER, 
         CASE PRE.BASE_CLASSIFICATION_NAME 
            WHEN 'Standard Earnings' THEN 1 
            WHEN 'Voluntary Deductions' THEN 2 
            ELSE 3 END,
         PRE.ELEMENT_NAME
;
```

**Parameters:**
- `:P_PERIOD_END` - End date of period (e.g., 31-DEC-2024)

---

## 2. Element Register Template

**Purpose:** Register of specific payroll element (e.g., Basic Salary, Overtime)  
**Use Case:** Element-specific audits

```sql
/*
TITLE: Payroll Element Register
PURPOSE: Show specific element values by person for a period
AUTHOR: [Your Name]
DATE: [DD-Mon-YYYY]
*/

WITH
-- 1. Period Context
PERIOD AS (
    SELECT /*+ qb_name(PER) MATERIALIZE */
           :P_PERIOD_END PERIOD_END_DATE
    FROM DUAL
)

-- 2. Element Results
,ELEMENT_RESULTS AS (
    SELECT /*+ qb_name(ELEM_RES) MATERIALIZE */
           PPRD.PERSON_ID
          ,PETT.ELEMENT_NAME
          ,SUM(TO_NUMBER(PRRV.RESULT_VALUE)) AMOUNT
    FROM   PAY_PAYROLL_ACTIONS PPA
          ,PAY_PAYROLL_REL_ACTIONS PPRA
          ,PAY_RUN_RESULTS PRR
          ,PAY_RUN_RESULT_VALUES PRRV
          ,PAY_PAY_RELATIONSHIPS_DN PPRD
          ,PAY_ELEMENT_TYPES_F PETF
          ,PAY_ELEMENT_TYPES_TL PETT
          ,PAY_INPUT_VALUES_F PIVF
          ,PERIOD PER
    WHERE  PPRA.PAYROLL_ACTION_ID = PPA.PAYROLL_ACTION_ID
      AND  PRR.PAYROLL_REL_ACTION_ID = PPRA.PAYROLL_REL_ACTION_ID
      AND  PRRV.RUN_RESULT_ID = PRR.RUN_RESULT_ID
      AND  PPRA.PAYROLL_RELATIONSHIP_ID = PPRD.PAYROLL_RELATIONSHIP_ID
      AND  PPA.ACTION_TYPE IN ('Q', 'R')
      AND  PPA.ACTION_STATUS IN ('C')
      AND  PETF.ELEMENT_TYPE_ID = PRR.ELEMENT_TYPE_ID
      AND  PETF.ELEMENT_TYPE_ID = PETT.ELEMENT_TYPE_ID
      AND  PIVF.ELEMENT_TYPE_ID = PETF.ELEMENT_TYPE_ID
      AND  PIVF.INPUT_VALUE_ID = PRRV.INPUT_VALUE_ID
      AND  PPRA.RETRO_COMPONENT_ID IS NULL
      AND  PETT.LANGUAGE = 'US'
      AND  PIVF.BASE_NAME = 'Pay Value'
      AND  TRUNC(LAST_DAY(PPA.EFFECTIVE_DATE)) = PER.PERIOD_END_DATE
      AND  PETF.BASE_ELEMENT_NAME = :P_ELEMENT_NAME  -- 'Basic', 'Normal Overtime', etc.
    GROUP BY PPRD.PERSON_ID, PETT.ELEMENT_NAME
)

-- 3. Final Select
SELECT PAPF.PERSON_NUMBER
      ,PPNF.FULL_NAME
      ,HDORG.NAME DEPARTMENT
      ,ER.ELEMENT_NAME
      ,ER.AMOUNT
FROM   ELEMENT_RESULTS ER
      ,PER_ALL_PEOPLE_F PAPF
      ,PER_PERSON_NAMES_F PPNF
      ,PER_ALL_ASSIGNMENTS_M PAAM
      ,HR_ORGANIZATION_UNITS_F_TL HDORG
WHERE  ER.PERSON_ID = PAPF.PERSON_ID
  AND  PAPF.PERSON_ID = PPNF.PERSON_ID
  AND  PAPF.PERSON_ID = PAAM.PERSON_ID
  AND  PAAM.ORGANIZATION_ID = HDORG.ORGANIZATION_ID
  AND  TRUNC(SYSDATE) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
  AND  PPNF.NAME_TYPE = 'GLOBAL'
  AND  TRUNC(SYSDATE) BETWEEN PPNF.EFFECTIVE_START_DATE AND PPNF.EFFECTIVE_END_DATE
  AND  PAAM.PRIMARY_FLAG = 'Y'
  AND  PAAM.ASSIGNMENT_TYPE = 'E'
  AND  PAAM.EFFECTIVE_LATEST_CHANGE = 'Y'
  AND  HDORG.LANGUAGE = 'US'
  AND  TRUNC(SYSDATE) BETWEEN HDORG.EFFECTIVE_START_DATE AND HDORG.EFFECTIVE_END_DATE
ORDER BY PAPF.PERSON_NUMBER
;
```

**Parameters:**
- `:P_PERIOD_END` - End date of period
- `:P_ELEMENT_NAME` - Element name to filter (e.g., 'Basic', 'Housing Allowance')

---

## 3. CTC (Cost to Company) Template

**Purpose:** Comprehensive compensation breakdown with accruals  
**Use Case:** CTC reconciliation, compensation reports

```sql
/*
TITLE: Cost to Company (CTC) Report
PURPOSE: Show total compensation including earnings, deductions, and accruals
AUTHOR: [Your Name]
DATE: [DD-Mon-YYYY]
*/

WITH
-- 1. Period Context
PERIOD AS (
    SELECT /*+ qb_name(PER) MATERIALIZE */
           :P_PERIOD_END PERIOD_END_DATE
    FROM DUAL
)

-- 2. Basic Salary (from Element Entries)
,BASIC_SALARY AS (
    SELECT /*+ qb_name(BASIC) MATERIALIZE */
           PEEF.PERSON_ID
          ,ROUND(TO_NUMBER(PEEV.SCREEN_ENTRY_VALUE) / 12, 2) MONTHLY_BASIC
    FROM   PAY_ELEMENT_TYPES_VL PETV
          ,PAY_ELEMENT_ENTRIES_F PEEF
          ,PAY_ELEMENT_ENTRY_VALUES_F PEEV
          ,PAY_INPUT_VALUES_VL PIVL
          ,PERIOD PER
    WHERE  PETV.ELEMENT_TYPE_ID = PEEF.ELEMENT_TYPE_ID
      AND  PEEF.ELEMENT_ENTRY_ID = PEEV.ELEMENT_ENTRY_ID
      AND  PEEV.INPUT_VALUE_ID = PIVL.INPUT_VALUE_ID
      AND  PETV.BASE_ELEMENT_NAME = 'Basic'
      AND  UPPER(TRIM(PIVL.NAME)) = 'AMOUNT'
      AND  PER.PERIOD_END_DATE BETWEEN TRUNC(PEEF.EFFECTIVE_START_DATE) 
                                   AND TRUNC(PEEF.EFFECTIVE_END_DATE)
      AND  PER.PERIOD_END_DATE BETWEEN TRUNC(PEEV.EFFECTIVE_START_DATE) 
                                   AND TRUNC(PEEV.EFFECTIVE_END_DATE)
)

-- 3. Payroll Results
,PAY_RESULTS AS (
    SELECT /*+ qb_name(PAY_RES) MATERIALIZE */
           PPRD.PERSON_ID
          ,SUM(CASE WHEN PETF.BASE_ELEMENT_NAME = 'Basic' 
                    THEN TO_NUMBER(PRRV.RESULT_VALUE) END) BASIC_PAY
          ,SUM(CASE WHEN PETF.BASE_ELEMENT_NAME = 'Housing Allowance' 
                    THEN TO_NUMBER(PRRV.RESULT_VALUE) END) HRA
          ,SUM(CASE WHEN PETF.BASE_ELEMENT_NAME = 'Transport Allowance' 
                    THEN TO_NUMBER(PRRV.RESULT_VALUE) END) TRANSPORT
          ,SUM(CASE WHEN PETF.BASE_ELEMENT_NAME = 'Food Allowance' 
                    THEN TO_NUMBER(PRRV.RESULT_VALUE) END) FOOD
          ,SUM(CASE WHEN PETF.BASE_ELEMENT_NAME = 'Mobile Allowance' 
                    THEN TO_NUMBER(PRRV.RESULT_VALUE) END) MOBILE
          ,SUM(CASE WHEN PETF.BASE_ELEMENT_NAME = 'Other Allowance' 
                    THEN TO_NUMBER(PRRV.RESULT_VALUE) END) OTHER_ALLOWANCE
          ,SUM(CASE WHEN PEC.BASE_CLASSIFICATION_NAME IN ('Standard Earnings') 
                    THEN TO_NUMBER(PRRV.RESULT_VALUE) END) TOTAL_EARNINGS
          ,SUM(CASE WHEN PEC.BASE_CLASSIFICATION_NAME IN ('Voluntary Deductions') 
                    THEN TO_NUMBER(PRRV.RESULT_VALUE) END) TOTAL_DEDUCTIONS
    FROM   PAY_PAYROLL_ACTIONS PPA
          ,PAY_PAYROLL_REL_ACTIONS PPRA
          ,PAY_RUN_RESULTS PRR
          ,PAY_RUN_RESULT_VALUES PRRV
          ,PAY_PAY_RELATIONSHIPS_DN PPRD
          ,PAY_ELEMENT_TYPES_F PETF
          ,PAY_INPUT_VALUES_F PIVF
          ,PAY_ELE_CLASSIFICATIONS PEC
          ,PERIOD PER
    WHERE  PPRA.PAYROLL_ACTION_ID = PPA.PAYROLL_ACTION_ID
      AND  PRR.PAYROLL_REL_ACTION_ID = PPRA.PAYROLL_REL_ACTION_ID
      AND  PRRV.RUN_RESULT_ID = PRR.RUN_RESULT_ID
      AND  PPRA.PAYROLL_RELATIONSHIP_ID = PPRD.PAYROLL_RELATIONSHIP_ID
      AND  PPA.ACTION_TYPE IN ('Q', 'R')
      AND  PPA.ACTION_STATUS IN ('C')
      AND  PETF.ELEMENT_TYPE_ID = PRR.ELEMENT_TYPE_ID
      AND  PIVF.ELEMENT_TYPE_ID = PETF.ELEMENT_TYPE_ID
      AND  PIVF.INPUT_VALUE_ID = PRRV.INPUT_VALUE_ID
      AND  PPRA.RETRO_COMPONENT_ID IS NULL
      AND  PETF.CLASSIFICATION_ID = PEC.CLASSIFICATION_ID
      AND  PIVF.BASE_NAME = 'Pay Value'
      AND  TRUNC(LAST_DAY(PPA.EFFECTIVE_DATE)) = PER.PERIOD_END_DATE
    GROUP BY PPRD.PERSON_ID
)

-- 4. Accrual Provisions
,ACCRUAL_PROV AS (
    SELECT /*+ qb_name(ACCR) MATERIALIZE */
           PPRD.PERSON_ID
          ,SUM(CASE WHEN PETT.ELEMENT_NAME = 'Person Air Ticket Accrual' 
                    THEN TO_NUMBER(PRRV.RESULT_VALUE) END) PERSON_AIR_TICKET
          ,SUM(CASE WHEN PETT.ELEMENT_NAME = 'Spouse Air Ticket Accruals' 
                    THEN TO_NUMBER(PRRV.RESULT_VALUE) END) SPOUSE_AIR_TICKET
          ,SUM(CASE WHEN PETT.ELEMENT_NAME = 'Child Air Ticket Accruals' 
                    THEN TO_NUMBER(PRRV.RESULT_VALUE) END) CHILD_AIR_TICKET
    FROM   PAY_PAYROLL_ACTIONS PPA
          ,PAY_PAYROLL_REL_ACTIONS PPRA
          ,PAY_RUN_RESULTS PRR
          ,PAY_RUN_RESULT_VALUES PRRV
          ,PAY_PAY_RELATIONSHIPS_DN PPRD
          ,PAY_ELEMENT_TYPES_F PETF
          ,PAY_ELEMENT_TYPES_TL PETT
          ,PAY_INPUT_VALUES_F PIVF
          ,PERIOD PER
    WHERE  PPRA.PAYROLL_ACTION_ID = PPA.PAYROLL_ACTION_ID
      AND  PRR.PAYROLL_REL_ACTION_ID = PPRA.PAYROLL_REL_ACTION_ID
      AND  PRRV.RUN_RESULT_ID = PRR.RUN_RESULT_ID
      AND  PPRA.PAYROLL_RELATIONSHIP_ID = PPRD.PAYROLL_RELATIONSHIP_ID
      AND  PPA.ACTION_TYPE IN ('Q', 'R')
      AND  PPA.ACTION_STATUS IN ('C')
      AND  PETF.ELEMENT_TYPE_ID = PRR.ELEMENT_TYPE_ID
      AND  PETF.ELEMENT_TYPE_ID = PETT.ELEMENT_TYPE_ID
      AND  PIVF.ELEMENT_TYPE_ID = PETF.ELEMENT_TYPE_ID
      AND  PIVF.INPUT_VALUE_ID = PRRV.INPUT_VALUE_ID
      AND  PPRA.RETRO_COMPONENT_ID IS NULL
      AND  PETT.LANGUAGE = 'US'
      AND  PIVF.BASE_NAME = 'Pay Value'
      AND  TRUNC(LAST_DAY(PPA.EFFECTIVE_DATE)) = PER.PERIOD_END_DATE
    GROUP BY PPRD.PERSON_ID
)

-- 5. Gratuity Accrual
,GRATUITY_ACC AS (
    SELECT /*+ qb_name(GRAT) MATERIALIZE */
           PPRD.PERSON_ID
          ,SUM(CASE WHEN PETFT.REPORTING_NAME = 'Gratuity Accrual' 
                    AND PIVTFB.NAME = 'Monthly Amount' 
                    THEN TO_NUMBER(PRRVB.RESULT_VALUE) END) GRATUITY_MONTHLY
    FROM   PAY_PAYROLL_ACTIONS PPA
          ,PAY_PAYROLL_REL_ACTIONS PPRA
          ,PAY_RUN_RESULTS PRRB
          ,PAY_RUN_RESULT_VALUES PRRVB
          ,PAY_PAY_RELATIONSHIPS_DN PPRD
          ,PAY_ELEMENT_TYPES_F PETFB
          ,PAY_ELEMENT_TYPES_TL PETFT
          ,PAY_INPUT_VALUES_F PIVFB
          ,PAY_INPUT_VALUES_TL PIVTFB
          ,PERIOD PER
    WHERE  PPRA.PAYROLL_ACTION_ID = PPA.PAYROLL_ACTION_ID
      AND  PRRB.PAYROLL_REL_ACTION_ID = PPRA.PAYROLL_REL_ACTION_ID
      AND  PRRVB.RUN_RESULT_ID = PRRB.RUN_RESULT_ID
      AND  PPRA.PAYROLL_RELATIONSHIP_ID = PPRD.PAYROLL_RELATIONSHIP_ID
      AND  PPA.ACTION_TYPE IN ('Q', 'R')
      AND  PPA.ACTION_STATUS IN ('C')
      AND  PETFB.ELEMENT_TYPE_ID = PRRB.ELEMENT_TYPE_ID
      AND  PETFB.ELEMENT_TYPE_ID = PETFT.ELEMENT_TYPE_ID
      AND  PIVFB.ELEMENT_TYPE_ID = PETFB.ELEMENT_TYPE_ID
      AND  PIVFB.INPUT_VALUE_ID = PRRVB.INPUT_VALUE_ID
      AND  PIVFB.INPUT_VALUE_ID = PIVTFB.INPUT_VALUE_ID
      AND  PPRA.RETRO_COMPONENT_ID IS NULL
      AND  PETFT.LANGUAGE = 'US'
      AND  PIVTFB.LANGUAGE = 'US'
      AND  PETFT.REPORTING_NAME = 'Gratuity Accrual'
      AND  TRUNC(LAST_DAY(PPA.EFFECTIVE_DATE)) = PER.PERIOD_END_DATE
    GROUP BY PPRD.PERSON_ID
)

-- 6. Final Select
SELECT PAPF.PERSON_NUMBER
      ,PPNF.FULL_NAME
      ,TO_CHAR(PAPF.START_DATE, 'DD-MON-YYYY') HIRE_DATE
      ,HDORG.NAME DEPARTMENT
      ,PJF.NAME JOB_NAME
      ,BS.MONTHLY_BASIC BASIC_SALARY
      ,NVL(PR.BASIC_PAY, 0) BASIC_PAY
      ,NVL(PR.HRA, 0) HRA
      ,NVL(PR.TRANSPORT, 0) TRANSPORT_ALLOWANCE
      ,NVL(PR.FOOD, 0) FOOD_ALLOWANCE
      ,NVL(PR.MOBILE, 0) MOBILE_ALLOWANCE
      ,NVL(PR.OTHER_ALLOWANCE, 0) OTHER_ALLOWANCE
      ,NVL(PR.TOTAL_EARNINGS, 0) TOTAL_EARNINGS
      ,NVL(PR.TOTAL_DEDUCTIONS, 0) TOTAL_DEDUCTIONS
      ,(NVL(PR.TOTAL_EARNINGS, 0) - NVL(PR.TOTAL_DEDUCTIONS, 0)) NET_SALARY
      ,NVL(AP.PERSON_AIR_TICKET, 0) PERSON_AIR_TICKET_PROV
      ,NVL(AP.SPOUSE_AIR_TICKET, 0) SPOUSE_AIR_TICKET_PROV
      ,NVL(AP.CHILD_AIR_TICKET, 0) CHILD_AIR_TICKET_PROV
      ,NVL(GA.GRATUITY_MONTHLY, 0) GRATUITY_LIABILITY
      ,(NVL(PR.TOTAL_EARNINGS, 0) - NVL(PR.TOTAL_DEDUCTIONS, 0) +
        NVL(AP.PERSON_AIR_TICKET, 0) + NVL(AP.SPOUSE_AIR_TICKET, 0) + 
        NVL(AP.CHILD_AIR_TICKET, 0) + NVL(GA.GRATUITY_MONTHLY, 0)) TOTAL_COST
FROM   PER_ALL_PEOPLE_F PAPF
      ,PER_PERSON_NAMES_F PPNF
      ,PER_ALL_ASSIGNMENTS_M PAAM
      ,HR_ORGANIZATION_UNITS_F_TL HDORG
      ,PER_JOBS_F PJF
      ,BASIC_SALARY BS
      ,PAY_RESULTS PR
      ,ACCRUAL_PROV AP
      ,GRATUITY_ACC GA
WHERE  PAPF.PERSON_ID = PPNF.PERSON_ID
  AND  PAPF.PERSON_ID = PAAM.PERSON_ID
  AND  PAAM.ORGANIZATION_ID = HDORG.ORGANIZATION_ID
  AND  PAAM.JOB_ID = PJF.JOB_ID(+)
  AND  PAPF.PERSON_ID = BS.PERSON_ID(+)
  AND  PAPF.PERSON_ID = PR.PERSON_ID(+)
  AND  PAPF.PERSON_ID = AP.PERSON_ID(+)
  AND  PAPF.PERSON_ID = GA.PERSON_ID(+)
  AND  TRUNC(SYSDATE) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
  AND  PPNF.NAME_TYPE = 'GLOBAL'
  AND  TRUNC(SYSDATE) BETWEEN PPNF.EFFECTIVE_START_DATE AND PPNF.EFFECTIVE_END_DATE
  AND  PAAM.PRIMARY_FLAG = 'Y'
  AND  PAAM.ASSIGNMENT_TYPE = 'E'
  AND  PAAM.EFFECTIVE_LATEST_CHANGE = 'Y'
  AND  HDORG.LANGUAGE = 'US'
  AND  TRUNC(SYSDATE) BETWEEN HDORG.EFFECTIVE_START_DATE AND HDORG.EFFECTIVE_END_DATE
  AND  TRUNC(SYSDATE) BETWEEN PJF.EFFECTIVE_START_DATE(+) AND PJF.EFFECTIVE_END_DATE(+)
ORDER BY PAPF.PERSON_NUMBER
;
```

**Parameters:**
- `:P_PERIOD_END` - End date of period

---

## 4. Accrual Detail Template

**Purpose:** Detailed accrual breakdown (Gratuity, Leave)  
**Use Case:** Accrual reconciliation, audit reports

```sql
/*
TITLE: Accrual Detail Report
PURPOSE: Show monthly and YTD accrual details for gratuity and leave
AUTHOR: [Your Name]
DATE: [DD-Mon-YYYY]
*/

WITH
-- 1. Period Context
PERIOD AS (
    SELECT /*+ qb_name(PER) MATERIALIZE */
           TO_DATE(:P_PERIOD, 'YYYY-MM-DD') PERIOD_END_DATE
    FROM DUAL
)

-- 2. Gratuity Accrual Details
,GRATUITY_DETAILS AS (
    SELECT /*+ qb_name(GRAT_DTL) MATERIALIZE */
           PPRD.PERSON_ID
          ,SUM(CASE WHEN PETFT.REPORTING_NAME = 'Gratuity Accrual' 
                    AND PIVTFB.NAME = 'Total Unpaid Leave Days' 
                    THEN TO_NUMBER(PRRVB.RESULT_VALUE) END) UNPAID_LEAVE_DAYS
          ,SUM(CASE WHEN PETFT.REPORTING_NAME = 'Gratuity Accrual' 
                    AND PIVTFB.NAME = 'Total Seniority Days' 
                    THEN TO_NUMBER(PRRVB.RESULT_VALUE) END) SENIORITY_DAYS
          ,SUM(CASE WHEN PETFT.REPORTING_NAME = 'Gratuity Accrual' 
                    AND PIVTFB.NAME = 'Service Days' 
                    THEN TO_NUMBER(PRRVB.RESULT_VALUE) END) SERVICE_DAYS
          ,SUM(CASE WHEN PETFT.REPORTING_NAME = 'Gratuity Accrual' 
                    AND PIVTFB.NAME = 'Monthly Days' 
                    THEN TO_NUMBER(PRRVB.RESULT_VALUE) END) MONTHLY_DAYS_ACC_G
          ,SUM(CASE WHEN PETFT.REPORTING_NAME = 'Gratuity Accrual' 
                    AND PIVTFB.NAME = 'Monthly Amount' 
                    THEN TO_NUMBER(PRRVB.RESULT_VALUE) END) MONTHLY_AMOUNT_ACC_G
          ,SUM(CASE WHEN PETFT.REPORTING_NAME = 'Gratuity Accrual Payment' 
                    AND PIVTFB.NAME = 'Days' 
                    THEN TO_NUMBER(PRRVB.RESULT_VALUE) END) DAYS_PAID
          ,SUM(CASE WHEN PETFT.REPORTING_NAME = 'Gratuity Accrual Payment' 
                    AND PIVTFB.NAME = 'Pay Value' 
                    THEN TO_NUMBER(PRRVB.RESULT_VALUE) END) AMOUNT_PAID
    FROM   PAY_PAYROLL_ACTIONS PPA
          ,PAY_PAYROLL_REL_ACTIONS PPRA
          ,PAY_RUN_RESULTS PRRB
          ,PAY_RUN_RESULT_VALUES PRRVB
          ,PAY_PAY_RELATIONSHIPS_DN PPRD
          ,PAY_ELEMENT_TYPES_F PETFB
          ,PAY_ELEMENT_TYPES_TL PETFT
          ,PAY_INPUT_VALUES_F PIVFB
          ,PAY_INPUT_VALUES_TL PIVTFB
          ,PAY_TIME_PERIODS PTP
          ,PERIOD PER
    WHERE  PPRA.PAYROLL_ACTION_ID = PPA.PAYROLL_ACTION_ID
      AND  PRRB.PAYROLL_REL_ACTION_ID = PPRA.PAYROLL_REL_ACTION_ID
      AND  PRRVB.RUN_RESULT_ID = PRRB.RUN_RESULT_ID
      AND  PPRA.PAYROLL_RELATIONSHIP_ID = PPRD.PAYROLL_RELATIONSHIP_ID
      AND  PPA.ACTION_TYPE IN ('Q', 'R')
      AND  PPA.ACTION_STATUS IN ('C')
      AND  PPA.EARN_TIME_PERIOD_ID = PTP.TIME_PERIOD_ID
      AND  PETFB.ELEMENT_TYPE_ID = PRRB.ELEMENT_TYPE_ID
      AND  PETFB.ELEMENT_TYPE_ID = PETFT.ELEMENT_TYPE_ID
      AND  PIVFB.ELEMENT_TYPE_ID = PETFB.ELEMENT_TYPE_ID
      AND  PIVFB.INPUT_VALUE_ID = PRRVB.INPUT_VALUE_ID
      AND  PIVFB.INPUT_VALUE_ID = PIVTFB.INPUT_VALUE_ID
      AND  PPRA.RETRO_COMPONENT_ID IS NULL
      AND  PETFT.LANGUAGE = 'US'
      AND  PIVTFB.LANGUAGE = 'US'
      AND  PETFT.REPORTING_NAME IN ('Gratuity Accrual', 'Gratuity Accrual Payment')
      AND  TRUNC(LAST_DAY(PPA.EFFECTIVE_DATE)) = PER.PERIOD_END_DATE
    GROUP BY PPRD.PERSON_ID
)

-- 3. Final Select
SELECT PAPF.PERSON_NUMBER EMPLOYEE_NUMBER
      ,PPNF.FULL_NAME EMPLOYEE_NAME
      ,PLE.NAME LEGAL_ENTITY
      ,BU.BU_NAME BUSINESS_UNIT
      ,HDORG.NAME DEPARTMENT
      ,PJF.NAME JOB
      ,NVL(GD.UNPAID_LEAVE_DAYS, 0) UNPAID_LEAVE_DAYS
      ,NVL(GD.SENIORITY_DAYS, 0) SENIORITY_DAYS
      ,NVL(GD.SERVICE_DAYS, 0) SERVICE_DAYS
      ,NVL(GD.MONTHLY_DAYS_ACC_G, 0) MONTHLY_DAYS_ACC_G
      ,NVL(GD.MONTHLY_AMOUNT_ACC_G, 0) MONTHLY_AMOUNT_ACC_G
      ,NVL(GD.DAYS_PAID, 0) DAYS_PAID
      ,NVL(GD.AMOUNT_PAID, 0) AMOUNT_PAID
FROM   PER_ALL_PEOPLE_F PAPF
      ,PER_PERSON_NAMES_F PPNF
      ,PER_ALL_ASSIGNMENTS_M PAAM
      ,PER_LEGAL_ENTITIES PLE
      ,FUN_ALL_BUSINESS_UNITS_V BU
      ,HR_ORGANIZATION_UNITS_F_TL HDORG
      ,PER_JOBS_F PJF
      ,GRATUITY_DETAILS GD
WHERE  PAPF.PERSON_ID = PPNF.PERSON_ID
  AND  PAPF.PERSON_ID = PAAM.PERSON_ID
  AND  PAAM.LEGAL_ENTITY_ID = PLE.ORGANIZATION_ID
  AND  PAAM.BUSINESS_UNIT_ID = BU.BU_ID
  AND  PAAM.ORGANIZATION_ID = HDORG.ORGANIZATION_ID
  AND  PAAM.JOB_ID = PJF.JOB_ID(+)
  AND  PAPF.PERSON_ID = GD.PERSON_ID(+)
  AND  TRUNC(SYSDATE) BETWEEN PAPF.EFFECTIVE_START_DATE AND PAPF.EFFECTIVE_END_DATE
  AND  PPNF.NAME_TYPE = 'GLOBAL'
  AND  TRUNC(SYSDATE) BETWEEN PPNF.EFFECTIVE_START_DATE AND PPNF.EFFECTIVE_END_DATE
  AND  PAAM.PRIMARY_FLAG = 'Y'
  AND  PAAM.ASSIGNMENT_TYPE = 'E'
  AND  PAAM.EFFECTIVE_LATEST_CHANGE = 'Y'
  AND  HDORG.LANGUAGE = 'US'
  AND  TRUNC(SYSDATE) BETWEEN HDORG.EFFECTIVE_START_DATE AND HDORG.EFFECTIVE_END_DATE
  AND  TRUNC(SYSDATE) BETWEEN PJF.EFFECTIVE_START_DATE(+) AND PJF.EFFECTIVE_END_DATE(+)
ORDER BY PAPF.PERSON_NUMBER
;
```

**Parameters:**
- `:P_PERIOD` - Period date (format: YYYY-MM-DD)

---

**Last Updated:** 18-Dec-2025  
**Status:** Production-Ready  
**Source:** 4 Production Payroll Queries
