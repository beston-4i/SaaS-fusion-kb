# AP Report Templates

**Purpose:** Ready-to-use SQL skeletons for common AP reports.

---

## 1. AP Aging Report (Enhanced 14-Bucket)
*Comprehensive aging with prepayment handling and 14 buckets.*

```sql
/*
TITLE: AP Aging Report (Enhanced)
PURPOSE: Age outstanding supplier invoices by due date with prepayment tracking
AUTHOR: AI Generation Code
DATE: 22-12-25
*/

WITH 
-- Prepayment Tracking
PREPAYMENT_AMOUNT AS (
    SELECT /*+ qb_name(PREPAY_AMT) */
           AIAP.INVOICE_ID
          ,SUM(AIDI.AMOUNT * NVL(AIAI.EXCHANGE_RATE, 1)) APP_AMT
    FROM   AP_INVOICES_ALL AIAP
          ,AP_INVOICE_DISTRIBUTIONS_ALL AIDP
          ,AP_INVOICE_DISTRIBUTIONS_ALL AIDI
          ,AP_INVOICES_ALL AIAI
    WHERE  AIAP.INVOICE_ID = AIDP.INVOICE_ID
      AND  AIDP.INVOICE_DISTRIBUTION_ID = AIDI.PREPAY_DISTRIBUTION_ID
      AND  AIDI.INVOICE_ID = AIAI.INVOICE_ID
      AND  AIAP.INVOICE_TYPE_LOOKUP_CODE = 'PREPAYMENT'
      AND  AIAP.CANCELLED_DATE IS NULL
      AND  AIDI.REVERSAL_FLAG = 'N'
    GROUP BY AIAP.INVOICE_ID
),
-- Aging Calculation with 14 Buckets
AGING_CALC AS (
    SELECT /*+ qb_name(AGING) LEADING(PSA) */
           PSA.INVOICE_ID
          ,PSA.DUE_DATE
          ,PSA.AMOUNT_REMAINING * NVL(AIA.EXCHANGE_RATE, 1) AMOUNT_REMAINING
          ,TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE) DAYS_OVERDUE
          ,CASE WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) < 0 THEN 'Not Yet Due'
                WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 0 AND 7 THEN 'Bucket 0-7'
                WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 8 AND 15 THEN 'Bucket 8-15'
                WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 16 AND 30 THEN 'Bucket 16-30'
                WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 31 AND 45 THEN 'Bucket 31-45'
                WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 46 AND 60 THEN 'Bucket 46-60'
                WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 61 AND 75 THEN 'Bucket 61-75'
                WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 76 AND 90 THEN 'Bucket 76-90'
                WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 91 AND 120 THEN 'Bucket 91-120'
                WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 121 AND 150 THEN 'Bucket 121-150'
                WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 151 AND 180 THEN 'Bucket 151-180'
                WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 181 AND 360 THEN 'Bucket 181-360'
                WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 361 AND 720 THEN 'Bucket 361-720'
                WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) > 720 THEN 'Above 720'
                ELSE 'Unknown' END AGING_BUCKET
    FROM   AP_PAYMENT_SCHEDULES_ALL PSA
          ,AP_INVOICES_ALL AIA
    WHERE  PSA.INVOICE_ID = AIA.INVOICE_ID
      AND  PSA.AMOUNT_REMAINING <> 0
      AND  AIA.CANCELLED_DATE IS NULL
      AND  PSA.ORG_ID = :P_ORG_ID
      AND  TRUNC(AIA.INVOICE_DATE) <= :P_AS_OF_DATE
)
-- Final Selection
SELECT 
       FBU.BU_NAME
      ,POS.SEGMENT1 VENDOR_NUMBER
      ,POS.VENDOR_NAME
      ,PSS.VENDOR_SITE_CODE
      ,AIA.INVOICE_NUM
      ,AIA.INVOICE_DATE
      ,AC.DUE_DATE
      ,AIA.GL_DATE
      ,AIA.INVOICE_CURRENCY_CODE
      ,AIA.INVOICE_AMOUNT
      ,AIA.INVOICE_TYPE_LOOKUP_CODE
      ,AIA.DESCRIPTION
      ,AC.DAYS_OVERDUE
      ,AC.AGING_BUCKET
      ,NVL(PA.APP_AMT, 0) PREPAID_AMOUNT
      ,AC.AMOUNT_REMAINING - NVL(PA.APP_AMT, 0) NET_AMOUNT_REMAINING
      ,CASE WHEN AC.AGING_BUCKET = 'Not Yet Due' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_NOT_YET_DUE
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 0-7' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_0_7
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 8-15' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_8_15
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 16-30' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_16_30
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 31-45' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_31_45
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 46-60' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_46_60
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 61-75' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_61_75
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 76-90' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_76_90
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 91-120' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_91_120
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 121-150' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_121_150
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 151-180' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_151_180
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 181-360' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_181_360
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 361-720' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_361_720
      ,CASE WHEN AC.AGING_BUCKET = 'Above 720' 
            THEN AC.AMOUNT_REMAINING ELSE 0 END BUCKET_ABOVE_720
      ,PPNF.DISPLAY_NAME CREATED_BY_NAME
      ,AIA.CREATION_DATE
FROM   AGING_CALC AC
      ,AP_INVOICES_ALL AIA
      ,POZ_SUPPLIERS_V POS
      ,POZ_SUPPLIER_SITES_V PSS
      ,FUN_ALL_BUSINESS_UNITS_V FBU
      ,PREPAYMENT_AMOUNT PA
      ,PER_USERS PU
      ,PER_PERSON_NAMES_F PPNF
WHERE  AC.INVOICE_ID = AIA.INVOICE_ID
  AND  AIA.VENDOR_ID = POS.VENDOR_ID(+)
  AND  AIA.VENDOR_SITE_ID = PSS.VENDOR_SITE_ID(+)
  AND  AIA.ORG_ID = FBU.BU_ID
  AND  AIA.INVOICE_ID = PA.INVOICE_ID(+)
  AND  AIA.CREATED_BY = PU.USER_ID(+)
  AND  PU.PERSON_ID = PPNF.PERSON_ID(+)
  AND  PPNF.NAME_TYPE(+) = 'GLOBAL'
  AND  TRUNC(SYSDATE) BETWEEN TRUNC(PPNF.EFFECTIVE_START_DATE(+)) 
                          AND TRUNC(PPNF.EFFECTIVE_END_DATE(+))
  AND  (FBU.BU_NAME IN (:P_BU_NAME) OR 'All' IN (:P_BU_NAME || 'All'))
  AND  (POS.VENDOR_NAME IN (:P_VENDOR) OR 'All' IN (:P_VENDOR || 'All'))
ORDER BY FBU.BU_NAME, POS.VENDOR_NAME, AIA.INVOICE_NUM
```

---

## 2. AP Invoice Register
*Detailed listing of invoices for a period.*

```sql
/*
TITLE: AP Invoice Register
PURPOSE: List all invoices entered in a period with approval tracking
AUTHOR: AI Generation Code
DATE: 22-12-25
*/

WITH 
-- Approval History
APPROVER AS (
    SELECT /*+ qb_name(APPROVER) */
           MAX(AIAHA.ACTION_DATE) APPROVAL_DATE
          ,MAX(PPNF.DISPLAY_NAME) APPROVER_NAME
          ,AIAHA.INVOICE_ID
    FROM   AP_INV_APRVL_HIST_ALL AIAHA
          ,PER_USERS PU
          ,PER_PERSON_NAMES_F PPNF
    WHERE  AIAHA.APPROVER_ID = PU.USERNAME(+)
      AND  PU.PERSON_ID = PPNF.PERSON_ID(+)
      AND  PPNF.NAME_TYPE (+) = 'GLOBAL'
      AND  AIAHA.RESPONSE = 'APPROVED'
      AND  TRUNC(SYSDATE) BETWEEN TRUNC(PPNF.EFFECTIVE_START_DATE(+)) 
                              AND TRUNC(PPNF.EFFECTIVE_END_DATE(+))
    GROUP BY AIAHA.INVOICE_ID
),
-- Invoice Master Data
MASTER_DATA AS (
    SELECT /*+ qb_name(MAIN) LEADING(AIA) */
           FBU.BU_NAME
          ,POS.SEGMENT1 SUPPLIER_NUMBER
          ,POS.VENDOR_NAME SUPPLIER_NAME
          ,PSS.VENDOR_SITE_CODE
          ,AIA.INVOICE_NUM
          ,AIA.INVOICE_DATE
          ,AIA.DESCRIPTION
          ,AIA.INVOICE_CURRENCY_CODE
          ,AIA.INVOICE_AMOUNT
          ,APS.DUE_DATE INVOICE_DUE_DATE
          ,ACA.CHECK_NUMBER PAYMENT_NUMBER
          ,ACA.CHECK_DATE PAYMENT_DATE
          ,ACA.AMOUNT PAYMENT_AMOUNT
          ,AIA.INVOICE_RECEIVED_DATE
          ,ACA.STATUS_LOOKUP_CODE PAYMENT_STATUS
          ,AP.APPROVAL_DATE
          ,AP.APPROVER_NAME
          ,AIP.ACCOUNTING_DATE
          ,DECODE (AIA.APPROVAL_STATUS,
                   'FULL', 'FULLY APPLIED',
                   'NEVER APPROVED', 'NEVER VALIDATED',
                   'NEEDS REAPPROVAL', 'NEEDS REVALIDATION',
                   'CANCELLED', 'CANCELLED',
                   'UNPAID', 'UNPAID',
                   'AVAILABLE', 'AVAILABLE',
                   'UNAPPROVED', 'UNVALIDATED',
                   'APPROVED', 'VALIDATED',
                   'PERMANENT', 'PERMANENT PREPAYMENT',
                   NULL
           ) INV_APPROVAL_STATUS
    FROM   AP_INVOICES_ALL AIA
          ,POZ_SUPPLIERS_V POS
          ,POZ_SUPPLIER_SITES_V PSS
          ,FUN_ALL_BUSINESS_UNITS_V FBU
          ,AP_PAYMENT_SCHEDULES_ALL APS
          ,AP_INVOICE_PAYMENTS_ALL AIP
          ,AP_CHECKS_ALL ACA
          ,APPROVER AP
    WHERE  AIA.VENDOR_ID = POS.VENDOR_ID(+)
      AND  AIA.VENDOR_SITE_ID = PSS.VENDOR_SITE_ID(+)
      AND  AIA.ORG_ID = FBU.BU_ID
      AND  AIA.INVOICE_ID = APS.INVOICE_ID(+)
      AND  AIA.INVOICE_ID = AIP.INVOICE_ID(+)
      AND  AIP.CHECK_ID = ACA.CHECK_ID(+)
      AND  AIA.INVOICE_ID = AP.INVOICE_ID(+)
      AND  AIA.CANCELLED_DATE IS NULL
      AND  TRUNC(AIA.INVOICE_DATE) BETWEEN :P_FROM_DATE AND :P_TO_DATE
      AND  AIA.ORG_ID = :P_ORG_ID
      AND  SIGN(AIP.AMOUNT(+)) != -1
)
SELECT * FROM MASTER_DATA ORDER BY INVOICE_DATE, INVOICE_NUM
```

---

## 3. AP Ledger/Statement Report
*Supplier ledger with opening balance and all transaction types.*

```sql
/*
TITLE: AP Supplier Ledger/Statement
PURPOSE: Complete supplier ledger with opening balance
AUTHOR: AI Generation Code
DATE: 22-12-25
*/

WITH 
-- Prepayment Applications
PREPAY_TRX AS (
    SELECT /*+ qb_name(PREPAY_TRX) */
           AIAP.INVOICE_ID
          ,AIAP.INVOICE_NUM
          ,AIAI.INVOICE_ID APP_INVOICE_ID
          ,AIAI.INVOICE_NUM APP_INVOICE_NUM
          ,AIAI.INVOICE_DATE APP_INVOICE_DATE
          ,ABS(SUM(AIDI.AMOUNT)) APP_AMOUNT
          ,NVL(AIAP.EXCHANGE_RATE,1) EXCHANGE_RATE
          ,NVL(AIAI.EXCHANGE_RATE,1) APP_EXC_RATE
    FROM   AP_INVOICES_ALL AIAP
          ,AP_INVOICE_DISTRIBUTIONS_ALL AIDP
          ,AP_INVOICE_DISTRIBUTIONS_ALL AIDI
          ,AP_INVOICES_ALL AIAI
    WHERE  AIAP.INVOICE_ID = AIDP.INVOICE_ID
      AND  AIDP.INVOICE_DISTRIBUTION_ID = AIDI.PREPAY_DISTRIBUTION_ID
      AND  AIDI.INVOICE_ID = AIAI.INVOICE_ID
      AND  AIAP.INVOICE_TYPE_LOOKUP_CODE = 'PREPAYMENT'
      AND  AIDI.REVERSAL_FLAG = 'N'
      AND  AIAP.CANCELLED_DATE IS NULL
      AND  TRUNC(AIDI.ACCOUNTING_DATE) <= :P_TO_DATE
    GROUP BY AIAP.INVOICE_ID, AIAP.INVOICE_NUM, AIAI.INVOICE_ID, 
             AIAI.INVOICE_NUM, AIAI.INVOICE_DATE, 
             NVL(AIAP.EXCHANGE_RATE,1), NVL(AIAI.EXCHANGE_RATE,1)
),
-- All Transaction Types Union
AP_TRX AS (
    -- Invoice Transactions (Standard/PREPAYMENT)
    SELECT 1 NUM
          ,AIA.INVOICE_ID TRX_ID
          ,AIA.INVOICE_NUM
          ,AIA.INVOICE_DATE TRX_DATE
          ,MAX(AID.ACCOUNTING_DATE) GL_DATE
          ,'Invoice' TRX_TYPE
          ,AIA.DESCRIPTION TRX_DESC
          ,AIA.INVOICE_CURRENCY_CODE CURRENCY_CODE
          ,CASE WHEN SIGN(SUM(AID.AMOUNT)) = -1 THEN SUM(AID.AMOUNT) * -1 ELSE NULL END AMOUNT_DR
          ,CASE WHEN SIGN(SUM(AID.AMOUNT)) = 1 THEN SUM(AID.AMOUNT) ELSE NULL END AMOUNT_CR
          ,CASE WHEN SIGN(SUM(AID.AMOUNT * NVL(AIA.EXCHANGE_RATE, 1))) = -1 
                THEN SUM(AID.AMOUNT * NVL(AIA.EXCHANGE_RATE, 1)) * -1 
                ELSE NULL END ACCT_AMOUNT_DR
          ,CASE WHEN SIGN(SUM(AID.AMOUNT * NVL(AIA.EXCHANGE_RATE, 1))) = 1 
                THEN SUM(AID.AMOUNT * NVL(AIA.EXCHANGE_RATE, 1)) 
                ELSE NULL END ACCT_AMOUNT_CR
          ,AIA.VENDOR_ID
          ,AIA.VENDOR_SITE_ID
          ,AIA.ORG_ID
    FROM   AP_INVOICES_ALL AIA
          ,AP_INVOICE_DISTRIBUTIONS_ALL AID
    WHERE  AIA.INVOICE_ID = AID.INVOICE_ID
      AND  AIA.CANCELLED_DATE IS NULL
      AND  TRUNC(AID.ACCOUNTING_DATE) BETWEEN :P_FROM_DATE AND :P_TO_DATE
    GROUP BY AIA.INVOICE_ID, AIA.INVOICE_NUM, AIA.INVOICE_DATE, AIA.DESCRIPTION,
             AIA.INVOICE_CURRENCY_CODE, AIA.VENDOR_ID, AIA.VENDOR_SITE_ID, 
             AIA.ORG_ID, AIA.EXCHANGE_RATE
    HAVING SUM(AID.AMOUNT) <> 0
    
    UNION ALL
    -- Payment Transactions
    SELECT 4 NUM
          ,ACA.CHECK_ID
          ,TO_CHAR(ACA.CHECK_NUMBER) INVOICE_NUM
          ,ACA.CHECK_DATE
          ,MAX(AIP.ACCOUNTING_DATE)
          ,'Payment'
          ,ACA.DESCRIPTION
          ,ACA.CURRENCY_CODE
          ,CASE WHEN SIGN(SUM(NVL(AIP.AMOUNT, 0))) = 1 
                THEN SUM(NVL(AIP.AMOUNT, 0)) ELSE NULL END
          ,CASE WHEN SIGN(SUM(NVL(AIP.AMOUNT, 0))) = -1 
                THEN SUM(NVL(AIP.AMOUNT, 0)) * -1 ELSE NULL END
          ,CASE WHEN SIGN(SUM(NVL(AIP.AMOUNT, 0))) = 1 
                THEN SUM(NVL(AIP.AMOUNT, 0) * NVL(ACA.EXCHANGE_RATE, 1)) ELSE NULL END
          ,CASE WHEN SIGN(SUM(NVL(AIP.AMOUNT, 0))) = -1 
                THEN SUM(NVL(AIP.AMOUNT, 0) * NVL(ACA.EXCHANGE_RATE, 1)) * -1 ELSE NULL END
          ,ACA.VENDOR_ID
          ,ACA.VENDOR_SITE_ID
          ,ACA.ORG_ID
    FROM   AP_CHECKS_ALL ACA
          ,AP_INVOICE_PAYMENTS_ALL AIP
    WHERE  ACA.CHECK_ID = AIP.CHECK_ID
      AND  ACA.VOID_DATE IS NULL
      AND  TRUNC(AIP.ACCOUNTING_DATE) BETWEEN :P_FROM_DATE AND :P_TO_DATE
    GROUP BY ACA.CHECK_ID, TO_CHAR(ACA.CHECK_NUMBER), ACA.CHECK_DATE, ACA.DESCRIPTION,
             ACA.CURRENCY_CODE, ACA.VENDOR_ID, ACA.VENDOR_SITE_ID, ACA.ORG_ID, ACA.EXCHANGE_RATE
)
-- Final Selection with Opening Balance
SELECT FBU.BU_NAME
      ,POS.SEGMENT1 VENDOR_NUM
      ,POS.VENDOR_NAME
      ,PSS.VENDOR_SITE_CODE
      ,APT.INVOICE_NUM
      ,APT.TRX_DATE
      ,APT.GL_DATE
      ,APT.TRX_TYPE
      ,APT.CURRENCY_CODE
      ,APT.TRX_DESC
      ,APT.AMOUNT_DR
      ,APT.AMOUNT_CR
      ,APT.ACCT_AMOUNT_DR
      ,APT.ACCT_AMOUNT_CR
FROM   AP_TRX APT
      ,POZ_SUPPLIERS_V POS
      ,POZ_SUPPLIER_SITES_V PSS
      ,FUN_ALL_BUSINESS_UNITS_V FBU
WHERE  APT.VENDOR_ID = POS.VENDOR_ID(+)
  AND  APT.VENDOR_SITE_ID = PSS.VENDOR_SITE_ID(+)
  AND  APT.ORG_ID = FBU.BU_ID
  AND  (FBU.BU_NAME IN (:P_BU_ID) OR 'All' IN (:P_BU_ID || 'All'))
  AND  (POS.VENDOR_NAME IN (:P_VENDOR) OR 'All' IN (:P_VENDOR || 'All'))
ORDER BY POS.VENDOR_NAME, APT.TRX_DATE, APT.INVOICE_NUM
```

---

## 4. AP Payment Voucher Report
*Payment voucher with bank details and distribution breakdown.*

```sql
/*
TITLE: AP Bank Payment Voucher
PURPOSE: Payment voucher for bank processing with distribution details
AUTHOR: AI Generation Code
DATE: 22-12-25
*/

-- Dataset 1: Payment Header
WITH PAYMENT_HEADER AS (
    SELECT ACA.CHECK_ID
          ,ACA.AMOUNT
          ,REPLACE(IBY_AMOUNT_IN_WORDS.GET_AMOUNT_IN_WORDS(
               ROUND(ABS(ACA.AMOUNT * NVL(ACA.EXCHANGE_RATE, 1)), 2),
               GLL.CURRENCY_CODE), '-', ' ') AMT_WORDS
          ,ACA.DOC_SEQUENCE_VALUE
          ,ACA.CHECK_DATE
          ,ACA.CHECK_NUMBER
          ,ACA.CREATED_BY
          ,NVL(ACA.AMOUNT, 0) * NVL(ACA.EXCHANGE_RATE, 1) CHECK_CREDIT
          ,CBA.ASSET_CODE_COMBINATION_ID
          ,FND_FLEX_EXT.GET_SEGS('GL', 'GL#', GCC.CHART_OF_ACCOUNTS_ID, 
               GCC.CODE_COMBINATION_ID) CR_CODE_ID
          ,GL_FLEXFIELDS_PKG.GET_CONCAT_DESCRIPTION(GCC.CHART_OF_ACCOUNTS_ID,
               GCC.CODE_COMBINATION_ID) GL_CODE_DESC_CR
          ,ACA.VENDOR_NAME
          ,PSV.SEGMENT1 VENDOR_NUMBER
          ,ACA.VENDOR_SITE_CODE
          ,IPA.INT_BANK_ACCOUNT_NAME BANK_ACCOUNT_NAME
          ,IPA.INT_BANK_BRANCH_NAME
          ,ACA.CURRENCY_CODE
          ,ACA.DESCRIPTION COMMENTS
          ,HAOU.NAME ORG_NAME
          ,CASE WHEN APHA.POSTED_FLAG = 'Y' THEN 'ACCOUNTED' ELSE 'UNACCOUNTED' END STATUS
    FROM   AP_CHECKS_ALL ACA
          ,AP_PAYMENT_HISTORY_ALL APHA
          ,POZ_SUPPLIERS_V PSV
          ,IBY_PAYMENTS_ALL IPA
          ,CE_BANK_ACCOUNTS CBA
          ,GL_CODE_COMBINATIONS GCC
          ,HR_OPERATING_UNITS HAOU
          ,GL_LEDGERS GLL
    WHERE  ACA.VENDOR_ID = PSV.VENDOR_ID(+)
      AND  ACA.PAYMENT_ID = IPA.PAYMENT_ID
      AND  IPA.INTERNAL_BANK_ACCOUNT_ID = CBA.BANK_ACCOUNT_ID
      AND  CBA.ASSET_CODE_COMBINATION_ID = GCC.CODE_COMBINATION_ID
      AND  ACA.ORG_ID = HAOU.ORGANIZATION_ID
      AND  HAOU.SET_OF_BOOKS_ID = GLL.LEDGER_ID(+)
      AND  APHA.CHECK_ID(+) = ACA.CHECK_ID
      AND  ACA.VOID_DATE IS NULL
      AND  HAOU.ORGANIZATION_ID = :P_ORG_NAME
      AND  TRUNC(ACA.CHECK_DATE) BETWEEN NVL(:P_FROM_DATE, TRUNC(ACA.CHECK_DATE))
                                     AND NVL(:P_TO_DATE, TRUNC(ACA.CHECK_DATE))
      AND  ACA.CHECK_NUMBER BETWEEN NVL(:P_CHECK_FROM, ACA.CHECK_NUMBER) 
                                AND NVL(:P_CHECK_TO, ACA.CHECK_NUMBER)
)
SELECT * FROM PAYMENT_HEADER
ORDER BY CHECK_DATE, CHECK_NUMBER;

-- Dataset 2: Payment Distribution Lines
WITH PAYMENT_DIST AS (
    SELECT XTE.SOURCE_ID_INT_1 CHECK_ID
          ,AIA.INVOICE_ID
          ,AIA.INVOICE_NUM
          ,AIA.DESCRIPTION INV_DESCRIPTION
          ,FND_FLEX_EXT.GET_SEGS('GL', 'GL#', GCC.CHART_OF_ACCOUNTS_ID,
               GCC.CODE_COMBINATION_ID) ID_CODE_ID
          ,GL_FLEXFIELDS_PKG.GET_CONCAT_DESCRIPTION(GCC.CHART_OF_ACCOUNTS_ID,
               GCC.CODE_COMBINATION_ID) GL_CODE_DESC
          ,NVL(SUM(XAL.ACCOUNTED_DR), 0) - NVL(SUM(XAL.ACCOUNTED_CR), 0) DIST_DEBIT
    FROM   XLA_TRANSACTION_ENTITIES XTE
          ,XLA_EVENTS XE
          ,XLA_AE_HEADERS XAH
          ,XLA_AE_LINES XAL
          ,GL_CODE_COMBINATIONS GCC
          ,(SELECT XDL.APPLICATION_ID, XDL.AE_HEADER_ID, XDL.AE_LINE_NUM,
                   AIA.INVOICE_ID, AIA.INVOICE_NUM, AIA.DESCRIPTION
            FROM   XLA_DISTRIBUTION_LINKS XDL, AP_INVOICES_ALL AIA
            WHERE  XDL.APPLIED_TO_SOURCE_ID_NUM_1 = AIA.INVOICE_ID(+)
              AND  XDL.APPLICATION_ID = 200
              AND  XDL.EVENT_TYPE_CODE IN ('PAYMENT CREATED', 'INVOICE VALIDATED')
            GROUP BY XDL.APPLICATION_ID, XDL.AE_HEADER_ID, XDL.AE_LINE_NUM,
                     AIA.INVOICE_ID, AIA.INVOICE_NUM, AIA.DESCRIPTION) AIA
    WHERE  XTE.APPLICATION_ID = XE.APPLICATION_ID
      AND  XTE.ENTITY_ID = XE.ENTITY_ID
      AND  XE.APPLICATION_ID = XAH.APPLICATION_ID
      AND  XE.ENTITY_ID = XAH.ENTITY_ID
      AND  XE.EVENT_ID = XAH.EVENT_ID
      AND  XAH.AE_HEADER_ID = XAL.AE_HEADER_ID
      AND  XAL.CODE_COMBINATION_ID = GCC.CODE_COMBINATION_ID
      AND  XAL.APPLICATION_ID = AIA.APPLICATION_ID(+)
      AND  XAL.AE_HEADER_ID = AIA.AE_HEADER_ID(+)
      AND  XAL.AE_LINE_NUM = AIA.AE_LINE_NUM(+)
      AND  XTE.APPLICATION_ID = 200
      AND  XTE.ENTITY_CODE IN ('AP_PAYMENTS', 'AP_INVOICES')
      AND  XE.EVENT_TYPE_CODE IN ('PAYMENT CREATED', 'INVOICE VALIDATED')
      AND  XAL.ACCOUNTING_CLASS_CODE IN ('LIABILITY', 'LOSS', 'GAIN', 'ITEM EXPENSE')
    GROUP BY XTE.SOURCE_ID_INT_1, AIA.INVOICE_ID, AIA.INVOICE_NUM, AIA.DESCRIPTION,
             FND_FLEX_EXT.GET_SEGS('GL', 'GL#', GCC.CHART_OF_ACCOUNTS_ID, GCC.CODE_COMBINATION_ID),
             GL_FLEXFIELDS_PKG.GET_CONCAT_DESCRIPTION(GCC.CHART_OF_ACCOUNTS_ID, GCC.CODE_COMBINATION_ID)
    HAVING (NVL(SUM(XAL.ACCOUNTED_DR), 0) - NVL(SUM(XAL.ACCOUNTED_CR), 0)) <> 0
)
SELECT * FROM PAYMENT_DIST
ORDER BY CHECK_ID, INVOICE_NUM
```
