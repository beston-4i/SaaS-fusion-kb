# AR Report Templates

**Purpose:** Ready-to-use SQL skeletons for AR reporting.

---

## 1. AR Aging by Customer (7 Buckets)
*The standard 7-bucket aging report query.*

```sql
/*
TITLE: AR Customer Aging
PURPOSE: Overdue analysis by customer
*/

WITH
-- 1. Parameters
PARAMS AS (SELECT TRUNC(:P_RPT_DATE) AS AS_OF_DATE FROM DUAL),

-- 2. Transaction Source
DATA_SRC AS (
    SELECT /*+ qb_name(SRC) MATERIALIZE */
           HCA.ACCOUNT_NUMBER
          ,HP.PARTY_NAME
          ,PSA.TRX_NUMBER
          ,PSA.DUE_DATE
           -- Calculate Days Overdue
          ,P.AS_OF_DATE - TRUNC(PSA.DUE_DATE) AS DAYS_DUE
           -- Calculate Functional Remaining Amount
          ,(PSA.AMOUNT_DUE_REMAINING * NVL(PSA.EXCHANGE_RATE, 1)) AS FUNC_BAL
    FROM   AR_PAYMENT_SCHEDULES_ALL PSA
          ,HZ_CUST_ACCOUNTS HCA
          ,HZ_PARTIES HP
          ,PARAMS P
    WHERE  PSA.CUSTOMER_ID = HCA.CUST_ACCOUNT_ID
      AND  HCA.PARTY_ID = HP.PARTY_ID
      AND  PSA.STATUS = 'OP' -- Open
      AND  PSA.AMOUNT_DUE_REMAINING != 0
),

-- 3. Bucketing
BUCKETS AS (
    SELECT ACCOUNT_NUMBER, PARTY_NAME
          ,FUNC_BAL
          ,CASE 
             WHEN DAYS_DUE <= 0 THEN 'Current'
             WHEN DAYS_DUE BETWEEN 1 AND 30 THEN '1-30'
             WHEN DAYS_DUE BETWEEN 31 AND 60 THEN '31-60'
             WHEN DAYS_DUE BETWEEN 61 AND 90 THEN '61-90'
             WHEN DAYS_DUE BETWEEN 91 AND 180 THEN '91-180'
             WHEN DAYS_DUE BETWEEN 181 AND 360 THEN '181-360'
             ELSE '360+'
           END AS BUCKET_NAME
    FROM DATA_SRC
)

-- 4. Pivot/Aggregation
SELECT PARTY_NAME
      ,SUM(FUNC_BAL) AS TOTAL_DUE
      ,SUM(CASE WHEN BUCKET_NAME = 'Current' THEN FUNC_BAL ELSE 0 END) AS B_CURRENT
      ,SUM(CASE WHEN BUCKET_NAME = '1-30' THEN FUNC_BAL ELSE 0 END) AS B_1_30
      ,SUM(CASE WHEN BUCKET_NAME = '31-60' THEN FUNC_BAL ELSE 0 END) AS B_31_60
      ,SUM(CASE WHEN BUCKET_NAME = '360+' THEN FUNC_BAL ELSE 0 END) AS B_360_PLUS
FROM   BUCKETS
GROUP BY PARTY_NAME
ORDER BY TOTAL_DUE DESC
```

---

## 2. AR Transaction/Invoice Register
*Comprehensive transaction register with all details.*

```sql
/*
TITLE: AR Transaction/Invoice Register
PURPOSE: Detailed listing of AR transactions for a period
AUTHOR: AI Generation Code
DATE: 22-12-25
*/

WITH 
-- Transaction Master with Full Details
TRX_DATA AS (
    SELECT /*+ qb_name(TRX_DATA) MATERIALIZE */
           FBU.BU_NAME
          ,HCA.ACCOUNT_NUMBER
          ,HP.PARTY_NAME CUSTOMER_NAME
          ,HCSU.LOCATION BILL_TO_LOCATION
          ,RCTA.TRX_NUMBER
          ,RCTA.TRX_DATE
          ,RCTA.GL_DATE
          ,RCTT.NAME TRX_TYPE
          ,RBS.NAME BATCH_SOURCE
          ,RCTA.INVOICE_CURRENCY_CODE
          ,RCTA.COMMENTS
          -- Sign Logic for CM/DM
          ,CASE WHEN PSA.CLASS IN ('CM', 'PMT') THEN -1 ELSE 1 END SIGN_FACTOR
          ,PSA.AMOUNT_DUE_ORIGINAL
          ,PSA.AMOUNT_DUE_ORIGINAL * NVL(RCTA.EXCHANGE_RATE, 1) FUNC_AMOUNT
          ,PSA.DUE_DATE
          ,PSA.STATUS
          ,PPNF.DISPLAY_NAME CREATED_BY
          ,RCTA.CREATION_DATE
    FROM   RA_CUSTOMER_TRX_ALL RCTA
          ,AR_PAYMENT_SCHEDULES_ALL PSA
          ,RA_CUST_TRX_TYPES_ALL RCTT
          ,RA_BATCH_SOURCES_ALL RBS
          ,HZ_CUST_ACCOUNTS HCA
          ,HZ_PARTIES HP
          ,HZ_CUST_SITE_USES_ALL HCSU
          ,FUN_ALL_BUSINESS_UNITS_V FBU
          ,PER_USERS PU
          ,PER_PERSON_NAMES_F PPNF
    WHERE  RCTA.CUSTOMER_TRX_ID = PSA.CUSTOMER_TRX_ID
      AND  RCTA.CUST_TRX_TYPE_SEQ_ID = RCTT.CUST_TRX_TYPE_SEQ_ID
      AND  RCTA.BATCH_SOURCE_SEQ_ID = RBS.BATCH_SOURCE_SEQ_ID(+)
      AND  RCTA.BILL_TO_CUSTOMER_ID = HCA.CUST_ACCOUNT_ID
      AND  HCA.PARTY_ID = HP.PARTY_ID
      AND  RCTA.BILL_TO_SITE_USE_ID = HCSU.SITE_USE_ID(+)
      AND  RCTA.ORG_ID = FBU.BU_ID
      AND  RCTA.ORG_ID = PSA.ORG_ID
      AND  RCTA.COMPLETE_FLAG = 'Y'
      AND  RCTA.CREATED_BY = PU.USER_ID(+)
      AND  PU.PERSON_ID = PPNF.PERSON_ID(+)
      AND  PPNF.NAME_TYPE(+) = 'GLOBAL'
      AND  TRUNC(SYSDATE) BETWEEN TRUNC(PPNF.EFFECTIVE_START_DATE(+)) 
                              AND TRUNC(PPNF.EFFECTIVE_END_DATE(+))
      AND  TRUNC(RCTA.TRX_DATE) BETWEEN :P_FROM_DATE AND :P_TO_DATE
      AND  (FBU.BU_NAME IN (:P_BU_NAME) OR 'All' IN (:P_BU_NAME || 'All'))
      AND  RCTA.ORG_ID = :P_ORG_ID
)
SELECT * FROM TRX_DATA
ORDER BY TRX_DATE, TRX_NUMBER
```

---

## 3. AR Receipt Register
*Comprehensive receipt register with bank and application details.*

```sql
/*
TITLE: AR Receipt Register
PURPOSE: Detailed listing of receipts and applications
AUTHOR: AI Generation Code
DATE: 22-12-25
*/

WITH 
-- Receipt Master with Applications
RCPT_DATA AS (
    SELECT /*+ qb_name(RCPT_DATA) MATERIALIZE */
           FBU.BU_NAME
          ,HP.PARTY_NAME CUSTOMER_NAME
          ,HCA.ACCOUNT_NUMBER
          ,ACRA.RECEIPT_NUMBER
          ,ACRA.RECEIPT_DATE
          ,ACRA.GL_DATE
          ,ACRA.AMOUNT RECEIPT_AMOUNT
          ,ACRA.CURRENCY_CODE
          ,NVL(ACRA.EXCHANGE_RATE, 1) EXCH_RATE
          ,ACRA.AMOUNT * NVL(ACRA.EXCHANGE_RATE, 1) FUNC_RECEIPT_AMOUNT
          ,ARM.NAME RECEIPT_METHOD
          ,ACRH.STATUS RECEIPT_STATUS
          ,ACRA.DEPOSIT_DATE
          -- Application Details
          ,RCTA.TRX_NUMBER APPLIED_TO_TRX
          ,ARA.AMOUNT_APPLIED
          ,ARA.AMOUNT_APPLIED * NVL(ACRA.EXCHANGE_RATE, 1) FUNC_AMOUNT_APPLIED
          ,ARA.GL_DATE APPLICATION_GL_DATE
          ,ARA.APPLY_DATE APPLICATION_DATE
          -- Audit
          ,PPNF.DISPLAY_NAME CREATED_BY
          ,ACRA.CREATION_DATE
    FROM   AR_CASH_RECEIPTS_ALL ACRA
          ,HZ_CUST_ACCOUNTS HCA
          ,HZ_PARTIES HP
          ,AR_RECEIPT_METHODS ARM
          ,FUN_ALL_BUSINESS_UNITS_V FBU
          ,AR_CASH_RECEIPT_HISTORY_ALL ACRH
          ,AR_RECEIVABLE_APPLICATIONS_ALL ARA
          ,RA_CUSTOMER_TRX_ALL RCTA
          ,PER_USERS PU
          ,PER_PERSON_NAMES_F PPNF
    WHERE  ACRA.PAY_FROM_CUSTOMER = HCA.CUST_ACCOUNT_ID(+)
      AND  HCA.PARTY_ID = HP.PARTY_ID(+)
      AND  ACRA.RECEIPT_METHOD_ID = ARM.RECEIPT_METHOD_ID(+)
      AND  ACRA.ORG_ID = FBU.BU_ID
      AND  ACRA.CASH_RECEIPT_ID = ACRH.CASH_RECEIPT_ID
      AND  ACRH.CURRENT_RECORD_FLAG = 'Y'
      AND  ACRA.CASH_RECEIPT_ID = ARA.CASH_RECEIPT_ID(+)
      AND  ARA.APPLIED_CUSTOMER_TRX_ID = RCTA.CUSTOMER_TRX_ID(+)
      AND  ARA.STATUS(+) = 'APP'
      AND  NVL(ARA.DISPLAY, 'Y') = 'Y'
      AND  ACRA.CREATED_BY = PU.USER_ID(+)
      AND  PU.PERSON_ID = PPNF.PERSON_ID(+)
      AND  PPNF.NAME_TYPE(+) = 'GLOBAL'
      AND  TRUNC(SYSDATE) BETWEEN TRUNC(PPNF.EFFECTIVE_START_DATE(+)) 
                              AND TRUNC(PPNF.EFFECTIVE_END_DATE(+))
      -- Exclude Reversed Receipts
      AND  NOT EXISTS (
           SELECT 1 
           FROM   AR_CASH_RECEIPT_HISTORY_ALL H
           WHERE  H.CASH_RECEIPT_ID = ACRA.CASH_RECEIPT_ID
             AND  H.STATUS = 'REVERSED'
      )
      AND  TRUNC(ACRA.RECEIPT_DATE) BETWEEN :P_FROM_DATE AND :P_TO_DATE
      AND  (FBU.BU_NAME IN (:P_BU_NAME) OR 'All' IN (:P_BU_NAME || 'All'))
      AND  ACRA.ORG_ID = :P_ORG_ID
)
SELECT * FROM RCPT_DATA
ORDER BY RECEIPT_DATE, RECEIPT_NUMBER
```

---

## 4. AR Customer Ledger/Statement
*Complete customer ledger with opening balance and all transaction types.*

```sql
/*
TITLE: AR Customer Ledger/Statement
PURPOSE: Customer account statement with opening balance
AUTHOR: AI Generation Code
DATE: 22-12-25
*/

WITH 
-- Opening Balance Calculation
OPENING_BAL AS (
    SELECT /*+ qb_name(OPEN_BAL) */
           PSA.CUSTOMER_ID
          ,SUM(PSA.AMOUNT_DUE_ORIGINAL * NVL(RCTA.EXCHANGE_RATE, 1) * 
               CASE WHEN PSA.CLASS IN ('CM', 'PMT') THEN -1 ELSE 1 END) OPENING_BALANCE
    FROM   AR_PAYMENT_SCHEDULES_ALL PSA
          ,RA_CUSTOMER_TRX_ALL RCTA
    WHERE  PSA.CUSTOMER_TRX_ID = RCTA.CUSTOMER_TRX_ID(+)
      AND  RCTA.COMPLETE_FLAG(+) = 'Y'
      AND  TRUNC(RCTA.TRX_DATE(+)) < :P_FROM_DATE
      AND  PSA.ORG_ID = :P_ORG_ID
    GROUP BY PSA.CUSTOMER_ID
),
-- All Transaction Types Union
AR_TRX AS (
    -- Invoices and Credit Memos
    SELECT 1 SORT_ORDER
          ,RCTA.CUSTOMER_TRX_ID TRX_ID
          ,RCTA.TRX_NUMBER
          ,RCTA.TRX_DATE TRX_DATE
          ,RCTA.GL_DATE
          ,RCTT.NAME TRX_TYPE
          ,RCTA.COMMENTS TRX_DESC
          ,RCTA.INVOICE_CURRENCY_CODE
          -- Debit/Credit Logic
          ,CASE WHEN PSA.CLASS = 'CM' THEN NULL 
                ELSE PSA.AMOUNT_DUE_ORIGINAL END AMOUNT_DR
          ,CASE WHEN PSA.CLASS = 'CM' THEN PSA.AMOUNT_DUE_ORIGINAL 
                ELSE NULL END AMOUNT_CR
          ,CASE WHEN PSA.CLASS = 'CM' THEN NULL 
                ELSE PSA.AMOUNT_DUE_ORIGINAL * NVL(RCTA.EXCHANGE_RATE, 1) END FUNC_AMOUNT_DR
          ,CASE WHEN PSA.CLASS = 'CM' THEN PSA.AMOUNT_DUE_ORIGINAL * NVL(RCTA.EXCHANGE_RATE, 1) 
                ELSE NULL END FUNC_AMOUNT_CR
          ,RCTA.BILL_TO_CUSTOMER_ID CUSTOMER_ID
          ,RCTA.ORG_ID
    FROM   RA_CUSTOMER_TRX_ALL RCTA
          ,AR_PAYMENT_SCHEDULES_ALL PSA
          ,RA_CUST_TRX_TYPES_ALL RCTT
    WHERE  RCTA.CUSTOMER_TRX_ID = PSA.CUSTOMER_TRX_ID
      AND  RCTA.CUST_TRX_TYPE_SEQ_ID = RCTT.CUST_TRX_TYPE_SEQ_ID
      AND  RCTA.COMPLETE_FLAG = 'Y'
      AND  RCTA.ORG_ID = PSA.ORG_ID
      AND  TRUNC(RCTA.TRX_DATE) BETWEEN :P_FROM_DATE AND :P_TO_DATE
    
    UNION ALL
    
    -- Receipts (Applications)
    SELECT 2 SORT_ORDER
          ,ACRA.CASH_RECEIPT_ID
          ,ACRA.RECEIPT_NUMBER
          ,ACRA.RECEIPT_DATE
          ,ARA.GL_DATE
          ,'Receipt' TRX_TYPE
          ,ACRA.COMMENTS
          ,ACRA.CURRENCY_CODE
          ,NULL AMOUNT_DR
          ,ARA.AMOUNT_APPLIED AMOUNT_CR
          ,NULL FUNC_AMOUNT_DR
          ,ARA.AMOUNT_APPLIED * NVL(ACRA.EXCHANGE_RATE, 1) FUNC_AMOUNT_CR
          ,RCTA.BILL_TO_CUSTOMER_ID CUSTOMER_ID
          ,ACRA.ORG_ID
    FROM   AR_CASH_RECEIPTS_ALL ACRA
          ,AR_RECEIVABLE_APPLICATIONS_ALL ARA
          ,RA_CUSTOMER_TRX_ALL RCTA
    WHERE  ACRA.CASH_RECEIPT_ID = ARA.CASH_RECEIPT_ID
      AND  ARA.APPLIED_CUSTOMER_TRX_ID = RCTA.CUSTOMER_TRX_ID(+)
      AND  ARA.STATUS = 'APP'
      AND  NVL(ARA.DISPLAY, 'Y') = 'Y'
      AND  TRUNC(ACRA.RECEIPT_DATE) BETWEEN :P_FROM_DATE AND :P_TO_DATE
      -- Exclude Reversed Receipts
      AND  NOT EXISTS (
           SELECT 1 
           FROM   AR_CASH_RECEIPT_HISTORY_ALL H
           WHERE  H.CASH_RECEIPT_ID = ACRA.CASH_RECEIPT_ID
             AND  H.STATUS = 'REVERSED'
      )
    
    UNION ALL
    
    -- Adjustments
    SELECT 3 SORT_ORDER
          ,ARAA.ADJUSTMENT_ID
          ,TO_CHAR(ARAA.ADJUSTMENT_NUMBER)
          ,ARAA.APPLY_DATE
          ,ARAA.GL_DATE
          ,'Adjustment' TRX_TYPE
          ,ARAA.COMMENTS
          ,RCTA.INVOICE_CURRENCY_CODE
          ,CASE WHEN SIGN(ARAA.AMOUNT) = 1 THEN ARAA.AMOUNT ELSE NULL END
          ,CASE WHEN SIGN(ARAA.AMOUNT) = -1 THEN ABS(ARAA.AMOUNT) ELSE NULL END
          ,CASE WHEN SIGN(ARAA.AMOUNT) = 1 THEN ARAA.AMOUNT * NVL(RCTA.EXCHANGE_RATE, 1) ELSE NULL END
          ,CASE WHEN SIGN(ARAA.AMOUNT) = -1 THEN ABS(ARAA.AMOUNT) * NVL(RCTA.EXCHANGE_RATE, 1) ELSE NULL END
          ,RCTA.BILL_TO_CUSTOMER_ID CUSTOMER_ID
          ,ARAA.ORG_ID
    FROM   AR_ADJUSTMENTS_ALL ARAA
          ,RA_CUSTOMER_TRX_ALL RCTA
    WHERE  ARAA.CUSTOMER_TRX_ID = RCTA.CUSTOMER_TRX_ID
      AND  TRUNC(ARAA.APPLY_DATE) BETWEEN :P_FROM_DATE AND :P_TO_DATE
)
-- Final Selection with Customer Details
SELECT FBU.BU_NAME
      ,HCA.ACCOUNT_NUMBER
      ,HP.PARTY_NAME CUSTOMER_NAME
      ,OB.OPENING_BALANCE
      ,ART.TRX_NUMBER
      ,ART.TRX_DATE
      ,ART.GL_DATE
      ,ART.TRX_TYPE
      ,ART.TRX_DESC
      ,ART.CURRENCY_CODE
      ,ART.AMOUNT_DR
      ,ART.AMOUNT_CR
      ,ART.FUNC_AMOUNT_DR
      ,ART.FUNC_AMOUNT_CR
      -- Running Balance
      ,NVL(OB.OPENING_BALANCE, 0) + 
       SUM(NVL(ART.FUNC_AMOUNT_DR, 0) - NVL(ART.FUNC_AMOUNT_CR, 0)) 
       OVER (PARTITION BY ART.CUSTOMER_ID ORDER BY ART.TRX_DATE, ART.TRX_NUMBER) RUNNING_BALANCE
FROM   AR_TRX ART
      ,HZ_CUST_ACCOUNTS HCA
      ,HZ_PARTIES HP
      ,FUN_ALL_BUSINESS_UNITS_V FBU
      ,OPENING_BAL OB
WHERE  ART.CUSTOMER_ID = HCA.CUST_ACCOUNT_ID(+)
  AND  HCA.PARTY_ID = HP.PARTY_ID(+)
  AND  ART.ORG_ID = FBU.BU_ID
  AND  ART.CUSTOMER_ID = OB.CUSTOMER_ID(+)
  AND  (FBU.BU_NAME IN (:P_BU_NAME) OR 'All' IN (:P_BU_NAME || 'All'))
  AND  (HP.PARTY_NAME IN (:P_CUSTOMER) OR 'All' IN (:P_CUSTOMER || 'All'))
ORDER BY HP.PARTY_NAME, ART.TRX_DATE, ART.TRX_NUMBER
```

---

## 5. AR Enhanced Aging (Multi-Bucket with Customer Details)
*Enhanced aging report with 8 buckets and full customer site details.*

```sql
/*
TITLE: AR Enhanced Aging Report
PURPOSE: Comprehensive aging with customer site details and 8 buckets
AUTHOR: AI Generation Code
DATE: 22-12-25
*/

WITH 
-- Aging Calculation
AGING_CALC AS (
    SELECT /*+ qb_name(AGING) */
           PSA.CUSTOMER_TRX_ID
          ,PSA.CUSTOMER_ID
          ,PSA.DUE_DATE
          ,PSA.AMOUNT_DUE_REMAINING * NVL(RCTA.EXCHANGE_RATE, 1) FUNC_REMAINING
          ,TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE) DAYS_OVERDUE
          -- Bucket Classification
          ,CASE 
             WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) < 0 THEN 'Not Yet Due'
             WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 0 AND 30 THEN 'Bucket 0-30'
             WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 31 AND 60 THEN 'Bucket 31-60'
             WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 61 AND 90 THEN 'Bucket 61-90'
             WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 91 AND 120 THEN 'Bucket 91-120'
             WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 121 AND 180 THEN 'Bucket 121-180'
             WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) BETWEEN 181 AND 360 THEN 'Bucket 181-360'
             WHEN (TRUNC(:P_AS_OF_DATE) - TRUNC(PSA.DUE_DATE)) > 360 THEN 'Above 360'
             ELSE 'Unknown'
           END AGING_BUCKET
    FROM   AR_PAYMENT_SCHEDULES_ALL PSA
          ,RA_CUSTOMER_TRX_ALL RCTA
    WHERE  PSA.CUSTOMER_TRX_ID = RCTA.CUSTOMER_TRX_ID
      AND  PSA.STATUS = 'OP'
      AND  PSA.AMOUNT_DUE_REMAINING <> 0
      AND  RCTA.COMPLETE_FLAG = 'Y'
      AND  TRUNC(RCTA.TRX_DATE) <= :P_AS_OF_DATE
      AND  PSA.ORG_ID = :P_ORG_ID
)
-- Final Selection with Customer Details
SELECT FBU.BU_NAME
      ,HCA.ACCOUNT_NUMBER
      ,HP.PARTY_NAME CUSTOMER_NAME
      ,HCSU.LOCATION BILL_TO_LOCATION
      ,HL.CITY
      ,HL.STATE
      ,HL.COUNTRY
      ,RCTA.TRX_NUMBER
      ,RCTA.TRX_DATE
      ,AC.DUE_DATE
      ,RCTA.GL_DATE
      ,RCTA.INVOICE_CURRENCY_CODE
      ,PSA.AMOUNT_DUE_ORIGINAL
      ,RCTT.NAME TRX_TYPE
      ,RCTA.COMMENTS
      ,AC.DAYS_OVERDUE
      ,AC.AGING_BUCKET
      ,AC.FUNC_REMAINING
      -- Bucket Columns
      ,CASE WHEN AC.AGING_BUCKET = 'Not Yet Due' THEN AC.FUNC_REMAINING ELSE 0 END BUCKET_NOT_YET_DUE
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 0-30' THEN AC.FUNC_REMAINING ELSE 0 END BUCKET_0_30
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 31-60' THEN AC.FUNC_REMAINING ELSE 0 END BUCKET_31_60
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 61-90' THEN AC.FUNC_REMAINING ELSE 0 END BUCKET_61_90
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 91-120' THEN AC.FUNC_REMAINING ELSE 0 END BUCKET_91_120
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 121-180' THEN AC.FUNC_REMAINING ELSE 0 END BUCKET_121_180
      ,CASE WHEN AC.AGING_BUCKET = 'Bucket 181-360' THEN AC.FUNC_REMAINING ELSE 0 END BUCKET_181_360
      ,CASE WHEN AC.AGING_BUCKET = 'Above 360' THEN AC.FUNC_REMAINING ELSE 0 END BUCKET_ABOVE_360
      ,PPNF.DISPLAY_NAME CREATED_BY_NAME
      ,RCTA.CREATION_DATE
FROM   AGING_CALC AC
      ,RA_CUSTOMER_TRX_ALL RCTA
      ,AR_PAYMENT_SCHEDULES_ALL PSA
      ,RA_CUST_TRX_TYPES_ALL RCTT
      ,HZ_CUST_ACCOUNTS HCA
      ,HZ_PARTIES HP
      ,HZ_CUST_SITE_USES_ALL HCSU
      ,HZ_CUST_ACCT_SITES_ALL HCAS
      ,HZ_PARTY_SITES HPS
      ,HZ_LOCATIONS HL
      ,FUN_ALL_BUSINESS_UNITS_V FBU
      ,PER_USERS PU
      ,PER_PERSON_NAMES_F PPNF
WHERE  AC.CUSTOMER_TRX_ID = RCTA.CUSTOMER_TRX_ID
  AND  AC.CUSTOMER_TRX_ID = PSA.CUSTOMER_TRX_ID
  AND  RCTA.CUST_TRX_TYPE_SEQ_ID = RCTT.CUST_TRX_TYPE_SEQ_ID
  AND  RCTA.BILL_TO_CUSTOMER_ID = HCA.CUST_ACCOUNT_ID
  AND  HCA.PARTY_ID = HP.PARTY_ID
  AND  RCTA.BILL_TO_SITE_USE_ID = HCSU.SITE_USE_ID(+)
  AND  HCSU.CUST_ACCT_SITE_ID = HCAS.CUST_ACCT_SITE_ID(+)
  AND  HCAS.PARTY_SITE_ID = HPS.PARTY_SITE_ID(+)
  AND  HPS.LOCATION_ID = HL.LOCATION_ID(+)
  AND  RCTA.ORG_ID = FBU.BU_ID
  AND  RCTA.CREATED_BY = PU.USER_ID(+)
  AND  PU.PERSON_ID = PPNF.PERSON_ID(+)
  AND  PPNF.NAME_TYPE(+) = 'GLOBAL'
  AND  TRUNC(SYSDATE) BETWEEN TRUNC(PPNF.EFFECTIVE_START_DATE(+)) 
                          AND TRUNC(PPNF.EFFECTIVE_END_DATE(+))
  AND  (FBU.BU_NAME IN (:P_BU_NAME) OR 'All' IN (:P_BU_NAME || 'All'))
  AND  (HP.PARTY_NAME IN (:P_CUSTOMER) OR 'All' IN (:P_CUSTOMER || 'All'))
ORDER BY FBU.BU_NAME, HP.PARTY_NAME, RCTA.TRX_NUMBER
```
