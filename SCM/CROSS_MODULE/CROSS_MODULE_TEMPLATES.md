# Cross-Module Report Templates

**Purpose:** Ready-to-use SQL skeletons for cross-module reporting  
**Scope:** Queries spanning multiple SCM modules

---

## 1. Procure to Pay (P2P) Report
*Complete P2P cycle from requisition to payment.*

```sql
/*
TITLE: Procure to Pay Report
PURPOSE: End-to-end procurement tracking from PR to Payment
MODULES: PO (PR + PO) → INV (Receipt) → AP (Invoice + Payment)
PARAMETERS:
  - :P_PR_FROM_DATE - PR Creation From Date
  - :P_PR_TO_DATE - PR Creation To Date
  - :P_BUYER - Buyer Name
  - :P_BUSSINESS_UNIT - Business Unit
  - :P_PO_STATUS - PO Status
  - :P_PO_SCHEDULE_STATUS - PO Schedule Status
  - :P_RECEIPT_FROM_DATE - Receipt From Date
  - :P_RECEIPT_TO_DATE - Receipt To Date
*/

WITH
-- 1. Purchase Order CTE
PURCHASE_ORDER AS (
    SELECT /*+ qb_name(PURCHASE_ORDER) MATERIALIZE */
           PHA.PO_HEADER_ID
          ,PHA.SEGMENT1 AS PO_NUMBER
          ,PHA.VENDOR_ID
          ,TO_CHAR(PHA.CREATION_DATE, 'YYYY-MM-DD') AS PO_CREATION_DATE
          ,TO_CHAR(PHA.APPROVED_DATE, 'YYYY-MM-DD') AS PO_APPROVED_DATE
          ,PHA.APPROVED_DATE
          ,PHA.DOCUMENT_STATUS AS PO_STATUS
          ,PLA.PO_LINE_ID
          ,PLA.LINE_NUM AS PO_LINE_NO
          ,PHA.TYPE_LOOKUP_CODE AS PO_TYPE
          ,(NVL(PDA.NONRECOVERABLE_TAX, 0) + NVL(PDA.TAX_EXCLUSIVE_AMOUNT, 0)) * NVL(PHA.RATE, 1) AS PO_VALUE_AED
          ,PLA.UNIT_PRICE
          ,PLLA.DESCRIPTION
          ,PLA.ITEM_DESCRIPTION
          ,ESIV.DESCRIPTION AS ITEM
          ,PLA.QUANTITY AS PO_QTY
          ,PDA.PO_DISTRIBUTION_ID
          ,PDA.REQ_DISTRIBUTION_ID
          ,PSV.VENDOR_NAME AS SUPPLIER_NAME
          ,PSSV.VENDOR_SITE_CODE AS SUPPLIER_SITE
          ,FABUV.BU_NAME AS BUSINESS_UNIT
          ,PLLA.SHIPMENT_NUM AS PO_SCHEDULE_NO
          ,PLLA.ASSESSABLE_VALUE AS PO_SCHEDULE_AMOUNT
          ,PLLA.LINE_LOCATION_ID
          ,GCC.SEGMENT1 || '-' || GCC.SEGMENT2 || '-' || GCC.SEGMENT3 || '-' || GCC.SEGMENT4 || '-' || GCC.SEGMENT5 || '-' || GCC.SEGMENT6 || '-' || GCC.SEGMENT7 AS CHARGE_CODE_COMBINATION
    FROM   PO_HEADERS_ALL PHA
          ,PO_LINES_ALL PLA
          ,PO_DISTRIBUTIONS_ALL PDA
          ,POZ_SUPPLIERS_V PSV
          ,POZ_SUPPLIER_SITES_V PSSV
          ,FUN_ALL_BUSINESS_UNITS_V FABUV
          ,EGP_SYSTEM_ITEMS_VL ESIV
          ,PO_LINE_LOCATIONS_ALL PLLA
          ,GL_CODE_COMBINATIONS GCC
    WHERE  PHA.PO_HEADER_ID = PLA.PO_HEADER_ID(+)
      AND  PHA.VENDOR_ID = PSV.VENDOR_ID(+)
      AND  PHA.VENDOR_SITE_ID = PSSV.VENDOR_SITE_ID(+)
      AND  PLA.PO_HEADER_ID = PDA.PO_HEADER_ID(+)
      AND  PLA.PO_LINE_ID = PDA.PO_LINE_ID(+)
      AND  PHA.PRC_BU_ID = FABUV.BU_ID(+)
      AND  PDA.CODE_COMBINATION_ID = GCC.CODE_COMBINATION_ID(+)
      AND  PLA.PO_HEADER_ID = PLLA.PO_HEADER_ID(+)
      AND  PLA.PO_LINE_ID = PLLA.PO_LINE_ID(+)
      AND  PDA.LINE_LOCATION_ID = PLLA.LINE_LOCATION_ID(+)
      AND  PLA.ITEM_ID = ESIV.INVENTORY_ITEM_ID(+)
      AND  PDA.DESTINATION_ORGANIZATION_ID = ESIV.ORGANIZATION_ID(+)
      AND  PHA.TYPE_LOOKUP_CODE = 'STANDARD'
),

-- 2. Requisition CTE
REQUISITION AS (
    SELECT /*+ qb_name(REQUISITION) MATERIALIZE */
           PRHA.REQUISITION_HEADER_ID
          ,PRHA.REQUISITION_NUMBER AS PR_NUMBER
          ,TO_CHAR(PRHA.CREATION_DATE, 'YYYY-MM-DD') AS PR_CREATION_DATE
          ,TO_CHAR(PRHA.APPROVED_DATE, 'YYYY-MM-DD') AS PR_APPROVED_DATE
          ,PRHA.APPROVED_DATE
          ,PRHA.DOCUMENT_STATUS AS PR_STATUS
          ,PRHA.DESCRIPTION AS PR_HEADER_DESCRIPTION
          ,PRLA.CURRENCY_CODE AS PR_CURRENCY
          ,PRLA.PO_HEADER_ID
          ,PRLA.PO_LINE_ID
          ,(NVL(PRDA.NONRECOVERABLE_CURRENCY_TAX, 0) + NVL(PRDA.DISTRIBUTION_CURRENCY_AMOUNT, 0)) * NVL(PRLA.RATE, 1) AS PR_VALUE_AED
          ,PRDA.DISTRIBUTION_ID
          ,FABUV.BU_NAME AS BUSINESS_UNIT
    FROM   POR_REQUISITION_HEADERS_ALL PRHA
          ,POR_REQUISITION_LINES_ALL PRLA
          ,POR_REQ_DISTRIBUTIONS_ALL PRDA
          ,FUN_ALL_BUSINESS_UNITS_V FABUV
    WHERE  PRHA.REQUISITION_HEADER_ID = PRLA.REQUISITION_HEADER_ID(+)
      AND  PRLA.REQUISITION_LINE_ID = PRDA.REQUISITION_LINE_ID(+)
      AND  PRLA.REQ_BU_ID = PRDA.REQ_BU_ID(+)
      AND  PRHA.REQ_BU_ID = FABUV.BU_ID(+)
),

-- 3. Receipt CTE
RECEIPT AS (
    SELECT /*+ qb_name(RECEIPT) MATERIALIZE */
           RSL.PO_HEADER_ID
          ,RSL.PO_LINE_ID
          ,RSL.PO_DISTRIBUTION_ID
          ,RSH.VENDOR_ID
          ,RSH.RECEIPT_NUM AS RECEIPT_NUMBER
          ,TO_CHAR(RSH.CREATION_DATE, 'YYYY-MM-DD') AS RECEIPT_CREATION_DATE
          ,RSH.CREATED_BY AS RECEIPT_CREATED_BY
          ,RT.QUANTITY AS RECEIPY_QTY
          ,TO_CHAR(RT.TRANSACTION_DATE, 'YYYY-MM-DD') AS RECEIPT_DATE
          ,ROUND(CASE 
              WHEN RSL.QUANTITY_DELIVERED > 0 
              THEN (RT.QUANTITY * RT.PO_UNIT_PRICE)
              ELSE RSL.AMOUNT_RECEIVED 
            END, 2) AS RECEIPT_VALUE
          ,CASE 
              WHEN RSL.QUANTITY_DELIVERED > 0 
              THEN NVL(RT.CURRENCY_CONVERSION_RATE, 1) * (RT.QUANTITY * RT.PO_UNIT_PRICE)
              ELSE NVL(RT.CURRENCY_CONVERSION_RATE, 1) * RSL.AMOUNT_RECEIVED 
            END AS RECEIPT_VALUE_AED
          ,RT.PO_UNIT_PRICE
          ,RT.TRANSACTION_ID
          ,RT.PO_LINE_LOCATION_ID
          ,RSH.CREATION_DATE
    FROM   RCV_SHIPMENT_HEADERS RSH
          ,RCV_SHIPMENT_LINES RSL
          ,RCV_TRANSACTIONS RT
    WHERE  RSH.SHIPMENT_HEADER_ID = RSL.SHIPMENT_HEADER_ID(+)
      AND  RSL.SHIPMENT_LINE_ID = RT.SHIPMENT_LINE_ID(+)
      AND  RSL.SHIPMENT_HEADER_ID = RT.SHIPMENT_HEADER_ID(+)
      AND  RT.TRANSACTION_TYPE = 'RECEIVE'
),

-- 4. Invoice CTE
INVOICE AS (
    SELECT /*+ qb_name(INVOICE) MATERIALIZE */
           INV.PO_HEADER_ID
          ,INV.PO_LINE_ID
          ,INV.INVOICE_ID
          ,INV.INVOICE_NUM AS INVOICE_NUMBER
          ,INV.QUANTITY_INVOICED AS INVOICE_QTY
          ,INV.AMOUNT AS INVOICE_VALUE
          ,INV.INVOICE_VALUE_AED
          ,INV.INVOICE_DATE
          ,INV.ORDERED_CURRENCY
          ,CK.PAYMENT_DATE
          ,CK.PAYMENT_STATUS
          ,CK.PAYMENT_NUMBER
          ,INV.PO_LINE_LOCATION_ID
          ,INV.PO_DISTRIBUTION_ID
          ,INV.RCV_TRANSACTION_ID
          ,CK.PAID_AMOUNT
          ,INV.INVOICE_STATUS
          ,INV.CREATION_DATE AS INVOICE_CREATION_DATE
    FROM   (SELECT AIA.PO_HEADER_ID
                  ,AILA.PO_LINE_ID
                  ,AILA.PO_LINE_LOCATION_ID
                  ,AILA.RCV_TRANSACTION_ID
                  ,AILA.QUANTITY_INVOICED
                  ,AILA.AMOUNT
                  ,AIA.EXCHANGE_RATE
                  ,NVL(AILA.AMOUNT * NVL(AIA.EXCHANGE_RATE, 1), 1) AS INVOICE_VALUE_AED
                  ,AIA.APPROVAL_STATUS AS INVOICE_STATUS
                  ,AIA.INVOICE_ID
                  ,AIA.INVOICE_NUM
                  ,AIA.INVOICE_CURRENCY_CODE AS ORDERED_CURRENCY
                  ,AIA.INVOICE_DATE
                  ,AIA.CREATION_DATE
                  ,AILA.PO_DISTRIBUTION_ID
            FROM   AP_INVOICES_ALL AIA
                  ,AP_INVOICE_LINES_ALL AILA
            WHERE  AIA.INVOICE_ID = AILA.INVOICE_ID(+)
              AND  AILA.LINE_TYPE_LOOKUP_CODE IN ('ITEM', 'RETAINAGE RELEASE')
           ) INV
          ,(SELECT AIPA.INVOICE_ID
                  ,TO_CHAR(ACA.CHECK_DATE, 'YYYY-MM-DD') AS PAYMENT_DATE
                  ,ACA.CHECK_NUMBER AS PAYMENT_NUMBER
                  ,SUM(ACA.AMOUNT) AS PAID_AMOUNT
                  ,ACA.STATUS_LOOKUP_CODE AS PAYMENT_STATUS
            FROM   AP_INVOICE_PAYMENTS_ALL AIPA
                  ,AP_CHECKS_ALL ACA
            WHERE  AIPA.CHECK_ID = ACA.CHECK_ID
              AND  ACA.STATUS_LOOKUP_CODE <> 'VOIDED'
            GROUP BY AIPA.INVOICE_ID, ACA.CHECK_DATE, ACA.CHECK_NUMBER, ACA.STATUS_LOOKUP_CODE
           ) CK
    WHERE  INV.INVOICE_ID = CK.INVOICE_ID(+)
      AND  INV.INVOICE_STATUS = 'APPROVED'
      AND  INV.AMOUNT <> 0
)

-- 5. Final SELECT
SELECT 
       PO.PO_NUMBER
      ,PO.PO_CREATION_DATE
      ,PO.PO_VALUE_AED
      ,PO.PO_STATUS
      ,PO.PO_LINE_NO
      ,REGEXP_REPLACE(PO.ITEM_DESCRIPTION, '[[:space:]]', ' ') AS DESCRIPTION
      ,PO.ITEM
      ,PO.SUPPLIER_NAME
      ,PO.SUPPLIER_SITE
      ,NVL(PO.BUSINESS_UNIT, PR.BUSINESS_UNIT) AS BUSINESS_UNIT
      ,PO.PO_APPROVED_DATE
      ,PO.PO_SCHEDULE_NO
      ,PO.PO_SCHEDULE_AMOUNT
      ,PO.CHARGE_CODE_COMBINATION
      ,(TRUNC(PO.APPROVED_DATE) - TRUNC(PR.APPROVED_DATE)) AS LEAD_TIME
      ,(PR.PR_VALUE_AED - PO.PO_VALUE_AED) AS SAVING
      ,PR.PR_VALUE_AED
      ,PR.PR_NUMBER
      ,PR.PR_CREATION_DATE
      ,PR.PR_APPROVED_DATE
      ,PR.PR_STATUS
      ,REGEXP_REPLACE(PR.PR_HEADER_DESCRIPTION, '[[:space:]]', ' ') AS PR_HEADER_DESCRIPTION
      ,PR.PR_CURRENCY
      ,RE.RECEIPT_CREATION_DATE
      ,RE.RECEIPT_CREATED_BY
      ,RE.RECEIPY_QTY
      ,RE.RECEIPT_VALUE
      ,RE.RECEIPT_VALUE_AED
      ,RE.RECEIPT_NUMBER
      ,RE.RECEIPT_DATE
      ,INV.INVOICE_NUMBER
      ,INV.INVOICE_QTY
      ,INV.INVOICE_VALUE
      ,INV.INVOICE_VALUE_AED
      ,INV.INVOICE_STATUS
      ,INV.PAYMENT_DATE
      ,INV.PAYMENT_NUMBER
      ,TO_CHAR(INV.INVOICE_CREATION_DATE, 'YYYY-MM-DD') AS INV_CREATION_DATE
      ,(PO.PO_SCHEDULE_AMOUNT - RE.RECEIPT_VALUE) AS PO_REMAINING_BALANCE
      ,CASE 
          WHEN RE.RECEIPT_VALUE = 0 THEN 0 
          ELSE (RE.RECEIPT_VALUE - INV.INVOICE_VALUE) 
        END AS GRN_REMAINING_BALANCE
FROM   PURCHASE_ORDER PO
      ,REQUISITION PR
      ,RECEIPT RE
      ,INVOICE INV
WHERE  PO.PO_HEADER_ID = PR.PO_HEADER_ID(+)
  AND  PO.REQ_DISTRIBUTION_ID = PR.DISTRIBUTION_ID(+)
  AND  PO.PO_DISTRIBUTION_ID = NVL(RE.PO_DISTRIBUTION_ID, PO.PO_DISTRIBUTION_ID)
  AND  PO.LINE_LOCATION_ID = RE.PO_LINE_LOCATION_ID(+)
  AND  PO.PO_DISTRIBUTION_ID = INV.PO_DISTRIBUTION_ID(+)
  AND  RE.TRANSACTION_ID = INV.RCV_TRANSACTION_ID(+)
  AND  PR.PR_CREATION_DATE BETWEEN NVL(:P_PR_FROM_DATE, PR.PR_CREATION_DATE) 
                               AND NVL(:P_PR_TO_DATE, PR.PR_CREATION_DATE)
  AND  (PO.BUSINESS_UNIT IN (:P_BUSSINESS_UNIT) OR 'ALL' IN (:P_BUSSINESS_UNIT || 'ALL'))
ORDER BY PO_NUMBER, PO_LINE_NO, PO_SCHEDULE_NO
```

---

## 2. Goods Received Notes (GRN) Report
*Receipt tracking with PO and Invoice matching.*

```sql
/*
TITLE: Goods Received Notes (GRN) Report
PURPOSE: Track receipts and match with POs and Invoices (2-way, 3-way match)
NOTE: This query shows GRN status for work confirmation and standard POs
*/

-- See detailed implementation in Procure to Pay template above
-- Key differences:
-- 1. Focus on GRN status logic
-- 2. Work confirmation integration
-- 3. Match validation (validated vs pending)
```

---

## 3. Supplier Evaluation Report
*Supplier qualification and performance tracking.*

```sql
/*
TITLE: Supplier Evaluation Report
PURPOSE: Track supplier qualifications and performance evaluation
MODULES: Supplier Qualification
PARAMETERS: None (shows all suppliers)
*/

SELECT 
       PABUV.BU_NAME AS PROCUREMENT_BU
      ,PI.INITIATIVE_NUMBER
      ,PI.TITLE AS INITIATIVE_TITLE
      ,PI.LAUNCH_DATE AS INITIATIVE_LAUNCH_DATE
      ,PQ.STATUS
      ,PSV.SEGMENT1 AS SUPPLIER_NUMBER
      ,PSV.VENDOR_NAME AS SUPPLIER_NAME
      ,PSSAM.VENDOR_SITE_CODE AS SUPPLIER_SITE
      ,PPNF2.FULL_NAME AS INTERNAL_REPONDER
      ,PQ.QUALIFICATION_NUMBER
      ,PQ.QUALIFICATION_NAME
      ,PQ.EFFECTIVE_START_DATE AS QUALIFICATION_START_DATE
      ,PQ.EFFECTIVE_END_DATE AS QUALIFICATION_END_DATE
      ,PQ.QUALIFICATION_SCORE
      ,PQ.QUALIFICATION_OUTCOME
      ,PQ.QUALIFICATION_COMMENTS AS COMMENTS
      ,PPNF1.DISPLAY_NAME AS EVALUATED_BY
      ,PQ.EVALUATION_DATE
      ,PIS.INTERNAL_RESPONDER_ID
FROM   POQ_INITIATIVES PI
      ,POQ_QUALIFICATIONS PQ
      ,POQ_INITIATIVE_SUPPLIERS PIS
      ,POZ_SUPPLIERS_V PSV
      ,POZ_SUPPLIER_SITES_ALL_M PSSAM
      ,PER_PERSON_NAMES_F PPNF1
      ,FUN_ALL_BUSINESS_UNITS_V PABUV
      ,PER_PERSON_NAMES_F PPNF2
WHERE  PI.INITIATIVE_ID = PQ.INITIATIVE_ID
  AND  PQ.SUPPLIER_ID = PIS.SUPPLIER_ID
  AND  PQ.INITIATIVE_ID = PIS.INITIATIVE_ID
  AND  PIS.SUPPLIER_ID = PSV.VENDOR_ID
  AND  PSV.VENDOR_ID = PSSAM.VENDOR_ID(+)
  AND  PQ.SUPPLIER_SITE_ID = PSSAM.VENDOR_SITE_ID(+)
  AND  PQ.EVALUATED_BY = PPNF1.PERSON_ID
  AND  PQ.PRC_BU_ID = PABUV.BU_ID
  AND  PIS.INTERNAL_RESPONDER_ID = PPNF2.PERSON_ID(+)
  AND  PPNF1.NAME_TYPE = 'GLOBAL'
  AND  PPNF2.NAME_TYPE = 'GLOBAL'
  AND  TRUNC(SYSDATE) BETWEEN PSSAM.EFFECTIVE_START_DATE(+) AND PSSAM.EFFECTIVE_END_DATE(+)
  AND  TRUNC(SYSDATE) BETWEEN PPNF1.EFFECTIVE_START_DATE AND PPNF1.EFFECTIVE_END_DATE
  AND  TRUNC(SYSDATE) BETWEEN PPNF2.EFFECTIVE_START_DATE AND PPNF2.EFFECTIVE_END_DATE
ORDER BY PI.INITIATIVE_NUMBER, PSV.VENDOR_NAME
```

---

## 4. Work Confirmation Tracking Report
*Track work confirmation for service-based POs with receipts and invoices.*

```sql
/*
TITLE: Work Confirmation Tracking Report
PURPOSE: Track work confirmations with GRN matching
NOTE: See Work Confirmation Report in PO_TEMPLATES.md for detailed implementation
*/

-- Key Integration:
-- PO → Work Confirmation → Receipt → Invoice
-- Uses WORK_CONFIRMATION_MASTER CTE from PO_REPOSITORIES.md
```

---

**Templates Count:** 3 primary cross-module templates  
**Coverage:** P2P, GRN, Supplier Evaluation  
**Last Updated:** 22-12-25

