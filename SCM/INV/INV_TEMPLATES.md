# Inventory Report Templates

**Purpose:** Ready-to-use SQL skeletons for Inv reporting.

---

## 1. Inventory On-Hand Report
*Current On-Hand by Item, Locator, and Project.*

```sql
/*
TITLE: Inventory On-Hand Report
PURPOSE: Current stock position with locators and project details
PARAMETERS:
  - None (shows all inventory)
*/

SELECT 
       IOQD.ORGANIZATION_ID
      ,IOQD.INVENTORY_ITEM_ID
      ,IOQD.REVISION
      ,IOQD.SUBINVENTORY_CODE
      ,IOQD.LOCATOR_ID
      ,IOQD.TRANSACTION_UOM_CODE
      ,SUM(IOQD.TRANSACTION_QUANTITY) AS TRANSACTION_QUANTITY
      ,IOQD.PROJECT_ID
      ,IOQD.TASK_ID
      ,NVL2(IIL.STRUCTURE_INSTANCE_NUMBER, 
            FND_FLEX_EXT.GET_SEGS('INV', 'MTLL', IIL.STRUCTURE_INSTANCE_NUMBER, 
                                  IIL.INVENTORY_LOCATION_ID, IIL.SUBINVENTORY_ID), 
            NULL) AS LOCATOR_NAME
      ,ESIB.ITEM_NUMBER
      ,ESIB1.DESCRIPTION
      ,PPAB.SEGMENT1 AS PROJECT_NUMBER
      ,PTV.TASK_NUMBER
      ,CASE 
          WHEN ESIB.LOT_CONTROL_CODE = 2 THEN 'Y'
          ELSE 'N'
        END AS LOT_CONTROL_CODE
      ,CASE 
          WHEN ESIB.SERIAL_NUMBER_CONTROL_CODE != 1 THEN 'Y'
          ELSE 'N'
        END AS SERIAL_NUMBER_CONTROL_CODE
FROM   INV_ONHAND_QUANTITIES_DETAIL IOQD
      ,INV_ITEM_LOCATIONS IIL
      ,EGP_SYSTEM_ITEMS_B ESIB
      ,EGP_SYSTEM_ITEMS_TL ESIB1
      ,PJF_PROJECTS_ALL_B PPAB
      ,PJF_TASKS_V PTV
WHERE  IOQD.LOCATOR_ID = IIL.INVENTORY_LOCATION_ID(+)
  AND  IOQD.INVENTORY_ITEM_ID = ESIB.INVENTORY_ITEM_ID
  AND  IOQD.ORGANIZATION_ID = ESIB.ORGANIZATION_ID
  AND  ESIB.INVENTORY_ITEM_ID = ESIB1.INVENTORY_ITEM_ID
  AND  ESIB.ORGANIZATION_ID = ESIB1.ORGANIZATION_ID
  AND  IOQD.PROJECT_ID = PPAB.PROJECT_ID(+)
  AND  IOQD.PROJECT_ID = PTV.PROJECT_ID(+)
  AND  IOQD.TASK_ID = PTV.TASK_ID(+)
GROUP BY 
       IOQD.ORGANIZATION_ID
      ,IOQD.INVENTORY_ITEM_ID
      ,IOQD.REVISION
      ,IOQD.SUBINVENTORY_CODE
      ,IOQD.LOCATOR_ID
      ,IOQD.TRANSACTION_UOM_CODE
      ,IOQD.PROJECT_ID
      ,IOQD.TASK_ID
      ,IIL.STRUCTURE_INSTANCE_NUMBER
      ,IIL.INVENTORY_LOCATION_ID
      ,IIL.SUBINVENTORY_ID
      ,ESIB.ITEM_NUMBER
      ,ESIB1.DESCRIPTION
      ,PPAB.SEGMENT1
      ,PTV.TASK_NUMBER
      ,ESIB.LOT_CONTROL_CODE
      ,ESIB.SERIAL_NUMBER_CONTROL_CODE
ORDER BY 
       IOQD.ORGANIZATION_ID
      ,ESIB.ITEM_NUMBER
      ,IOQD.SUBINVENTORY_CODE
```

---

## 2. Inventory Transaction Report
*Detailed material transaction history with source tracking.*

```sql
/*
TITLE: Inventory Transaction Report
PURPOSE: Track all inventory movements with source documents
PARAMETERS:
  - :P_TRX_PERIOD - Transaction Period (YYYY format, e.g., '2025')
  - :P_ORG - Organization Code
  - :P_ITEM - Item Number (or 'All')
  - :P_ITEM_CAT - Item Category (or 'All')
*/

WITH
-- 1. Inventory Transactions CTE
INV_TRX AS (
    SELECT /*+ qb_name(INV_TRX) MATERIALIZE */
           ITST.TRANSACTION_SOURCE_TYPE_NAME
          ,IMT.TRANSACTION_ID
          ,IMT.DISTRIBUTION_ACCOUNT_ID
          ,IRTH.DESCRIPTION
          ,ITR_S.MEANING AS HEADER_STATUS
          ,IMT.INVENTORY_ITEM_ID
          ,IMT.ORGANIZATION_ID AS ORGANIZATION_ID_INV
          ,IMT.SUBINVENTORY_CODE
          ,IMT.SUBINVENTORY_CODE AS SUBINVENTORY_CODE1
          ,IMT.TRANSACTION_ACTION_ID
          ,IMT.TRANSACTION_DATE
          ,IMT.TRANSACTION_UOM
          ,IMT.TRANSACTION_QUANTITY
          ,IMT.TRANSACTION_SOURCE_NAME
          ,INV_ACTION.TRANSACTION_ACTION AS TRX_ACTION
          ,IMT.TRANSACTION_SOURCE_TYPE_ID
          ,IMT.CREATED_BY
          ,IMT.CREATION_DATE
          ,IMT.TRANSACTION_TYPE_ID
          ,IMT.TRANSFER_ORGANIZATION_ID
          ,IMT.REQUESTER_ID
          ,IMT.TRANSFER_SUBINVENTORY
          ,NVL(IMT.LOCATOR_ID, 0) AS LOCATOR_ID
          ,IMT.TRANSFER_TRANSACTION_ID
          ,IMT.CURRENCY_CODE
          ,CASE 
              WHEN IMT.JOB_DEFINITION_NAME IS NOT NULL 
              THEN 'Interfaced to costing'
              ELSE 'Pending interface to costing'
            END AS COSTING
          ,SUBINV.DESCRIPTION AS SUBDESC
          ,SUBINV.SUBINVENTORY_ID AS IMT_SUBINV_SUBINVENTORY_ID
          ,SUBINV.ORGANIZATION_ID AS IMT_SUBINV_ORGANIZATION_ID
          ,IMT.INVENTORY_ITEM_ID AS IMT_INVENTORY_ITEM_ID
          ,IMT.TRANSACTION_SET_ID
          ,IMT.TRANSACTION_SOURCE_ID
          ,IMT.SHIPMENT_NUMBER
          ,IMT.PICKING_LINE_ID
          ,IMT.RCV_TRANSACTION_ID
          ,IMT.PICK_SLIP_NUMBER
          ,IMT.TRANSACTION_REFERENCE
          ,ISO.SALES_ORDER_ID
          ,ISO.SALES_ORDER_NUMBER
          ,PHA.PO_HEADER_ID AS PO_HEADER_ID1
          ,PHA.SEGMENT1 AS PONUMBER
          ,PLA.LINE_NUM AS POLINE_NUM
          ,RSL.LINE_NUM AS SHLINE_NUM
          ,RSH.RECEIPT_NUM
          ,IMT.DEFAULT_TAXATION_COUNTRY AS TAXATION
          ,IMT.TRX_BUSINESS_CATEGORY
          ,IMT.PRODUCT_TYPE
          ,IMT.ASSESSABLE_VALUE
          ,IMT.TRANSFER_LOCATOR_ID
    FROM   INV_MATERIAL_TXNS IMT
          ,INV_ORG_PARAMETERS IOP
          ,INV_TXN_SOURCE_TYPES_VL ITST
          ,INV_TXN_REQUEST_HEADERS IRTH
          ,(SELECT LOOKUP_CODE, MEANING 
            FROM FND_LOOKUPS 
            WHERE LOOKUP_TYPE = 'INV_TXN_REQUEST_STATUS' 
              AND ENABLED_FLAG = 'Y') ITR_S
          ,(SELECT LOOKUP_CODE, MEANING AS TRANSACTION_ACTION 
            FROM FND_LOOKUP_VALUES 
            WHERE LOOKUP_TYPE = 'INV_TRANSACTION_ACTION' 
              AND SOURCE_LANG = 'US') INV_ACTION
          ,INV_SECONDARY_INVENTORIES SUBINV
          ,INV_SECONDARY_INVENTORIES ISV1
          ,INV_SALES_ORDERS ISO
          ,RCV_TRANSACTIONS RTPEO
          ,PO_HEADERS_ALL PHA
          ,PO_LINES_ALL PLA
          ,RCV_SHIPMENT_HEADERS RSH
          ,RCV_SHIPMENT_LINES RSL
    WHERE  IMT.ORGANIZATION_ID = IOP.ORGANIZATION_ID
      AND  IMT.TRANSACTION_SOURCE_ID = IRTH.HEADER_ID(+)
      AND  IRTH.HEADER_STATUS = ITR_S.LOOKUP_CODE(+)
      AND  IMT.TRANSACTION_ACTION_ID = INV_ACTION.LOOKUP_CODE(+)
      AND  IMT.ORGANIZATION_ID = SUBINV.ORGANIZATION_ID(+)
      AND  IMT.SUBINVENTORY_CODE = SUBINV.SECONDARY_INVENTORY_NAME(+)
      AND  IMT.TRANSFER_SUBINVENTORY = ISV1.SECONDARY_INVENTORY_NAME(+)
      AND  IMT.TRANSACTION_SOURCE_TYPE_ID = ITST.TRANSACTION_SOURCE_TYPE_ID(+)
      AND  IMT.TRANSACTION_SOURCE_ID = ISO.SALES_ORDER_ID(+)
      AND  IMT.RCV_TRANSACTION_ID = RTPEO.TRANSACTION_ID(+)
      AND  RTPEO.PO_HEADER_ID = PHA.PO_HEADER_ID(+)
      AND  RTPEO.PO_LINE_ID = PLA.PO_LINE_ID(+)
      AND  RTPEO.SHIPMENT_HEADER_ID = RSH.SHIPMENT_HEADER_ID(+)
      AND  RTPEO.SHIPMENT_LINE_ID = RSL.SHIPMENT_LINE_ID(+)
      AND  TO_CHAR(IMT.TRANSACTION_DATE, 'YYYY') = :P_TRX_PERIOD
),

-- 2. Transaction Type CTE
TRX_TYPE AS (
    SELECT /*+ qb_name(TRX_TYPE) MATERIALIZE */
           ITT_B.TRANSACTION_TYPE_ID
          ,ITT.TRANSACTION_TYPE_ID AS TRANSACTION_TYPE_ID1
          ,ITT.LANGUAGE
          ,ITT.TRANSACTION_TYPE_NAME
    FROM   INV_TRANSACTION_TYPES_B ITT_B
          ,INV_TRANSACTION_TYPES_TL ITT
    WHERE  ITT_B.TRANSACTION_TYPE_ID = ITT.TRANSACTION_TYPE_ID
      AND  USERENV('LANG') = ITT.LANGUAGE
),

-- 3. Inventory Organization CTE
INV_ORG AS (
    SELECT /*+ qb_name(INV_ORG) MATERIALIZE */
           IOP.ORGANIZATION_CODE
          ,IOP.ORGANIZATION_ID
          ,HOU.NAME AS NAME4
    FROM   INV_ORG_PARAMETERS IOP
          ,HR_ORGANIZATION_UNITS_F_TL HOU
    WHERE  IOP.ORGANIZATION_ID = HOU.ORGANIZATION_ID(+)
      AND  USERENV('LANG') = HOU.LANGUAGE(+)
),

-- 4. Locator CTE
LOCATOR_V AS (
    SELECT /*+ qb_name(LOCATOR_V) MATERIALIZE */
           IIL.INVENTORY_LOCATION_ID
          ,IIL.STRUCTURE_INSTANCE_NUMBER
          ,IIL.SUBINVENTORY_ID
          ,ISI.ORGANIZATION_ID AS SUBINV_ORGANIZATION_ID
          ,NVL2(IIL.STRUCTURE_INSTANCE_NUMBER, 
                FND_FLEX_EXT.GET_SEGS('INV', 'MTLL', IIL.STRUCTURE_INSTANCE_NUMBER, 
                                      IIL.INVENTORY_LOCATION_ID, IIL.SUBINVENTORY_ID), 
                NULL) AS LOCATOR_NAME
    FROM   INV_ITEM_LOCATIONS IIL
          ,INV_SECONDARY_INVENTORIES ISI
    WHERE  IIL.ORGANIZATION_ID(+) = ISI.ORGANIZATION_ID
      AND  IIL.SUBINVENTORY_CODE(+) = ISI.SECONDARY_INVENTORY_NAME
),

-- 5. Item Details CTE
ITEM_DETAILS AS (
    SELECT /*+ qb_name(ITEM_DTL) MATERIALIZE */
           ESI_B.INVENTORY_ITEM_ID
          ,ESI_B.ORGANIZATION_ID
          ,ESI_B.ITEM_NUMBER
          ,IUOMV.UNIT_OF_MEASURE AS PRIMARY_UOM_CODE
          ,ITETL.DESCRIPTION
          ,ECV.CATEGORY_NAME AS ITEM_CATEGORY
    FROM   EGP_SYSTEM_ITEMS_B_V ESI_B
          ,EGP_SYSTEM_ITEMS_TL_V ITETL
          ,INV_UNITS_OF_MEASURE_VL IUOMV
          ,EGP_ITEM_CATEGORIES EIC
          ,EGP_CATEGORIES_VL ECV
    WHERE  ESI_B.INVENTORY_ITEM_ID = ITETL.INVENTORY_ITEM_ID
      AND  ESI_B.ORGANIZATION_ID = ITETL.ORGANIZATION_ID
      AND  ESI_B.PRIMARY_UOM_CODE = IUOMV.UOM_CODE
      AND  USERENV('LANG') = ITETL.LANGUAGE
      AND  ESI_B.TEMPLATE_ITEM_FLAG = 'N'
      AND  ESI_B.INVENTORY_ITEM_ID = EIC.INVENTORY_ITEM_ID(+)
      AND  ESI_B.ORGANIZATION_ID = EIC.ORGANIZATION_ID(+)
      AND  EIC.CATEGORY_ID = ECV.CATEGORY_ID(+)
),

-- 6. Cost CTE
COST AS (
    SELECT /*+ qb_name(COST) MATERIALIZE */
           ROUND(AVG(CPC.UNIT_COST_AVERAGE), 5) AS ACTUAL_COST
          ,CIT.EXTERNAL_SYSTEM_REF_ID
          ,CPC.COST_ORG_ID
          ,CPC.COST_BOOK_ID
          ,CPC.INVENTORY_ITEM_ID
          ,CTCS.INVENTORY_ORG_ID
    FROM   CST_INV_TRANSACTIONS CIT
          ,CST_TRANSACTIONS CTCS
          ,CST_PERPAVG_COST CPC
    WHERE  CIT.CST_INV_TRANSACTION_ID = CTCS.CST_INV_TRANSACTION_ID
      AND  CIT.EXTERNAL_SYSTEM_REFERENCE = 'FUSION'
      AND  CPC.COST_BOOK_ID = CTCS.COST_BOOK_ID
      AND  CPC.COST_ORG_ID = CTCS.COST_ORG_ID
      AND  CPC.VAL_UNIT_ID = CTCS.VAL_UNIT_ID
      AND  CPC.INVENTORY_ITEM_ID = CTCS.INVENTORY_ITEM_ID
      AND  CTCS.TRANSACTION_DATE != CPC.COST_END_DATE
      AND  CTCS.TRANSACTION_DATE BETWEEN CPC.COST_DATE AND CPC.COST_END_DATE
    GROUP BY 
           CIT.EXTERNAL_SYSTEM_REF_ID
          ,CPC.COST_ORG_ID
          ,CPC.COST_BOOK_ID
          ,CPC.INVENTORY_ITEM_ID
          ,CTCS.INVENTORY_ORG_ID
),

-- 7. Transfer Locator CTE
TRANSF_LOCATOR_V AS (
    SELECT /*+ qb_name(TLV) MATERIALIZE */
           IIL.INVENTORY_LOCATION_ID
          ,NVL2(IIL.STRUCTURE_INSTANCE_NUMBER, 
                FND_FLEX_EXT.GET_SEGS('INV', 'MTLL', IIL.STRUCTURE_INSTANCE_NUMBER, 
                                      IIL.INVENTORY_LOCATION_ID, IIL.SUBINVENTORY_ID), 
                NULL) AS LOCATOR_NAME
    FROM   INV_ITEM_LOCATIONS IIL
          ,INV_SECONDARY_INVENTORIES ISI
    WHERE  IIL.ORGANIZATION_ID(+) = ISI.ORGANIZATION_ID
      AND  IIL.SUBINVENTORY_CODE(+) = ISI.SECONDARY_INVENTORY_NAME
)

-- 8. Final SELECT
SELECT DISTINCT
       IT.TRANSACTION_SOURCE_TYPE_NAME
      ,IT.TRANSACTION_ID
      ,IT.TRANSACTION_ID AS IMT_TRANSACTION_ID
      ,IT.DISTRIBUTION_ACCOUNT_ID
      ,IT.HEADER_STATUS AS STATUS
      ,IO.ORGANIZATION_CODE AS ORG_CODE
      ,IO.NAME4 AS ORG_NAME
      ,(HOU.NAME) AS ORG_TO
      ,NVL2(GCC.CODE_COMBINATION_ID, 
            FND_FLEX_XML_PUBLISHER_APIS.PROCESS_KFF_COMBINATION_1('FLEXFIELD', 'GL', 'GL#', 
                                                                    GCC.CHART_OF_ACCOUNTS_ID, NULL, 
                                                                    GCC.CODE_COMBINATION_ID, 'ALL', 'Y', 'VALUE'), 
            NULL) AS GL_ACCOUNT_CODE
      ,TT.TRANSACTION_TYPE_NAME AS TRANSACTION_TYPE
      ,IT.TRX_ACTION
      ,TRUNC(IT.TRANSACTION_DATE) AS TRANSACTION_DATE
      ,IT.DESCRIPTION AS REMARKS
      ,IO.ORGANIZATION_CODE AS ISSUE_ORG2
      ,IT.SUBINVENTORY_CODE AS ISSUE_SUBINV
      ,IO.ORGANIZATION_CODE AS RECEIVING_ORG
      ,IT.SUBINVENTORY_CODE AS RECEIVING_SUBINV
      ,IT.TRANSFER_SUBINVENTORY
      ,LV.LOCATOR_NAME
      ,IT.TRANSFER_TRANSACTION_ID
      ,NVL(IT.CURRENCY_CODE, 'AED') AS CURRENCY_CODE
      ,IT.COSTING
      ,IT.TRANSACTION_SET_ID
      ,IT.TRANSACTION_SOURCE_ID
      ,IT.SHIPMENT_NUMBER
      ,IT.PICKING_LINE_ID
      ,IT.RCV_TRANSACTION_ID
      ,IT.PICK_SLIP_NUMBER
      ,IT.TRANSACTION_REFERENCE
      ,IT.SALES_ORDER_ID
      ,NVL(IT.SALES_ORDER_NUMBER, IT.PONUMBER) AS SALES_ORDER_NUMBER
      ,IT.PO_HEADER_ID1
      ,IT.PONUMBER
      ,IT.TRANSACTION_QUANTITY AS QTY
      ,ID.PRIMARY_UOM_CODE AS UNIT
      ,NULL AS TO_SERIAL_NO
      ,NULL AS FROM_SERIAL_NO
      ,ID.DESCRIPTION
      ,ID.ITEM_NUMBER AS ITEM_CODE
      ,ID.ITEM_CATEGORY
      ,NULL AS SNO
      ,IT.IMT_SUBINV_SUBINVENTORY_ID
      ,IT.IMT_SUBINV_ORGANIZATION_ID
      ,IT.IMT_INVENTORY_ITEM_ID
      ,IT.CREATION_DATE
      ,IT.CREATED_BY
      ,IT.RECEIPT_NUM
      ,IT.POLINE_NUM
      ,IT.SHLINE_NUM
      ,IT.TAXATION
      ,IT.TRX_BUSINESS_CATEGORY
      ,IT.PRODUCT_TYPE
      ,IT.ASSESSABLE_VALUE
      ,TO_CHAR(IT.TRANSACTION_DATE, 'Mon-YY', 'NLS_DATE_LANGUAGE=AMERICAN') AS PERIOD
      ,CO.ACTUAL_COST
      ,CO.EXTERNAL_SYSTEM_REF_ID
      ,TLV.LOCATOR_NAME AS TRANSF_LOCATOR
      ,IOP.ORGANIZATION_CODE AS ISSUE_ORG
FROM   INV_TRX IT
      ,LOCATOR_V LV
      ,TRX_TYPE TT
      ,INV_ORG IO
      ,INV_ORG_PARAMETERS IOP
      ,HR_ORGANIZATION_UNITS_F_TL HOU
      ,ITEM_DETAILS ID
      ,GL_CODE_COMBINATIONS GCC
      ,COST CO
      ,TRANSF_LOCATOR_V TLV
WHERE  CO.EXTERNAL_SYSTEM_REF_ID(+) = IT.TRANSACTION_ID
  AND  IT.TRANSACTION_TYPE_ID = TT.TRANSACTION_TYPE_ID
  AND  IT.ORGANIZATION_ID_INV = IO.ORGANIZATION_ID
  AND  IT.TRANSFER_ORGANIZATION_ID = IOP.ORGANIZATION_ID(+)
  AND  IOP.ORGANIZATION_ID = HOU.ORGANIZATION_ID(+)
  AND  USERENV('LANG') = HOU.LANGUAGE(+)
  AND  IT.LOCATOR_ID = LV.INVENTORY_LOCATION_ID(+)
  AND  IT.TRANSFER_LOCATOR_ID = TLV.INVENTORY_LOCATION_ID(+)
  AND  IT.ORGANIZATION_ID_INV = ID.ORGANIZATION_ID
  AND  IT.INVENTORY_ITEM_ID = ID.INVENTORY_ITEM_ID
  AND  IT.DISTRIBUTION_ACCOUNT_ID = GCC.CODE_COMBINATION_ID(+)
  AND  IO.ORGANIZATION_CODE IN (:P_ORG)
  AND  (ID.ITEM_NUMBER IN (:P_ITEM) OR 'All' IN (:P_ITEM || 'All'))
  AND  (ID.ITEM_CATEGORY IN (:P_ITEM_CAT) OR 'All' IN (:P_ITEM_CAT || 'All'))
ORDER BY IT.TRANSACTION_ID
```

---

## 3. Goods Received Notes (GRN) Report
*Receipt tracking with PO and Invoice matching.*

```sql
/*
TITLE: Goods Received Notes (GRN) Report
PURPOSE: Track receipts and match with POs and Invoices
NOTE: This template is in Cross-Module section as it spans PO, INV, and AP modules
*/

-- See CROSS_MODULE_TEMPLATES.md for GRN Report template
```
