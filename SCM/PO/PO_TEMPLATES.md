# Purchasing Report Templates

**Purpose:** Ready-to-use SQL skeletons for PO reporting.

---

## 1. PO Detail Report
*Comprehensive PO details with approval workflow, requester, and line details.*

```sql
/*
TITLE: Purchase Order Detail Report
PURPOSE: Detailed PO listing with all key information
PARAMETERS:
  - :P_PROCUREMENT_BU - Business Unit
  - :P_PO_STATUS - PO Status (APPROVED, OPEN, etc.)
  - :P_PO_FROM_DATE - PO Creation From Date
  - :P_PO_TO_DATE - PO Creation To Date
  - :P_PO_NUMBER_FROM - PO Number From
  - :P_PO_NUMBER_TO - PO Number To
  - :P_BUYER_NAME - Buyer Name
  - :P_PO_TYPE - PO Type
*/

WITH
-- 1. PO Approver CTE
APPROVER AS (
    SELECT /*+ qb_name(APPROVER) MATERIALIZE */
           PAH.OBJECT_ID AS PO_HEADER_ID
          ,PPNF.DISPLAY_NAME AS APPROVER
          ,PAH.ACTION_DATE
          ,PAH.ACTION_CODE
          ,RANK() OVER (PARTITION BY PAH.OBJECT_ID ORDER BY PAH.ACTION_DATE) AS RN
    FROM   PO_ACTION_HISTORY PAH
          ,PER_PERSON_NAMES_F PPNF
    WHERE  PAH.PERFORMER_ID = PPNF.PERSON_ID
      AND  PAH.ACTION_CODE = 'APPROVE'
      AND  PAH.OBJECT_TYPE_CODE = 'PO'
      AND  PPNF.NAME_TYPE = 'GLOBAL'
      AND  TRUNC(SYSDATE) BETWEEN TRUNC(PPNF.EFFECTIVE_START_DATE) 
                              AND TRUNC(PPNF.EFFECTIVE_END_DATE)
),

-- 2. PO Master with Amount
PO_AMT AS (
    SELECT /*+ qb_name(PO_AMT) MATERIALIZE */
           PHA.PO_HEADER_ID
          ,SUM(ROUND(CASE 
              WHEN PLA.UNIT_PRICE IS NOT NULL AND PLA.QUANTITY IS NOT NULL 
              THEN NVL(PHA.RATE, 1) * (PLA.UNIT_PRICE * PLA.QUANTITY)
              ELSE NVL(PHA.RATE, 1) * PLA.LIST_PRICE 
            END, 2)) AS PO_AMT_AED
          ,SUM(ROUND(CASE 
              WHEN PLA.UNIT_PRICE IS NOT NULL AND PLA.QUANTITY IS NOT NULL 
              THEN (PLA.UNIT_PRICE * PLA.QUANTITY)
              ELSE PLA.LIST_PRICE 
            END, 2)) AS PO_AMT
    FROM   PO_HEADERS_ALL PHA
          ,PO_LINES_ALL PLA
    WHERE  PHA.PO_HEADER_ID = PLA.PO_HEADER_ID(+)
    GROUP BY PHA.PO_HEADER_ID
),

-- 3. Buyer Master
BUYER_NAME AS (
    SELECT /*+ qb_name(BUYER) MATERIALIZE */
           PPNF.DISPLAY_NAME
          ,PO1.PO_HEADER_ID
          ,PU.USERNAME AS RUN_BY
          ,PPNF.FIRST_NAME || ' ' || PPNF.LAST_NAME AS REQUESTOR
    FROM   PER_PERSON_NAMES_F PPNF
          ,PO_HEADERS_ALL PO1
          ,PER_USERS PU
    WHERE  PO1.AGENT_ID = PPNF.PERSON_ID(+)
      AND  PPNF.PERSON_ID = PU.PERSON_ID
      AND  PPNF.NAME_TYPE = 'GLOBAL'
      AND  TRUNC(SYSDATE) BETWEEN TRUNC(PPNF.EFFECTIVE_START_DATE) 
                              AND TRUNC(PPNF.EFFECTIVE_END_DATE)
),

-- 4. Requisition Link
REQ AS (
    SELECT /*+ qb_name(REQ) MATERIALIZE */
           PRHA.REQUISITION_NUMBER
          ,PRLA.PO_HEADER_ID
          ,PRLA.REQUESTER_ID
          ,PRDA.DISTRIBUTION_ID
          ,PRHA.ATTRIBUTE2 AS SINGLE_SOURCE
          ,PRHA.ATTRIBUTE3 AS BUSINESS_JUSTIFICATION
          ,PRHA.ATTRIBUTE4 AS PLANNED_UNPLANNED
    FROM   POR_REQUISITION_HEADERS_ALL PRHA
          ,POR_REQUISITION_LINES_ALL PRLA
          ,POR_REQ_DISTRIBUTIONS_ALL PRDA
    WHERE  PRHA.REQUISITION_HEADER_ID = PRLA.REQUISITION_HEADER_ID(+)
      AND  PRLA.REQUISITION_LINE_ID = PRDA.REQUISITION_LINE_ID(+)
),

-- 5. Requester Details
NAME_R AS (
    SELECT /*+ qb_name(NAME_R) MATERIALIZE */
           PPNF.FIRST_NAME || ' ' || PPNF.LAST_NAME AS REQUESTER
          ,PPNF.PERSON_ID
          ,PU.USERNAME AS REQUESTER_ID
    FROM   PER_PERSON_NAMES_F PPNF
          ,PER_USERS PU
    WHERE  PPNF.PERSON_ID(+) = PU.PERSON_ID
      AND  PPNF.NAME_TYPE = 'GLOBAL'
      AND  TRUNC(SYSDATE) BETWEEN TRUNC(PPNF.EFFECTIVE_START_DATE) 
                              AND TRUNC(PPNF.EFFECTIVE_END_DATE)
),

-- 6. Document Style
STYLE AS (
    SELECT /*+ qb_name(STYLE) MATERIALIZE */
           PDSLB.DOCUMENT_SUBTYPE
          ,PDSLB.STYLE_ID
          ,PDSLT.DISPLAY_NAME
          ,PDSLT.LANGUAGE
    FROM   PO_DOC_STYLE_LINES_B PDSLB
          ,PO_DOC_STYLE_LINES_TL PDSLT
    WHERE  PDSLB.STYLE_ID = PDSLT.STYLE_ID
      AND  PDSLB.DOCUMENT_SUBTYPE = PDSLT.DOCUMENT_SUBTYPE
      AND  USERENV('LANG') = PDSLT.LANGUAGE
)

-- 7. Final SELECT
SELECT 
       PHA.SEGMENT1 AS PO_NUMBER
      ,TO_CHAR(PHA.CREATION_DATE, 'YYYY-MM-DD') AS PO_CREATION_DATE
      ,REGEXP_REPLACE(PHA.COMMENTS, '[[:space:]]', ' ') AS PO_HEADER_DESCRIPTION
      ,PHA.DOCUMENT_STATUS AS PO_STATUS
      ,STYLE.DISPLAY_NAME AS PO_TYPE
      ,PLA.LINE_NUM AS PO_LINE_NO
      ,AMT.PO_AMT
      ,AMT.PO_AMT_AED AS PO_AMOUNT_AED
      ,(SELECT APPROVER FROM APPROVER WHERE PO_HEADER_ID = PHA.PO_HEADER_ID AND RN = 1 AND ROWNUM = 1) AS APPROVER1
      ,(SELECT ACTION_DATE FROM APPROVER WHERE PO_HEADER_ID = PHA.PO_HEADER_ID AND RN = 1 AND ROWNUM = 1) AS APPROVED_DATE1
      ,BUYER_NAME.DISPLAY_NAME AS BUYER
      ,PSV.VENDOR_NAME AS SUPPLIER_NAME
      ,PSSV.VENDOR_SITE_CODE AS SUPPLIER_SITE
      ,REQ.REQUISITION_NUMBER
      ,REQ.SINGLE_SOURCE
      ,REQ.BUSINESS_JUSTIFICATION
      ,REQ.PLANNED_UNPLANNED
      ,(CASE WHEN REQ.REQUISITION_NUMBER IS NULL THEN NAME_R1.REQUESTER ELSE NAME_R.REQUESTER END) AS REQUESTER_NAME
      ,(CASE WHEN REQ.REQUISITION_NUMBER IS NULL THEN NAME_R1.REQUESTER_ID ELSE NAME_R.REQUESTER_ID END) AS REQUESTER_ID
      ,PLLA.SHIPMENT_NUM AS PO_SCHEDULE_NO
      ,PLLA.ASSESSABLE_VALUE AS PO_SCHEDULE_AMOUNT
      ,(NVL(PLLA.ASSESSABLE_VALUE, 0) * NVL(PHA.RATE, 1)) AS PO_SCHEDULE_AMOUNT_AED
      ,PDA.DISTRIBUTION_NUM
      ,REGEXP_REPLACE(PLA.ITEM_DESCRIPTION, '[[:space:]]', ' ') AS DESCRIPTION
      ,ESIV.DESCRIPTION AS ITEM
      ,PHA.CURRENCY_CODE AS CURRENCY
      ,PHA.RATE AS EXCHANGE_RATE
      ,ECV.DESCRIPTION AS CATEGORY
      ,PLLA.QUANTITY
      ,CASE 
          WHEN PLLA.UOM_CODE = 'Ea' THEN 'Each'
          WHEN PLLA.UOM_CODE = 'MON' THEN 'Months'
          WHEN PLLA.UOM_CODE = 'YRS' THEN 'Years'
          ELSE PLLA.UOM_CODE 
        END AS UOM
      ,PLLA.PRICE_OVERRIDE AS PRICE
      ,OKHAB.CONTRACT_NUMBER AS MASTER_CONTRACT_NUMBER
      ,APT.NAME AS PAYMENT_TERMS
      ,PHA.ATTRIBUTE1 AS EXPENDITURE_TYPE
      ,FABUV.BU_NAME AS PROCUREMENT_BU
      ,GCC.SEGMENT1 || '-' || GCC.SEGMENT2 || '-' || GCC.SEGMENT3 || '-' || GCC.SEGMENT4 || '-' || GCC.SEGMENT5 || '-' || GCC.SEGMENT6 || '-' || GCC.SEGMENT7 AS PO_CHARGE_ACCOUNT
      ,PLTB.LINE_TYPE
      ,(CASE 
          WHEN PLLA.QUANTITY_RECEIVED IS NOT NULL AND PLLA.PRICE_OVERRIDE IS NOT NULL 
          THEN (PLLA.QUANTITY_RECEIVED * PLLA.PRICE_OVERRIDE)
          ELSE PLLA.AMOUNT_RECEIVED 
        END) AS MATCHED_AMOUNT
      ,(PO_SCHEDULE_AMOUNT - MATCHED_AMOUNT) AS REMAINING_AMOUNT
FROM   PO_HEADERS_ALL PHA
      ,PO_LINES_ALL PLA
      ,PO_DISTRIBUTIONS_ALL PDA
      ,POZ_SUPPLIERS_V PSV
      ,POZ_SUPPLIER_SITES_V PSSV
      ,PO_LINE_LOCATIONS_ALL PLLA
      ,EGP_CATEGORIES_VL ECV
      ,EGP_SYSTEM_ITEMS_VL ESIV
      ,PO_LINE_TYPES_V PLTB
      ,BUYER_NAME
      ,REQ
      ,NAME_R
      ,NAME_R NAME_R1
      ,OKC_K_HEADERS_ALL_B OKHAB
      ,AP_TERMS_TL APT
      ,FUN_ALL_BUSINESS_UNITS_V FABUV
      ,GL_CODE_COMBINATIONS GCC
      ,PO_AMT AMT
      ,STYLE
WHERE  PHA.PO_HEADER_ID = PLA.PO_HEADER_ID(+)
  AND  PLA.PO_HEADER_ID = PDA.PO_HEADER_ID(+)
  AND  PLA.PO_LINE_ID = PDA.PO_LINE_ID(+)
  AND  PDA.CODE_COMBINATION_ID = GCC.CODE_COMBINATION_ID(+)
  AND  PHA.VENDOR_ID = PSV.VENDOR_ID(+)
  AND  PHA.VENDOR_SITE_ID = PSSV.VENDOR_SITE_ID(+)
  AND  PLA.PO_HEADER_ID = PLLA.PO_HEADER_ID(+)
  AND  PLA.PO_LINE_ID = PLLA.PO_LINE_ID(+)
  AND  PDA.LINE_LOCATION_ID = PLLA.LINE_LOCATION_ID(+)
  AND  PLA.CATEGORY_ID = ECV.CATEGORY_ID(+)
  AND  PLA.ITEM_ID = ESIV.INVENTORY_ITEM_ID(+)
  AND  PDA.DESTINATION_ORGANIZATION_ID = ESIV.ORGANIZATION_ID(+)
  AND  PLA.LINE_TYPE_ID = PLTB.LINE_TYPE_ID(+)
  AND  PHA.PO_HEADER_ID = REQ.PO_HEADER_ID(+)
  AND  PDA.REQ_DISTRIBUTION_ID = REQ.DISTRIBUTION_ID(+)
  AND  REQ.REQUESTER_ID = NAME_R.PERSON_ID(+)
  AND  PDA.DELIVER_TO_PERSON_ID = NAME_R1.PERSON_ID(+)
  AND  PHA.PO_HEADER_ID = BUYER_NAME.PO_HEADER_ID(+)
  AND  PHA.MASTER_CONTRACT_ID = OKHAB.CONTRACT_ID(+)
  AND  PHA.TERMS_ID = APT.TERM_ID(+)
  AND  PHA.PRC_BU_ID = FABUV.BU_ID
  AND  PHA.PO_HEADER_ID = AMT.PO_HEADER_ID(+)
  AND  PHA.TYPE_LOOKUP_CODE = 'STANDARD'
  AND  PHA.STYLE_ID = STYLE.STYLE_ID(+)
  AND  PHA.TYPE_LOOKUP_CODE = STYLE.DOCUMENT_SUBTYPE(+)
  AND  (FABUV.BU_NAME IN (:P_PROCUREMENT_BU) OR 'ALL' IN (:P_PROCUREMENT_BU || 'ALL'))
  AND  (PHA.DOCUMENT_STATUS IN (:P_PO_STATUS) OR 'ALL' IN (:P_PO_STATUS || 'ALL'))
  AND  TRUNC(PHA.CREATION_DATE) BETWEEN NVL(:P_PO_FROM_DATE, TRUNC(PHA.CREATION_DATE)) 
                                    AND NVL(:P_PO_TO_DATE, TRUNC(PHA.CREATION_DATE))
  AND  PHA.SEGMENT1 BETWEEN NVL(:P_PO_NUMBER_FROM, PHA.SEGMENT1) 
                        AND NVL(:P_PO_NUMBER_TO, PHA.SEGMENT1)
  AND  (BUYER_NAME.DISPLAY_NAME IN (:P_BUYER_NAME) OR 'ALL' IN (:P_BUYER_NAME || 'ALL'))
  AND  (STYLE.DISPLAY_NAME IN (:P_PO_TYPE) OR 'ALL' IN (:P_PO_TYPE || 'ALL'))
GROUP BY 
       PHA.SEGMENT1
      ,PHA.PO_HEADER_ID
      ,PHA.CREATION_DATE
      -- ... (list all non-aggregated columns)
ORDER BY PO_CREATION_DATE, PO_NUMBER, PO_LINE_NO, PO_SCHEDULE_NO
```

---

## 2. PR Detail Report
*Purchase Requisition detail with approval tracking.*

```sql
/*
TITLE: Purchase Requisition Detail Report
PURPOSE: Detailed PR listing with approval workflow
PARAMETERS:
  - :P_REQUISITIONING_BU - Business Unit
  - :P_PR_STATUS - PR Status
  - :P_FROM_DATE - From Date
  - :P_TO_DATE - To Date
  - :P_PR_NUMBER_FROM - PR Number From
  - :P_PR_NUMBER_TO - PR Number To
  - :P_REQUESTER_NAME - Requester Name
*/

WITH
-- 1. PR Approvers CTE
APPROVERS AS (
    SELECT /*+ qb_name(APPROVERS) MATERIALIZE */
           PAH.ACTION_DATE
          ,PPNF.DISPLAY_NAME AS FULL_NAME
          ,RANK() OVER (PARTITION BY PAH.OBJECT_ID ORDER BY PAH.ACTION_DATE ASC) AS ORDER_V
          ,PAH.OBJECT_ID AS REQUISITION_HEADER_ID
    FROM   PO_ACTION_HISTORY PAH
          ,PER_PERSON_NAMES_F PPNF
          ,POR_REQUISITION_HEADERS_ALL POR
    WHERE  PPNF.NAME_TYPE = 'GLOBAL'
      AND  PAH.PERFORMER_ID = PPNF.PERSON_ID
      AND  PAH.ACTION_CODE = 'APPROVE'
      AND  PAH.OBJECT_ID = POR.REQUISITION_HEADER_ID
      AND  PAH.OBJECT_TYPE_CODE = 'REQ'
      AND  TRUNC(SYSDATE) BETWEEN TRUNC(PPNF.EFFECTIVE_START_DATE) 
                              AND TRUNC(PPNF.EFFECTIVE_END_DATE)
)

-- 2. Final SELECT
SELECT 
       PRHA.REQUISITION_NUMBER AS PR_NUMBER
      ,REGEXP_REPLACE(PRHA.DESCRIPTION, '[[:space:]]', ' ') AS PR_HEADER_DESCRIPTION
      ,TO_CHAR(PRHA.CREATION_DATE, 'YYYY-MM-DD') AS PR_CREATION_DATE
      ,ROUND(PRLA.ASSESSABLE_VALUE, 2) AS PR_LINE_AMOUNT
      ,NAME.REQUESTER_NAME
      ,NAME.REQUESTOR_ID
      ,NULL AS REQUESTER_DEPARTMENT
      ,POR_DOCUMENT_STATUS.MEANING AS PR_STATUS
      ,TO_CHAR(PRDA.BUDGET_DATE, 'YYYY-MM-DD') AS BUDGET_DATE
      ,PRLA.LINE_NUMBER AS LINE_NO
      ,PRDA.DISTRIBUTION_NUMBER AS DISTRIBUTION_NO
      ,REGEXP_REPLACE(PRLA.ITEM_DESCRIPTION, '[[:space:]]', ' ') AS DESCRIPTION
      ,PRLA.QUANTITY
      ,CASE 
          WHEN PRLA.UOM_CODE = 'Ea' THEN 'Each'
          WHEN PRLA.UOM_CODE = 'MON' THEN 'Months'
          WHEN PRLA.UOM_CODE = 'YRS' THEN 'Years'
          ELSE PRLA.UOM_CODE 
        END AS UOM
      ,PRLA.CURRENCY_CODE AS CURRENCY
      ,ROUND(PRLA.RATE, 2) AS EXCHANGE_RATE
      ,ROUND(PRLA.CURRENCY_UNIT_PRICE, 2) AS PRICE
      ,CASE 
          WHEN PRLA.CURRENCY_UNIT_PRICE IS NOT NULL AND PRLA.QUANTITY IS NOT NULL 
          THEN NVL(PRLA.RATE, 1) * (PRLA.CURRENCY_UNIT_PRICE * PRLA.QUANTITY)
          ELSE NVL(PRLA.RATE, 1) * PRLA.CURRENCY_AMOUNT 
        END AS PR_LINE_AMOUNT_AED
      ,ECV.DESCRIPTION AS CATEGORY
      ,FABUV.BU_NAME AS REQUISITIONING_BU
      ,GCC.SEGMENT1 || '-' || GCC.SEGMENT2 || '-' || GCC.SEGMENT3 || '-' || GCC.SEGMENT4 || '-' || GCC.SEGMENT5 || '-' || GCC.SEGMENT6 || '-' || GCC.SEGMENT7 AS PR_CHARGE_ACCOUNT
      ,LINE.LINE_TYPE
      ,ESIV.ITEM_NUMBER AS ITEM
      ,PRHA.REQUISITION_HEADER_ID AS PR_HEADER_ID
      ,(CASE WHEN PR_STATUS = 'Pending approval' THEN NULL ELSE TO_CHAR((SELECT ACTION_DATE FROM APPROVERS WHERE REQUISITION_HEADER_ID = TO_CHAR(PRHA.REQUISITION_HEADER_ID) AND ORDER_V = 1 AND ROWNUM = 1), 'YYYY-MM-DD') END) AS APPROVED_DATE1
      ,(CASE WHEN PR_STATUS = 'Pending approval' THEN NULL ELSE TO_CHAR((SELECT ACTION_DATE FROM APPROVERS WHERE REQUISITION_HEADER_ID = TO_CHAR(PRHA.REQUISITION_HEADER_ID) AND ORDER_V = 2 AND ROWNUM = 1), 'YYYY-MM-DD') END) AS APPROVED_DATE2
      ,(CASE WHEN PR_STATUS = 'Pending approval' THEN NULL ELSE (SELECT FULL_NAME FROM APPROVERS WHERE REQUISITION_HEADER_ID = TO_CHAR(PRHA.REQUISITION_HEADER_ID) AND ORDER_V = 1 AND ROWNUM = 1) END) AS APPROVER1
      ,(CASE WHEN PR_STATUS = 'Pending approval' THEN NULL ELSE (SELECT FULL_NAME FROM APPROVERS WHERE REQUISITION_HEADER_ID = TO_CHAR(PRHA.REQUISITION_HEADER_ID) AND ORDER_V = 2 AND ROWNUM = 1) END) AS APPROVER2
      ,PRHA.ATTRIBUTE2 AS SINGLE_SOURCE
      ,PRHA.ATTRIBUTE3 AS BUSINESS_JUSTIFICATION
      ,PRHA.ATTRIBUTE4 AS PLANNED_UNPLANNED
FROM   POR_REQUISITION_HEADERS_ALL PRHA
      ,POR_REQUISITION_LINES_ALL PRLA
      ,POR_REQ_DISTRIBUTIONS_ALL PRDA
      ,EGP_CATEGORIES_VL ECV
      ,EGP_SYSTEM_ITEMS_VL ESIV
      ,FUN_ALL_BUSINESS_UNITS_V FABUV
      ,GL_CODE_COMBINATIONS GCC
      ,(SELECT PLTT.DESCRIPTION AS LINE_TYPE
              ,PLTT.LINE_TYPE_ID
              ,PLTT.LANGUAGE
        FROM   PO_LINE_TYPES_B PLTB
              ,PO_LINE_TYPES_TL PLTT
        WHERE  PLTB.LINE_TYPE_ID = PLTT.LINE_TYPE_ID
          AND  USERENV('LANG') = PLTT.LANGUAGE
       ) LINE
      ,(SELECT PPNF.FIRST_NAME || ' ' || PPNF.LAST_NAME AS REQUESTER_NAME
              ,PPNF.PERSON_ID
              ,PU.USERNAME AS REQUESTOR_ID
        FROM   PER_PERSON_NAMES_F PPNF
              ,PER_USERS PU
        WHERE  PPNF.PERSON_ID = PU.PERSON_ID
          AND  PPNF.NAME_TYPE = 'GLOBAL'
          AND  TRUNC(SYSDATE) BETWEEN TRUNC(PPNF.EFFECTIVE_START_DATE) 
                                  AND TRUNC(PPNF.EFFECTIVE_END_DATE)
       ) NAME
      ,(SELECT FLVT.MEANING
              ,FLVT.LOOKUP_CODE
        FROM   FND_LOOKUP_VALUES_TL FLVT
        WHERE  FLVT.LOOKUP_TYPE = 'POR_DOCUMENT_STATUS'
          AND  FLVT.VIEW_APPLICATION_ID = 0
          AND  FLVT.SET_ID = 0
          AND  FLVT.LANGUAGE = 'US'
       ) POR_DOCUMENT_STATUS
WHERE  PRHA.REQUISITION_HEADER_ID = PRLA.REQUISITION_HEADER_ID(+)
  AND  PRLA.REQUISITION_LINE_ID = PRDA.REQUISITION_LINE_ID(+)
  AND  PRLA.CATEGORY_ID = ECV.CATEGORY_ID(+)
  AND  PRLA.ITEM_ID = ESIV.INVENTORY_ITEM_ID(+)
  AND  PRHA.REQ_BU_ID = FABUV.BU_ID(+)
  AND  PRDA.CODE_COMBINATION_ID = GCC.CODE_COMBINATION_ID(+)
  AND  PRLA.REQUESTER_ID = NAME.PERSON_ID(+)
  AND  PRLA.LINE_TYPE_ID = LINE.LINE_TYPE_ID(+)
  AND  PRHA.DOCUMENT_STATUS = POR_DOCUMENT_STATUS.LOOKUP_CODE(+)
  AND  (FABUV.BU_NAME IN (:P_REQUISITIONING_BU) OR 'ALL' IN (:P_REQUISITIONING_BU || 'ALL'))
  AND  (PRHA.DOCUMENT_STATUS IN (:P_PR_STATUS) OR 'ALL' IN (:P_PR_STATUS || 'ALL'))
  AND  TRUNC(PRHA.CREATION_DATE) BETWEEN NVL(:P_FROM_DATE, TRUNC(PRHA.CREATION_DATE)) 
                                     AND NVL(:P_TO_DATE, TRUNC(PRHA.CREATION_DATE))
  AND  PRHA.REQUISITION_NUMBER BETWEEN NVL(:P_PR_NUMBER_FROM, PRHA.REQUISITION_NUMBER) 
                                   AND NVL(:P_PR_NUMBER_TO, PRHA.REQUISITION_NUMBER)
  AND  (NAME.REQUESTER_NAME IN (:P_REQUESTER_NAME) OR 'ALL' IN (:P_REQUESTER_NAME || 'ALL'))
GROUP BY 
       PRHA.REQUISITION_NUMBER
      ,PRHA.DESCRIPTION
      ,PRHA.CREATION_DATE
      -- ... (list all non-aggregated columns)
ORDER BY PR_NUMBER, LINE_NO
```

---

## 3. Supplier Master Report
*Comprehensive supplier details with contacts, bank accounts, and classifications.*

```sql
/*
TITLE: Supplier Master Report
PURPOSE: Detailed supplier information with all key details
PARAMETERS:
  - :P_BU_NAME - Business Unit
  - :P_FROM_DATE - From Date
  - :P_TO_DATE - To Date
  - :P_SUPPLIER_TYPE - Supplier Type
  - :P_SUPPLIER_STATUS - Supplier Status (Active/Inactive)
  - :P_CREATED_BY - Created By
*/

WITH
-- 1. Bank Details CTE
BANK_DETAILS AS (
    SELECT /*+ qb_name(BANK_DTL) MATERIALIZE */
           PSV.VENDOR_ID
          ,CE.BANK_NAME
          ,CBB.BANK_BRANCH_NAME AS BRANCH_NAME
          ,CBB.EFT_SWIFT_CODE AS IBC_CODE
          ,IEBA1.BANK_ACCOUNT_NUM AS BANK_ACC_NO
          ,IEBA1.IBAN
          ,IEBA1.CURRENCY_CODE
          ,IEPA.SUPPLIER_SITE_ID
    FROM   IBY_EXT_BANK_ACCOUNTS IEBA1
          ,IBY_ACCOUNT_OWNERS IAO
          ,IBY_EXTERNAL_PAYEES_ALL IEPA
          ,IBY_PMT_INSTR_USES_ALL IPIUA
          ,POZ_SUPPLIERS_V PSV
          ,CE_BANKS_V CE
          ,CE_BANK_BRANCHES_V CBB
    WHERE  IEBA1.EXT_BANK_ACCOUNT_ID = IAO.EXT_BANK_ACCOUNT_ID
      AND  IEPA.PAYEE_PARTY_ID = IAO.ACCOUNT_OWNER_PARTY_ID
      AND  IAO.PRIMARY_FLAG = 'Y'
      AND  IAO.EXT_BANK_ACCOUNT_ID = IPIUA.INSTRUMENT_ID
      AND  IEPA.EXT_PAYEE_ID = IPIUA.EXT_PMT_PARTY_ID
      AND  IAO.ACCOUNT_OWNER_PARTY_ID = PSV.PARTY_ID
      AND  IEBA1.BANK_ID = CE.BANK_PARTY_ID(+)
      AND  IEBA1.BRANCH_ID = CBB.BRANCH_PARTY_ID(+)
)

-- 2. Final SELECT
SELECT 
       PSV.VENDOR_ID
      ,PSV.SEGMENT1 AS SUPPLIER_NO
      ,PSV.VENDOR_NAME AS SUPPLIER_NAME
      ,(SELECT MEANING 
        FROM FND_LOOKUPS 
        WHERE LOOKUP_TYPE = 'ORA_POZ_BUSINESS_RELATIONSHIP' 
          AND PSV.BUSINESS_RELATIONSHIP = LOOKUP_CODE) AS BUSINESS_RELATIONSHIP
      ,PSV.ATTRIBUTE_NUMBER1 AS ICV_PERCENTAGE
      ,PSV.ATTRIBUTE1 AS BUSINESS_SIZE
      ,TO_CHAR(PSV.CREATION_DATE, 'YYYY-MM-DD') AS CREATION_DATE
      ,FLVV.MEANING AS ORGANIZATION_TYPE
      ,PSAV.ADDRESS1 AS ADDRESS_LINE1
      ,PSAV.CITY
      ,PSAV.POSTAL_CODE
      ,(SELECT MEANING 
        FROM FND_LOOKUPS 
        WHERE LOOKUP_TYPE = 'JEES_EURO_COUNTRY_CODES' 
          AND PSAV.COUNTRY = LOOKUP_CODE) AS COUNTRY
      ,PSSV.ZIP AS ZIP_CODE
      ,PSSV.PARTY_SITE_NAME AS SITE_NAME
      ,PASCV.PERSON_FIRST_NAME AS CONTACT_FIRST_NAME
      ,PASCV.PERSON_LAST_NAME AS CONTACT_LAST_NAME
      ,PASCV.EMAIL_ADDRESS
      ,'+' || PASCV.MOBILE_COUNTRY_CODE || ' ' || PASCV.MOBILE_AREA_CODE || ' ' || PASCV.MOBILE_NUMBER AS MOBILE_NO
      ,PBCV.DISPLAYED_FIELD AS BUSINESS_CLASSIFICATION
      ,PBCV.CERTIFYING_AGENCY
      ,PBCV.CERTIFICATE_NUMBER
      ,TO_CHAR(PBCV.EXPIRATION_DATE, 'YYYY-MM-DD') AS EXPIRY_DATE
      ,DECODE(HP.STATUS, 'A', 'Active', 'Inactive') AS SUPPLIER_STATUS
      ,PU.USERNAME AS CREATED_BY_NAME
      ,ZPTP.REP_REGISTRATION_NUMBER AS TAX_REGISTRATION
      ,APT.NAME AS PAYMENT_TERMS
      ,BD.CURRENCY_CODE
      ,BD.BANK_ACC_NO
      ,BD.IBAN
      ,BD.BANK_NAME
      ,BD.BRANCH_NAME
      ,FABU.BU_NAME
FROM   POZ_SUPPLIERS_V PSV
      ,POZ_SUPPLIER_SITES_V PSSV
      ,POZ_SUPPLIER_ADDRESS_V PSAV
      ,POZ_ALL_SUPPLIER_CONTACTS_V PASCV
      ,POZ_BUSINESS_CLASSIFICATIONS_V PBCV
      ,ZX_PARTY_TAX_PROFILE ZPTP
      ,HZ_PARTIES HP
      ,FUN_ALL_BUSINESS_UNITS_V FABU
      ,PER_USERS PU
      ,PER_PERSON_NAMES_F PPNF
      ,FND_LOOKUP_VALUES_VL FLVV
      ,AP_TERMS APT
      ,BANK_DETAILS BD
WHERE  PSV.VENDOR_ID = PSSV.VENDOR_ID(+)
  AND  PSV.VENDOR_ID = PSAV.VENDOR_ID(+)
  AND  PASCV.STATUS(+) = 'Active'
  AND  PSAV.PARTY_SITE_ID(+) = PSSV.PARTY_SITE_ID
  AND  PSV.PARTY_ID = PASCV.SUP_PARTY_ID(+)
  AND  PSV.VENDOR_ID = PBCV.VENDOR_ID(+)
  AND  PSV.PARTY_ID = HP.PARTY_ID(+)
  AND  PSV.VENDOR_ID = BD.VENDOR_ID(+)
  AND  PSV.PARTY_ID = ZPTP.PARTY_ID(+)
  AND  PPNF.PERSON_ID(+) = PU.PERSON_ID
  AND  PPNF.NAME_TYPE(+) = 'GLOBAL'
  AND  LOWER(PSV.CREATED_BY) = LOWER(PU.USERNAME(+))
  AND  PSV.ORGANIZATION_TYPE_LOOKUP_CODE = FLVV.LOOKUP_CODE(+)
  AND  FLVV.LOOKUP_TYPE(+) = 'POZ_ORGANIZATION_TYPE'
  AND  PSSV.TERMS_ID = APT.TERM_ID(+)
  AND  PSSV.PRC_BU_ID = FABU.BU_ID(+)
  AND  TRUNC(SYSDATE) BETWEEN TRUNC(PPNF.EFFECTIVE_START_DATE(+)) 
                          AND TRUNC(PPNF.EFFECTIVE_END_DATE(+))
  AND  (FABU.BU_NAME IN (:P_BU_NAME) OR 'ALL' IN (:P_BU_NAME || 'ALL'))
  AND  PSV.CREATION_DATE BETWEEN NVL(:P_FROM_DATE, PSV.CREATION_DATE) 
                             AND NVL(:P_TO_DATE, PSV.CREATION_DATE)
  AND  (HP.STATUS IN (:P_SUPPLIER_STATUS) OR 'ALL' IN (:P_SUPPLIER_STATUS || 'ALL'))
  AND  (PSV.CREATED_BY IN (:P_CREATED_BY) OR 'ALL' IN (:P_CREATED_BY || 'ALL'))
ORDER BY TO_NUMBER(REGEXP_SUBSTR(PSV.SEGMENT1, '^[0-9]+')),
         REGEXP_REPLACE(PSV.SEGMENT1, '[[:digit:]]', NULL)
```

---

## 4. Work Confirmation Report
*Work confirmation details for service-based POs.*

```sql
/*
TITLE: Work Confirmation Report
PURPOSE: Track work confirmation for services
PARAMETERS:
  - :P_PO - PO Header ID
  - :P_WORK_CONFIRMATION - Work Confirmation ID
*/

SELECT 
       PWH.WORK_CONFIRMATION_ID
      ,PWH.WORK_CONFIRMATION_NUM
      ,PWH.WC_REQUEST_DATE
      ,PWH.STATUS AS WC_STATUS
      ,PWH.COMMENTS AS WC_DESCRIPTION
      ,PWH.PERIOD_PERF_DATE_FROM AS PERIOD_FROM
      ,PWH.PERIOD_PERF_DATE_TO AS PERIOD_TO
      ,SUM(PWL.AMOUNT) AS AMOUNT
      ,(SUM(PWL.AMOUNT) + PWH.PREVIOUSLY_APPROVED_AMOUNT) AS TOTAL_AMOUNT
      ,PHA.SEGMENT1 AS PO_NUM
      ,TO_CHAR(PHA.CREATION_DATE, 'YYYY-MM-DD') AS CONTRACT_DATE
      ,PSV.VENDOR_NAME
      ,PHA.ATTRIBUTE3 AS PURPOSE_CONTRACT
      ,(SELECT PPNF.FULL_NAME
        FROM   PO_LINES_ALL PLA
              ,PO_DISTRIBUTIONS_ALL PDA
              ,PER_PERSON_NAMES_F PPNF
        WHERE  PLA.PO_HEADER_ID = PDA.PO_HEADER_ID
          AND  PLA.PO_LINE_ID = PDA.PO_LINE_ID
          AND  PDA.DELIVER_TO_PERSON_ID = PPNF.PERSON_ID
          AND  PLA.PO_HEADER_ID = PHA.PO_HEADER_ID
          AND  TRUNC(SYSDATE) BETWEEN TRUNC(PPNF.EFFECTIVE_START_DATE) 
                                  AND TRUNC(PPNF.EFFECTIVE_END_DATE)
          AND  ROWNUM = 1
       ) AS REQUESTER
      ,(SELECT LISTAGG(PLLA.DESCRIPTION, ', ') WITHIN GROUP (ORDER BY PWH.WORK_CONFIRMATION_ID)
        FROM   PO_WC_LINES PWL1
              ,PO_LINE_LOCATIONS_ALL PLLA
        WHERE  PWL1.LINE_LOCATION_ID = PLLA.LINE_LOCATION_ID
          AND  PWL1.WORK_CONFIRMATION_ID = PWH.WORK_CONFIRMATION_ID
       ) AS SCHEDULE_DESC
      ,(SELECT USER_COMMENT
        FROM   (SELECT APTC.USER_COMMENT
                FROM   POR_APPROVAL_TASK_COMMENTS APTC
                WHERE  APTC.OBJECT_ID = PWH.WORK_CONFIRMATION_ID
                ORDER BY APTC.COMMENT_DATE
               )
        WHERE  ROWNUM = 1
       ) AS NOTES
FROM   PO_WC_HEADERS PWH
      ,PO_WC_LINES PWL
      ,PO_HEADERS_ALL PHA
      ,POZ_SUPPLIERS_V PSV
WHERE  PWH.WORK_CONFIRMATION_ID = PWL.WORK_CONFIRMATION_ID
  AND  PWH.PO_HEADER_ID = PHA.PO_HEADER_ID
  AND  PHA.VENDOR_ID = PSV.VENDOR_ID
  AND  PHA.PO_HEADER_ID = NVL(:P_PO, PHA.PO_HEADER_ID)
  AND  PWH.WORK_CONFIRMATION_ID = NVL(:P_WORK_CONFIRMATION, PWH.WORK_CONFIRMATION_ID)
GROUP BY 
       PWH.WORK_CONFIRMATION_ID
      ,PWH.WORK_CONFIRMATION_NUM
      ,PWH.WC_REQUEST_DATE
      ,PWH.STATUS
      ,PWH.COMMENTS
      ,PWH.PERIOD_PERF_DATE_FROM
      ,PWH.PERIOD_PERF_DATE_TO
      ,PWH.PREVIOUSLY_APPROVED_AMOUNT
      ,PHA.SEGMENT1
      ,PHA.CREATION_DATE
      ,PSV.VENDOR_NAME
      ,PHA.ATTRIBUTE3
      ,PHA.PO_HEADER_ID
ORDER BY PO_NUM, WORK_CONFIRMATION_NUM
```
